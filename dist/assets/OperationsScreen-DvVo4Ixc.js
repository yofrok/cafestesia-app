import{r as o,j as e,T as ae,I as O,O as re,a as le,b as ne}from"./index-CzRrAFD7.js";import{M as oe}from"./Modal-C7jCsDhC.js";const ie=[{label:"L",value:"1"},{label:"M",value:"2"},{label:"M",value:"3"},{label:"J",value:"4"},{label:"V",value:"5"},{label:"S",value:"6"},{label:"D",value:"0"}],ce=({isOpen:t,onClose:m,onSave:h,onDelete:C,task:r,selectedDate:E})=>{const[y,g]=o.useState(""),[D,f]=o.useState("Ali"),[v,T]=o.useState("08"),[S,j]=o.useState("00"),[a,i]=o.useState("AM"),[l,u]=o.useState("30"),[n,c]=o.useState("pre-apertura"),[x,d]=o.useState(""),[$,k]=o.useState(!1),[N,w]=o.useState("once"),[A,p]=o.useState([]),[M,P]=o.useState("4"),[z,R]=o.useState([]),[_,H]=o.useState(""),[W,F]=o.useState(!1),[L,I]=o.useState(""),[q,K]=o.useState("");o.useEffect(()=>{if(t){g((r==null?void 0:r.text)||""),f((r==null?void 0:r.employee)||"Ali");const s=(r==null?void 0:r.time)||"08:00",[b,X]=s.split(":").map(Number),U=b>=12?"PM":"AM";let G=b%12;G===0&&(G=12),T(String(G).padStart(2,"0")),j(String(X).padStart(2,"0")),i(U),u(String((r==null?void 0:r.duration)||"30")),c((r==null?void 0:r.shift)||"pre-apertura"),d((r==null?void 0:r.zone)||""),k((r==null?void 0:r.isCritical)||!1),w("once"),p([]),P("4"),R((r==null?void 0:r.subtasks)||[]),H(""),F(!1),I(""),K("")}},[t,r]);const V=s=>{p(b=>b.includes(s)?b.filter(X=>X!==s):[...b,s])},B=()=>{if(_.trim()==="")return;const s={id:`sub-${Date.now()}`,text:_.trim(),isCompleted:!1};R([...z,s]),H("")},Q=s=>{s.key==="Enter"&&(s.preventDefault(),B())},ee=s=>{R(z.filter(b=>b.id!==s))},te=s=>{if(s.preventDefault(),!y){alert("Por favor completa el nombre de la tarea.");return}if(N==="weekly"&&A.length===0){alert("Por favor selecciona al menos un día para la tarea recurrente.");return}let b=parseInt(v,10);a==="PM"&&b!==12?b+=12:a==="AM"&&b===12&&(b=0);const X=`${String(b).padStart(2,"0")}:${S}`,U={text:y,employee:D,time:X,duration:parseInt(l,10),shift:n,zone:x,isCritical:$,date:(r==null?void 0:r.date)||E,recurrence:N,selectedDays:A,recurrenceWeeks:M,subtasks:z};h(U,r==null?void 0:r.id),m()},se=()=>{L===re?(r&&C(r.id),m()):(K("PIN incorrecto. Inténtalo de nuevo."),I(""))},Y=!!r;return e.jsx(oe,{isOpen:t,onClose:m,title:r?"Editar Tarea":"Añadir Nueva Tarea",children:e.jsxs("div",{className:"relative",children:[e.jsxs("form",{onSubmit:te,className:"flex flex-col gap-4 max-h-[80vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Nombre de la Tarea"}),e.jsx("input",{type:"text",value:y,onChange:s=>g(s.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("fieldset",{disabled:Y,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Repetición"}),e.jsxs("div",{className:"flex gap-2 bg-gray-200 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>w("once"),className:`flex-1 p-2 rounded-md text-sm font-bold transition-colors ${N==="once"?"bg-white shadow-sm":""}`,children:"Una vez"}),e.jsx("button",{type:"button",onClick:()=>w("weekly"),className:`flex-1 p-2 rounded-md text-sm font-bold transition-colors ${N==="weekly"?"bg-white shadow-sm":""}`,children:"Semanalmente"})]}),Y&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"La repetición no se puede cambiar en una tarea existente."})]}),N==="weekly"&&e.jsxs("div",{className:"flex flex-col gap-4 mt-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Días de la semana"}),e.jsx("div",{className:"flex justify-between gap-1",children:ie.map(({label:s,value:b})=>e.jsx("button",{type:"button",onClick:()=>V(b),className:`w-9 h-9 flex items-center justify-center font-bold rounded-full border-2 transition-colors ${A.includes(b)?"bg-blue-600 text-white border-blue-600":"bg-gray-100 border-gray-300"}`,children:s},b))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Repetir durante"}),e.jsxs("select",{value:M,onChange:s=>P(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{value:"4",children:"4 semanas"}),e.jsx("option",{value:"8",children:"8 semanas"}),e.jsx("option",{value:"12",children:"12 semanas"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Empleado"}),e.jsxs("select",{value:D,onChange:s=>f(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{children:"Ali"}),e.jsx("option",{children:"Fer"}),e.jsx("option",{children:"Claudia"}),e.jsx("option",{children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Turno"}),e.jsxs("select",{value:n,onChange:s=>c(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{value:"matutino",children:"Matutino"}),e.jsx("option",{value:"pre-apertura",children:"Pre Apertura"}),e.jsx("option",{value:"cierre",children:"Cierre"}),e.jsx("option",{value:"default",children:"Otro"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Hora"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("select",{value:v,onChange:s=>T(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Array.from({length:12},(s,b)=>b+1).map(s=>e.jsx("option",{value:String(s).padStart(2,"0"),children:String(s).padStart(2,"0")},s))}),e.jsx("select",{value:S,onChange:s=>j(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Array.from({length:60},(s,b)=>b).map(s=>e.jsx("option",{value:String(s).padStart(2,"0"),children:String(s).padStart(2,"0")},s))}),e.jsxs("select",{value:a,onChange:s=>i(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{children:"AM"}),e.jsx("option",{children:"PM"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Duración"}),e.jsx("select",{value:l,onChange:s=>u(s.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:ae.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Zona (Opcional)"}),e.jsx("input",{type:"text",value:x,onChange:s=>d(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"form-group mt-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Subtareas"}),e.jsxs("div",{className:"bg-gray-100 p-3 rounded-lg",children:[z.length>0&&e.jsx("ul",{className:"space-y-2 mb-3",children:z.map(s=>e.jsxs("li",{className:"flex items-center justify-between bg-white p-2 rounded",children:[e.jsx("span",{className:"text-sm text-gray-700",children:s.text}),e.jsx("button",{type:"button",onClick:()=>ee(s.id),className:"p-1 text-gray-400 hover:text-red-600",children:e.jsx(O,{name:"trash-2",size:16})})]},s.id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:_,onChange:s=>H(s.target.value),onKeyDown:Q,placeholder:"Añadir una subtarea...",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-sm"}),e.jsx("button",{type:"button",onClick:B,className:"py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 text-sm",children:"Añadir"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"task-critical",checked:$,onChange:s=>k(s.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"task-critical",className:"text-sm font-medium text-gray-600",children:"Es una tarea crítica"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t sticky bottom-0 bg-white",children:[e.jsx("div",{children:r&&e.jsx("button",{type:"button",onClick:()=>F(!0),className:"py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700",children:"Eliminar Tarea"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:m,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Guardar Cambios"})]})]})]}),W&&e.jsx("div",{className:"absolute inset-0 bg-white/80 backdrop-blur-sm flex justify-center items-center z-10",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-gray-200 w-full max-w-sm text-center",children:[e.jsx("h4",{className:"font-bold text-lg text-gray-800",children:"Confirmar Eliminación"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2 mb-4",children:"Para confirmar, introduce el PIN de operaciones. Esta acción no se puede deshacer."}),e.jsx("input",{type:"password",value:L,onChange:s=>{I(s.target.value),K("")},placeholder:"PIN de Seguridad",autoFocus:!0,className:"w-full p-2 border border-gray-300 rounded-md text-center"}),q&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:q}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{onClick:()=>F(!1),className:"flex-1 py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{onClick:se,className:"flex-1 py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700",children:"Confirmar"})]})]})})]})})},de=({selectedDate:t,setSelectedDate:m})=>{const[h,C]=o.useState(t),[r,E]=o.useState(""),y=o.useRef(0);o.useEffect(()=>{C(t)},[t]),o.useEffect(()=>{if(r.startsWith("slide-out")){const n=r.includes("left")?"next":"prev",c=setTimeout(()=>{const x=new Date(h);x.setDate(x.getDate()+(n==="prev"?-7:7)),C(x);const d=new Date(t);d.setDate(d.getDate()+(n==="prev"?-7:7)),m(d),E(n==="next"?"slide-in-from-right":"slide-in-from-left")},200);return()=>clearTimeout(c)}else if(r.startsWith("slide-in")){const n=setTimeout(()=>{E("")},200);return()=>clearTimeout(n)}},[r,h,t,m]);const g=n=>{r||E(n==="next"?"slide-out-left":"slide-out-right")},D=n=>{const c=n.target.value;if(c){const x=new Date(c);x.setMinutes(x.getMinutes()+x.getTimezoneOffset()),m(x)}},f=n=>{y.current=n.targetTouches[0].clientX},v=n=>{const c=n.changedTouches[0].clientX,x=50,d=y.current-c;d>x?g("next"):d<-x&&g("prev")},T=new Date;T.setHours(0,0,0,0);const S=new Date(h),j=h.getDay(),a=h.getDate()-j+(j===0?-6:1);S.setDate(a),S.setHours(0,0,0,0);const i=[];for(let n=0;n<7;n++){const c=new Date(S);c.setDate(S.getDate()+n),i.push(c)}const l=(n,c)=>n.getFullYear()===c.getFullYear()&&n.getMonth()===c.getMonth()&&n.getDate()===c.getDate(),u=h.toLocaleDateString("es-ES",{month:"long",year:"numeric"});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 px-2",children:[e.jsx("button",{onClick:()=>g("prev"),className:"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(O,{name:"chevron-left",size:20})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold text-gray-700 capitalize text-sm",children:u}),e.jsxs("div",{className:"relative w-9 h-9 flex items-center justify-center text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors cursor-pointer",title:"Seleccionar fecha",children:[e.jsx(O,{name:"calendar",size:18}),e.jsx("input",{type:"date",onChange:D,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer","aria-label":"Seleccionar fecha"})]})]}),e.jsx("button",{onClick:()=>g("next"),className:"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(O,{name:"chevron-right",size:20})})]}),e.jsx("div",{className:"p-1 bg-gray-200 rounded-lg overflow-hidden relative touch-pan-y",children:e.jsx("div",{className:`flex justify-between items-center gap-1 md:gap-2 ${r}`,onTouchStart:f,onTouchEnd:v,children:i.map(n=>{const c=l(n,t),x=l(n,T);return e.jsx("button",{onClick:()=>m(n),className:"px-1 py-1 md:px-2 md:py-2 rounded-md transition-all duration-200 text-center flex-1",children:e.jsxs("div",{className:`${c?"bg-white shadow-sm rounded-md":""} py-1`,children:[e.jsx("span",{className:`text-xs uppercase font-bold ${c?"text-blue-600":"text-gray-500"}`,children:n.toLocaleDateString("es-ES",{weekday:"short"}).replace(".","")}),e.jsx("p",{className:`font-bold text-lg ${x?"text-blue-600":c?"text-gray-800":"text-gray-600"}`,children:n.getDate()})]})},n.toISOString())})})})]})},Z={Ali:{bg:"bg-pink-100",border:"border-pink-500",text:"text-pink-800"},Fer:{bg:"bg-purple-100",border:"border-purple-500",text:"text-purple-800"},Claudia:{bg:"bg-teal-100",border:"border-teal-500",text:"text-teal-800"},Admin:{bg:"bg-yellow-100",border:"border-yellow-600",text:"text-yellow-900"}},ue=t=>{switch(t){case"inprogress":return"opacity-100 animate-pulse-yellow";case"done":return"opacity-50";case"todo":default:return"opacity-100"}},me=({task:t,onUpdateStatus:m,onEdit:h,onViewSubtasks:C,style:r})=>{var i,l;const{bg:E,border:y,text:g}=Z[t.employee]||Z.Admin,D=ue(t.status),f=u=>{u.stopPropagation(),t.status==="todo"?m(t.id,"inprogress"):t.status==="inprogress"?m(t.id,"done"):t.status==="done"&&m(t.id,"todo")},v=new Date(`${t.date}T${t.time}`),S=new Date(v.getTime()+t.duration*6e4).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hourCycle:"h23"}),j=((i=t.subtasks)==null?void 0:i.length)||0,a=((l=t.subtasks)==null?void 0:l.filter(u=>u.isCompleted).length)||0;return e.jsxs("div",{style:r,onClick:C,className:`absolute rounded-lg p-2 flex gap-2 transition-all duration-300 cursor-pointer ${E} border-2 ${D} ${t.status==="inprogress"?y:"border-transparent"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-1 h-full ${y.replace("border-","bg-")} rounded-full`}),e.jsxs("div",{className:"flex-grow flex flex-col min-w-0 min-h-0",children:[e.jsxs("div",{className:"flex-grow overflow-hidden",children:[e.jsx("p",{className:`font-bold text-sm break-words ${g} ${t.status==="done"?"line-through":""}`,children:t.text}),e.jsxs("p",{className:`text-xs ${g} ${t.status==="done"?"line-through":""}`,children:[t.time," - ",S," (",t.duration," min)"]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1 flex-shrink-0",children:[e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded-full bg-white/60 ${g}`,children:t.employee}),e.jsxs("div",{className:"flex items-center gap-2",children:[j>0&&e.jsxs("div",{className:`flex items-center gap-1 text-xs font-semibold ${g}`,children:[e.jsx(O,{name:"list",size:14}),e.jsxs("span",{children:[a,"/",j]})]}),e.jsx("button",{onClick:u=>{u.stopPropagation(),h(t)},className:`p-1 rounded-full hover:bg-black/10 transition-colors ${g}`,title:"Editar Tarea",children:e.jsx(O,{name:"pencil",size:14})})]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:f,className:"w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all",style:{borderColor:t.status==="done"?"#4ade80":"#9ca3af",backgroundColor:t.status==="done"?"#4ade80":"white"},children:[t.status==="inprogress"&&e.jsx("div",{className:"w-2.5 h-2.5 bg-yellow-500 rounded-full"}),t.status==="done"&&e.jsx(O,{name:"check",size:16,className:"text-white"})]})})]})},xe=({task:t,onClose:m,onUpdateTask:h})=>{var S,j;const[C,r]=o.useState(""),E=a=>{const i=(t.subtasks||[]).map(l=>l.id===a?{...l,isCompleted:!l.isCompleted}:l);h({...t,subtasks:i})},y=()=>{if(C.trim()==="")return;const a={id:`sub-${Date.now()}`,text:C.trim(),isCompleted:!1},i=[...t.subtasks||[],a];h({...t,subtasks:i}),r("")},g=a=>{const i=(t.subtasks||[]).filter(l=>l.id!==a);h({...t,subtasks:i})},D=a=>{a.key==="Enter"&&(a.preventDefault(),y())},f=((S=t.subtasks)==null?void 0:S.filter(a=>a.isCompleted).length)||0,v=((j=t.subtasks)==null?void 0:j.length)||0,T=v>0?f/v*100:0;return e.jsx("div",{className:"absolute inset-0 bg-gray-900/40 z-50 flex justify-center items-center p-4",onClick:m,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md flex flex-col",onClick:a=>a.stopPropagation(),children:[e.jsxs("header",{className:"p-4 border-b",children:[e.jsx("h3",{className:"font-bold text-lg text-blue-700",children:t.text}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.time," - ",t.employee]})]}),e.jsxs("div",{className:"p-4 flex-grow overflow-y-auto max-h-[50vh]",children:[v>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Progreso"}),e.jsxs("span",{children:[f," / ",v]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${T}%`}})})]}),e.jsx("div",{className:"space-y-2",children:(t.subtasks||[]).map(a=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-md group",children:[e.jsx("input",{type:"checkbox",checked:a.isCompleted,onChange:()=>E(a.id),className:"w-5 h-5 rounded text-blue-600 focus:ring-blue-500 flex-shrink-0"}),e.jsx("span",{className:`flex-grow text-gray-800 ${a.isCompleted?"line-through text-gray-400":""}`,children:a.text}),e.jsx("button",{onClick:()=>g(a.id),className:"p-1 text-gray-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(O,{name:"trash-2",size:16})})]},a.id))}),v===0&&e.jsx("p",{className:"text-center text-gray-500 py-6",children:"No hay subtareas. ¡Añade la primera!"})]}),e.jsx("div",{className:"p-4 border-t bg-gray-50 rounded-b-xl",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:C,onChange:a=>r(a.target.value),onKeyDown:D,placeholder:"Añadir nueva subtarea...",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-sm focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:y,className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 text-sm",children:"Añadir"})]})})]})})},J=120,he=30,ge=({tasks:t,onUpdateStatus:m,onEditTask:h,onUpdateTask:C})=>{const[r,E]=o.useState(new Date),[y,g]=o.useState(null);o.useEffect(()=>{const a=setInterval(()=>E(new Date),6e4);return()=>clearInterval(a)},[]),o.useEffect(()=>{if(y){const a=t.find(i=>i.id===y.id);g(a||null)}},[t]);const D=o.useMemo(()=>{const a={};return t.forEach(i=>{const l=parseInt(i.time.split(":")[0],10);a[l]=!0}),a},[t]),f=o.useMemo(()=>{let a=0;const i=[];for(let l=ne;l<=le;l++){const n=!!D[l]?J:he;i.push({hour:l,top:a,height:n}),a+=n}return i},[D]),v=f.length>0?f[f.length-1].top+f[f.length-1].height:0,T=a=>{const[i,l]=a.split(":").map(Number),u=f.find(c=>c.hour===i);if(!u)return 0;const n=l/60*u.height;return u.top+n},S=o.useMemo(()=>{const a=[...t].sort((l,u)=>l.time.localeCompare(u.time)||u.duration-l.duration),i=[];for(const l of a){const u=T(l.time),n=new Date(`${l.date}T${l.time}`).getTime(),c=n+l.duration*6e4,x=f.find(w=>w.hour===parseInt(l.time.split(":")[0],10)),d=x?x.height:J,$=l.duration/60*d,k=[];for(const w of i){const A=new Date(`${w.task.date}T${w.task.time}`).getTime(),p=A+w.task.duration*6e4;n<p&&c>A&&k.push(w)}let N=0;for(;k.some(w=>w.left===N);)N++;i.push({task:l,top:u,height:$,left:N,width:1,zIndex:N})}return i.map((l,u,n)=>{const{task:c}=l,x=new Date(`${c.date}T${c.time}`).getTime(),d=x+c.duration*6e4,$=n.filter(p=>{const M=new Date(`${p.task.date}T${p.task.time}`).getTime(),P=M+p.task.duration*6e4;return x<P&&d>M}),k=new Set($.map(p=>p.left)),N=k.size;let w=0;return w=Array.from(k).sort((p,M)=>p-M).indexOf(l.left),{...l,width:100/N,left:w/N*100}})},[t,f]),j=T(`${r.getHours()}:${r.getMinutes()}`);return e.jsxs("div",{className:"p-4 md:p-6 h-full relative",children:[e.jsxs("div",{className:"relative z-10",style:{height:`${v}px`},children:[f.map(({hour:a,top:i,height:l})=>e.jsxs("div",{className:"absolute w-full",style:{top:`${i}px`,height:`${l}px`},children:[e.jsxs("span",{className:"absolute -top-3 left-0 text-sm font-semibold text-gray-400 w-16 text-right pr-4",children:[a,":00"]}),e.jsx("div",{className:"h-px bg-gray-200 ml-16"})]},a)),j>=0&&j<=v&&e.jsx("div",{className:"absolute left-16 right-0 h-0.5 bg-red-500 z-20",style:{top:`${j}px`},children:e.jsx("div",{className:"absolute -left-1.5 -top-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white"})}),e.jsx("div",{className:"absolute top-0 bottom-0 left-16 right-0",children:S.map(({task:a,top:i,height:l,left:u,width:n,zIndex:c})=>e.jsx(me,{task:a,onUpdateStatus:m,onEdit:h,onViewSubtasks:()=>g(a),style:{top:`${i}px`,height:`${Math.max(l-4,80)}px`,left:`${u}%`,width:`calc(${n}% - 4px)`,zIndex:c}},a.id))})]}),y&&e.jsx(xe,{task:y,onClose:()=>g(null),onUpdateTask:C})]})},pe=t=>t>0?`en ${t} min`:t===0?"¡Ahora!":`hace ${Math.abs(t)} min`,be=({tasksWithDiff:t})=>e.jsxs("div",{className:"bg-yellow-100 border-b-2 border-yellow-300 p-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(O,{name:"alert-triangle",className:"text-yellow-600",size:20}),e.jsx("h3",{className:"font-bold text-yellow-800 text-base",children:"Tareas Críticas Próximas"})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:t.map(({task:m,diff:h})=>e.jsxs("div",{className:"bg-white/70 p-2 rounded-lg border border-yellow-300 flex-shrink-0 w-60",children:[e.jsx("p",{className:"font-bold text-sm text-gray-800 truncate",children:m.text}),e.jsxs("p",{className:`text-xs font-semibold ${h<=0?"text-red-600 animate-pulse":"text-blue-600"}`,children:[m.time," (",pe(h),")"]})]},m.id))})]}),fe=["Ali","Fer","Claudia","Admin"],ve=({kanbanHook:t,criticalTasks:m})=>{const{tasks:h,addTask:C,addMultipleTasks:r,updateTask:E,updateTaskStatus:y,deleteTask:g}=t,[D,f]=o.useState(new Date),[v,T]=o.useState(!1),[S,j]=o.useState(null),[a,i]=o.useState("All"),l=d=>{j(d),T(!0)},u=()=>{T(!1),j(null)},n=(d,$)=>{const{recurrence:k,selectedDays:N,recurrenceWeeks:w,...A}=d;if($){const p=h.find(P=>P.id===$);if(!p)return;const M={...p,...A,id:$};E(M)}else{const p=new Date(A.date);if(p.setMinutes(p.getMinutes()+p.getTimezoneOffset()),k==="weekly"&&N&&N.length>0){const M=parseInt(w||"4",10),P=[],z=new Date(p),R=p.getDay(),_=p.getDate()-R+(R===0?-6:1);z.setDate(_);for(let H=0;H<M;H++){const W=new Date(z);W.setDate(z.getDate()+H*7),N.forEach(F=>{const L=parseInt(F,10),I=new Date(W);L===0?I.setDate(W.getDate()+6):I.setDate(W.getDate()+(L-1)),I.setMinutes(I.getMinutes()-I.getTimezoneOffset()),P.push({...A,date:I.toISOString().split("T")[0]})})}r(P)}else C(A)}},c=o.useMemo(()=>{const d=new Date(D);return d.setMinutes(d.getMinutes()-d.getTimezoneOffset()),d.toISOString().split("T")[0]},[D]),x=o.useMemo(()=>h.filter(d=>{const $=d.date===c,k=a==="All"||d.employee===a;return $&&k}),[h,c,a]);return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50",children:[m.length>0&&e.jsx(be,{tasksWithDiff:m}),e.jsxs("div",{className:"operations-header flex flex-col p-4 border-b border-gray-200 gap-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center w-full gap-4",children:[e.jsx(de,{selectedDate:D,setSelectedDate:f}),e.jsx("div",{className:"flex gap-2 w-full md:w-auto",children:e.jsxs("button",{onClick:()=>T(!0),className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm w-full justify-center",children:[e.jsx(O,{name:"plus-circle",size:16}),"Añadir Tarea"]})})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-200 rounded-lg p-1 w-full overflow-x-auto",children:[e.jsx("button",{onClick:()=>i("All"),className:`px-3 py-1 text-sm font-bold rounded-md transition-colors ${a==="All"?"bg-white shadow-sm":"bg-transparent text-gray-600"}`,children:"Todos"}),fe.map(d=>e.jsx("button",{onClick:()=>i(d),className:`px-3 py-1 text-sm font-bold rounded-md transition-colors ${a===d?"bg-white shadow-sm":"bg-transparent text-gray-600"}`,children:d},d))]})]}),e.jsx("div",{className:"flex-grow overflow-auto relative",children:e.jsx(ge,{tasks:x,onEditTask:l,onUpdateStatus:y,onUpdateTask:E})}),e.jsx(ce,{isOpen:v,onClose:u,onSave:n,onDelete:g,task:S,selectedDate:c})]})};export{ve as default};
