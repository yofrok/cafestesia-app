import{u as E,r as a,j as e,R as F}from"./index-Ba-L6XfD.js";import{M as R}from"./Modal-CT2Q9ouJ.js";const I=({isOpen:s,onClose:n,onUpdate:p,item:r,isAdding:c,providers:u})=>{const{users:i}=E(),[h,j]=a.useState(""),[b,g]=a.useState(""),[v,f]=a.useState(""),[m,y]=a.useState(""),[N,S]=a.useState(""),[P,o]=a.useState(""),C=c?"Añadir":"Usar / Mermar";a.useEffect(()=>{s&&(j(""),g(""),f(r.providerPreferido||(u.length>0?u[0].name:"")),y(i.length>0?i[0].name:""),S(""),o(""))},[s,r,u,i]);const k=t=>{t.preventDefault(),o("");const d=parseFloat(h);if(isNaN(d)||d<=0){o("Introduce una cantidad válida mayor que 0.");return}if(!m){o("Debes seleccionar un responsable.");return}const M={itemId:r.id,responsible:m,reason:N};if(c){const x=parseFloat(b);if(isNaN(x)||x<0){o("Introduce un precio total válido.");return}p({...M,change:d,purchaseDetails:{totalPrice:x,providerName:v}})}else p({...M,change:-d});n()};return e.jsx(R,{isOpen:s,onClose:n,title:`${C} Stock`,children:e.jsxs("form",{onSubmit:k,className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{children:["Producto: ",e.jsx("span",{className:"font-bold",children:r.name})]}),e.jsxs("p",{children:["Stock Actual: ",r.currentStock," ",r.unit]})]}),e.jsx(l,{label:`Cantidad a ${c?"añadir":"restar"}`,children:e.jsx("input",{type:"number",value:h,onChange:t=>j(t.target.value),step:"any",min:"0.01",required:!0,autoFocus:!0})}),c?e.jsxs(e.Fragment,{children:[e.jsx(l,{label:"Precio Total de la Compra ($)",children:e.jsx("input",{type:"number",value:b,onChange:t=>g(t.target.value),step:"any",min:"0",required:!0})}),e.jsx(l,{label:"Proveedor",children:e.jsxs("select",{value:v,onChange:t=>f(t.target.value),required:!0,children:[u.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id)),e.jsx("option",{value:"Otro",children:"Otro"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{label:"Motivo (Opcional)",children:e.jsx("input",{type:"text",value:N,onChange:t=>S(t.target.value),placeholder:"Ej: Producción, Merma, Degustación...",list:"reasons-list"})}),e.jsxs("datalist",{id:"reasons-list",children:[e.jsx("option",{value:"Producción venta"}),e.jsx("option",{value:"Merma (Caducado)"}),e.jsx("option",{value:"Merma (Dañado)"}),e.jsx("option",{value:"Consumo Interno"}),e.jsx("option",{value:"Ajuste de Inventario"})]})]}),e.jsx(l,{label:"Responsable",children:e.jsx("select",{value:m,onChange:t=>y(t.target.value),required:!0,children:i.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id))})}),P&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:P}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx("button",{type:"button",onClick:n,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:C})]})]})})},l=({label:s,children:n})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:s}),F.cloneElement(n,{className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"})]});export{I as S};
