import{r as u,j as e,c as H,I as w,d as $}from"./index-B6Dgyu2F.js";import{M as A}from"./Modal-DEszM_Vt.js";const T=({isOpen:r,onClose:a,onUpdate:x,item:n,isAdding:t,providers:s})=>{const[o,i]=u.useState(""),[c,d]=u.useState(""),[h,m]=u.useState(""),[b,j]=u.useState(""),N=t?"Añadir":"Usar";u.useEffect(()=>{r&&(i(""),d(""),m(n.providerPreferido||(s.length>0?s[0].name:"")),j(""))},[r,n,s]);const f=g=>{g.preventDefault(),j("");const y=parseFloat(o);if(isNaN(y)||y<=0){j("Introduce una cantidad válida mayor que 0.");return}if(t){const S=parseFloat(c);if(isNaN(S)||S<0){j("Introduce un precio total válido.");return}x({itemId:n.id,change:y,purchaseDetails:{totalPrice:S,providerName:h}})}else x({itemId:n.id,change:-y});a()};return e.jsx(A,{isOpen:r,onClose:a,title:`${N} Stock`,children:e.jsxs("form",{onSubmit:f,className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{children:["Producto: ",e.jsx("span",{className:"font-bold",children:n.name})]}),e.jsxs("p",{children:["Stock Actual: ",n.currentStock," ",n.unit]})]}),e.jsx(q,{label:`Cantidad a ${N.toLowerCase()}`,children:e.jsx("input",{type:"number",value:o,onChange:g=>i(g.target.value),step:"any",min:"0.01",required:!0,autoFocus:!0})}),t&&e.jsxs(e.Fragment,{children:[e.jsx(q,{label:"Precio Total de la Compra ($)",children:e.jsx("input",{type:"number",value:c,onChange:g=>d(g.target.value),step:"any",min:"0",required:!0})}),e.jsx(q,{label:"Proveedor",children:e.jsxs("select",{value:h,onChange:g=>m(g.target.value),required:!0,children:[s.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id)),e.jsx("option",{value:"Otro",children:"Otro"})]})})]}),b&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:b}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx("button",{type:"button",onClick:a,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:N})]})]})})},q=({label:r,children:a})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:r}),H.cloneElement(a,{className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),M=({icon:r,onClick:a,colorClass:x,title:n})=>e.jsx("button",{title:n,onClick:a,className:`w-10 h-10 flex items-center justify-center bg-gray-100 border border-gray-200 rounded-full transition-colors ${x}`,children:e.jsx(w,{name:r,size:20})}),U=({item:r,onEdit:a,onAddStock:x,onUseStock:n,onViewHistory:t})=>{const s=r.currentStock<=r.minStock,o=r.purchaseHistory&&r.purchaseHistory.length>0?r.purchaseHistory[r.purchaseHistory.length-1]:null,i=o?(o.totalPrice/o.quantity).toFixed(2):null;return e.jsxs("div",{className:`p-4 bg-white rounded-lg border flex flex-col md:flex-row md:items-center justify-between gap-4 ${s?"border-red-300 bg-red-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-bold text-lg",children:r.name}),e.jsxs("div",{className:"flex flex-wrap items-baseline gap-x-4 gap-y-1 text-sm",children:[e.jsxs("p",{children:["Stock: ",e.jsx("span",{className:"font-semibold",children:r.currentStock.toFixed(2)})," ",r.unit]}),e.jsxs("p",{className:"text-gray-500",children:["(Mín: ",r.minStock," ",r.unit,")"]}),i&&e.jsxs("p",{className:"text-gray-500 font-semibold",children:["Último Precio: $",i," / ",r.unit]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 justify-end",children:[e.jsx(M,{icon:"plus",onClick:x,colorClass:"hover:bg-green-100 hover:text-green-600",title:"Añadir Stock"}),e.jsx(M,{icon:"minus",onClick:n,colorClass:"hover:bg-red-100 hover:text-red-600",title:"Usar Stock"}),e.jsx(M,{icon:"bar-chart-2",onClick:t,colorClass:"hover:bg-yellow-100 hover:text-yellow-600",title:"Historial de Precios"}),e.jsx(M,{icon:"pencil",onClick:()=>a(r),colorClass:"hover:bg-blue-100 hover:text-blue-600",title:"Editar Producto"})]})]})},L=({isOpen:r,onClose:a,item:x})=>{const n=u.useMemo(()=>x.purchaseHistory?[...x.purchaseHistory].sort((s,o)=>new Date(o.date).getTime()-new Date(s.date).getTime()):[],[x.purchaseHistory]),t=u.useMemo(()=>!n||n.length===0?null:n.reduce((s,o)=>{const i=o.totalPrice/o.quantity;return i<s?i:s},1/0),[n]);return e.jsxs(A,{isOpen:r,onClose:a,title:`Historial de Precios: ${x.name}`,children:[e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[t&&t!==1/0&&e.jsx("div",{className:"p-3 mb-4 bg-green-100 border border-green-300 rounded-lg text-center",children:e.jsxs("p",{className:"font-bold text-green-800",children:["Mejor Precio Histórico: $",t.toFixed(2)," / ",x.unit]})}),n.length>0?e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"Fecha"}),e.jsx("th",{className:"p-2",children:"Proveedor"}),e.jsx("th",{className:"p-2",children:"Cant."}),e.jsx("th",{className:"p-2",children:"Total"}),e.jsx("th",{className:"p-2",children:"Unitario"})]})}),e.jsx("tbody",{children:n.map(s=>{const o=s.totalPrice/s.quantity,i=o.toFixed(2)===(t==null?void 0:t.toFixed(2));return e.jsxs("tr",{className:`border-b ${i?"bg-green-50":""}`,children:[e.jsx("td",{className:"p-2",children:new Date(s.date).toLocaleDateString()}),e.jsx("td",{className:"p-2",children:s.providerName}),e.jsxs("td",{className:"p-2",children:[s.quantity," ",x.unit]}),e.jsxs("td",{className:"p-2",children:["$",s.totalPrice.toFixed(2)]}),e.jsxs("td",{className:`p-2 font-bold ${i?"text-green-700":""}`,children:["$",o.toFixed(2)]})]},s.id)})})]}):e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No hay historial de compras para este producto."})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:a,className:"py-2 px-6 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cerrar"})})]})},D=({items:r,onEdit:a,onRecordStockChange:x,providers:n})=>{const[t,s]=u.useState(null),[o,i]=u.useState(null);if(r.length===0)return e.jsx("p",{className:"text-center text-gray-500 mt-8",children:"No se encontraron productos."});const c=r.reduce((h,m)=>{const b=m.category||"Sin Categoría";return h[b]||(h[b]=[]),h[b].push(m),h},{}),d=Object.keys(c).sort();return e.jsxs("div",{className:"space-y-6",children:[d.map(h=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-blue-700 pb-2 border-b border-gray-300 mb-4",children:h}),e.jsx("div",{className:"space-y-3",children:c[h].map(m=>e.jsx(U,{item:m,onEdit:a,onAddStock:()=>s({item:m,isAdding:!0}),onUseStock:()=>s({item:m,isAdding:!1}),onViewHistory:()=>i(m)},m.id))})]},h)),t&&e.jsx(T,{isOpen:!!t,onClose:()=>s(null),item:t.item,isAdding:t.isAdding,onUpdate:x,providers:n}),o&&e.jsx(L,{isOpen:!!o,onClose:()=>i(null),item:o})]})},O=({items:r,onRecordStockChange:a,providers:x})=>{const[n,t]=u.useState(null),s=r.filter(c=>c.currentStock<=c.minStock);if(s.length===0)return e.jsx("p",{className:"text-center text-gray-500 mt-8",children:"¡Todo en orden! No hay nada en la lista de compras."});const o=s.reduce((c,d)=>{const h=d.providerPreferido||"Sin Proveedor";return c[h]||(c[h]=[]),c[h].push(d),c},{}),i=Object.keys(o).sort((c,d)=>c==="Sin Proveedor"?1:d==="Sin Proveedor"?-1:c.localeCompare(d));return e.jsxs("div",{className:"space-y-6",children:[i.map(c=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 pb-2 border-b border-gray-300 mb-4 flex items-center gap-2",children:[e.jsx(w,{name:"store",size:20}),c]}),e.jsx("div",{className:"space-y-3",children:o[c].map(d=>e.jsxs("div",{className:"p-4 bg-red-50 border border-red-300 rounded-lg flex flex-col md:flex-row justify-between md:items-center gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:d.name}),e.jsxs("p",{className:"text-sm text-red-700 font-semibold",children:["Quedan: ",d.currentStock," ",d.unit," (Mín: ",d.minStock," ",d.unit,")"]})]}),e.jsxs("button",{onClick:()=>t(d),className:"flex-shrink-0 flex items-center justify-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm self-start md:self-center",children:[e.jsx(w,{name:"plus-circle",size:16}),"Registrar Compra"]})]},d.id))})]},c)),n&&e.jsx(T,{isOpen:!!n,onClose:()=>t(null),item:n,isAdding:!0,onUpdate:a,providers:x})]})},B=({isOpen:r,onClose:a,onSave:x,onDelete:n,item:t,providers:s,categories:o})=>{const[i,c]=u.useState(""),[d,h]=u.useState(""),[m,b]=u.useState(""),[j,N]=u.useState("0"),[f,g]=u.useState($[0]),[y,S]=u.useState("0"),[P,v]=u.useState("");u.useEffect(()=>{r&&(c((t==null?void 0:t.name)||""),h((t==null?void 0:t.category)||(o.length>0?o[0].name:"")),b((t==null?void 0:t.providerPreferido)||""),N(String((t==null?void 0:t.currentStock)||0)),g((t==null?void 0:t.unit)||$[0]),S(String((t==null?void 0:t.minStock)||0)),v(""))},[r,t,o]);const I=l=>{l.preventDefault(),v("");const k=parseFloat(j),F=parseFloat(y);if(!i.trim()){v("El nombre es obligatorio.");return}if(!f.trim()){v("La unidad es obligatoria.");return}if(isNaN(k)||k<0){v("Stock debe ser un número positivo.");return}if(isNaN(F)||F<0){v("Nivel mínimo debe ser un número positivo.");return}if(t){const E={...t,name:i.trim(),category:d.trim()||"Sin Categoría",providerPreferido:m.trim(),currentStock:k,unit:f.trim(),minStock:F};x(E)}else{const E={name:i.trim(),category:d.trim()||"Sin Categoría",providerPreferido:m.trim(),currentStock:k,unit:f.trim(),minStock:F};x(E)}a()},p=()=>{t&&window.confirm(`¿Estás seguro de que quieres eliminar "${t.name}"?`)&&(n(t.id),a())};return e.jsx(A,{isOpen:r,onClose:a,title:t?"Editar Producto":"Añadir Producto",children:e.jsxs("form",{onSubmit:I,className:"flex flex-col gap-4",children:[e.jsx(C,{label:"Nombre del Producto",children:e.jsx("input",{type:"text",value:i,onChange:l=>c(l.target.value),required:!0})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(C,{label:"Categoría",children:e.jsxs("select",{value:d,onChange:l=>h(l.target.value),children:[e.jsx("option",{value:"",children:"Sin Categoría"}),o.map(l=>e.jsx("option",{value:l.name,children:l.name},l.id))]})}),e.jsx(C,{label:"Proveedor Preferido",children:e.jsxs("select",{value:m,onChange:l=>b(l.target.value),children:[e.jsx("option",{value:"",children:"Sin Proveedor"}),s.map(l=>e.jsx("option",{value:l.name,children:l.name},l.id))]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(C,{label:"Stock Actual",children:e.jsx("input",{type:"number",value:j,onChange:l=>N(l.target.value),step:"any",min:"0",required:!0})}),e.jsx(C,{label:"Unidad",children:e.jsx("select",{value:f,onChange:l=>g(l.target.value),required:!0,children:$.map(l=>e.jsx("option",{value:l,children:l},l))})})]}),e.jsx(C,{label:"Nivel Mínimo (para Alertas)",children:e.jsx("input",{type:"number",value:y,onChange:l=>S(l.target.value),step:"any",min:"0",required:!0})}),P&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:P}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("div",{children:t&&e.jsx("button",{type:"button",onClick:p,className:"py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700",children:"Eliminar"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:a,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Guardar"})]})]})]})})},C=({label:r,children:a})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:r}),H.cloneElement(a,{className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),G=({inventoryHook:r,providers:a,categories:x})=>{const{items:n,addItem:t,updateItem:s,deleteItem:o,recordStockChange:i}=r,[c,d]=u.useState("general"),[h,m]=u.useState(""),[b,j]=u.useState(!1),[N,f]=u.useState(null),g=p=>{f(p),j(!0)},y=()=>{f(null),j(!0)},S=()=>{j(!1),f(null)},P=p=>{"id"in p?s(p):t(p)},v=u.useMemo(()=>n.filter(p=>p.name.toLowerCase().includes(h.toLowerCase())),[n,h]),I=({view:p,label:l,icon:k})=>e.jsxs("button",{onClick:()=>d(p),className:`flex items-center gap-2 py-2 px-4 text-sm md:text-base font-bold border-b-4 transition-colors ${c===p?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-800"}`,children:[e.jsx(w,{name:k,size:18}),l]});return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50",children:[e.jsxs("div",{className:"operations-header flex flex-col md:flex-row md:flex-wrap justify-between items-center p-4 border-b border-gray-200 gap-4 flex-shrink-0",children:[e.jsx("div",{className:"operations-actions",children:e.jsxs("button",{onClick:y,className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(w,{name:"plus-circle",size:16}),"Añadir Producto"]})}),e.jsxs("div",{className:"inventory-tabs flex gap-4",children:[e.jsx(I,{view:"general",label:"Inventario General",icon:"boxes"}),e.jsx(I,{view:"shopping-list",label:"Lista de Compras",icon:"shopping-cart"})]})]}),e.jsx("div",{className:"search-bar-container p-4 flex-shrink-0",children:e.jsx("input",{type:"search",value:h,onChange:p=>m(p.target.value),placeholder:"Buscar producto...",className:"w-full p-3 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("div",{className:"flex-grow overflow-y-auto px-4 pb-4",children:c==="general"?e.jsx(D,{items:v,onEdit:g,onRecordStockChange:i,providers:a}):e.jsx(O,{items:v,onRecordStockChange:i,providers:a})}),e.jsx(B,{isOpen:b,onClose:S,onSave:P,onDelete:o,item:N,providers:a,categories:x})]})};export{G as default};
