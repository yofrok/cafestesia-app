import{r as l,j as e,I as C,T as ge,a as pe,b as fe,O as be}from"./index-CZbgVxal.js";import{M as xe}from"./Modal-CdcBLi0z.js";const ye=[{label:"L",value:"1"},{label:"M",value:"2"},{label:"M",value:"3"},{label:"J",value:"4"},{label:"V",value:"5"},{label:"S",value:"6"},{label:"D",value:"0"}],je=({isOpen:t,onClose:g,onSave:p,onDelete:S,task:a,selectedDate:v,users:w,editMode:x,isSaving:y,allTasks:k})=>{const[j,h]=l.useState(""),[T,E]=l.useState(""),[i,f]=l.useState("08"),[r,c]=l.useState("00"),[n,o]=l.useState("AM"),[d,b]=l.useState("30"),[M,L]=l.useState("pre-apertura"),[z,P]=l.useState(""),[A,D]=l.useState(!1),[W,I]=l.useState(""),[O,X]=l.useState("once"),[J,V]=l.useState([]),[ee,le]=l.useState("4"),[B,te]=l.useState([]),[se,ae]=l.useState(""),[oe,ie]=l.useState(v);l.useEffect(()=>{if(t){const s=w.length>0?w[0].name:"";h((a==null?void 0:a.text)||""),E((a==null?void 0:a.employee)||s),ie((a==null?void 0:a.date)||v);const m=(a==null?void 0:a.time)||"08:00",[q,H]=m.split(":").map(Number),N=q>=12?"PM":"AM";let R=q%12;if(R===0&&(R=12),f(String(R).padStart(2,"0")),c(String(H).padStart(2,"0")),o(N),b(String((a==null?void 0:a.duration)||"30")),L((a==null?void 0:a.shift)||"pre-apertura"),P((a==null?void 0:a.zone)||""),D((a==null?void 0:a.isCritical)||!1),I((a==null?void 0:a.notes)||""),te((a==null?void 0:a.subtasks)||[]),ae(""),a&&x==="future"&&a.recurrenceId){X("weekly");const F=k.filter(K=>K.recurrenceId===a.recurrenceId),_=new Set;F.forEach(K=>{const Z=new Date(K.date);Z.setMinutes(Z.getMinutes()+Z.getTimezoneOffset());const U=Z.getDay();_.add(String(U))}),V(Array.from(_))}else X("once"),V([]);le("4")}},[t,a,w,v,x,k]);const ce=s=>{V(m=>m.includes(s)?m.filter(q=>q!==s):[...m,s])},Q=()=>{if(se.trim()==="")return;const s={id:`sub-${Date.now()}`,text:se.trim(),isCompleted:!1};te([...B,s]),ae("")},de=s=>{s.key==="Enter"&&(s.preventDefault(),Q())},ne=s=>{te(B.filter(m=>m.id!==s))},ue=s=>{if(s.preventDefault(),!j){alert("Por favor completa el nombre de la tarea.");return}if(O==="weekly"&&J.length===0&&x!=="single"){alert("Por favor selecciona al menos un día para la tarea recurrente.");return}let m=parseInt(i,10);n==="PM"&&m!==12?m+=12:n==="AM"&&m===12&&(m=0);const q=`${String(m).padStart(2,"0")}:${r}`,H={text:j,employee:T,time:q,duration:parseInt(d,10),shift:M,zone:z,isCritical:A,date:oe,notes:W,recurrence:O,selectedDays:J,recurrenceWeeks:ee,subtasks:B};p(H,a==null?void 0:a.id)},u=()=>{a&&S(a)},Y=!!a;return e.jsx(xe,{isOpen:t,onClose:y?()=>{}:g,title:a?"Editar Tarea":"Añadir Nueva Tarea",children:e.jsxs("form",{onSubmit:ue,className:"flex flex-col gap-4 max-h-[80vh] overflow-y-auto pr-2",children:[e.jsxs("fieldset",{disabled:y,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Nombre de la Tarea"}),e.jsx("input",{type:"text",value:j,onChange:s=>h(s.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),x==="single"&&e.jsxs("div",{className:"form-group mt-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Fecha"}),e.jsx("input",{type:"date",value:oe,onChange:s=>ie(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("fieldset",{disabled:Y&&x!=="future",className:"mt-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Repetición"}),e.jsxs("div",{className:"flex gap-2 bg-gray-200 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>X("once"),className:`flex-1 p-2 rounded-md text-sm font-bold transition-colors ${O==="once"?"bg-white shadow-sm":""}`,children:"Una vez"}),e.jsx("button",{type:"button",onClick:()=>X("weekly"),className:`flex-1 p-2 rounded-md text-sm font-bold transition-colors ${O==="weekly"?"bg-white shadow-sm":""}`,children:"Semanalmente"})]}),Y&&x==="single"&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"La repetición no se puede cambiar al editar una sola instancia."}),Y&&x==="future"&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 text-sm rounded-r-lg flex items-start gap-3",children:[e.jsx(C,{name:"alert-triangle",size:20,className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"Atención"}),e.jsx("p",{children:"Cambiar la repetición reemplazará todas las futuras tareas de esta serie con un nuevo patrón."})]})]})]}),O==="weekly"&&e.jsxs("div",{className:"flex flex-col gap-4 mt-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Días de la semana"}),e.jsx("div",{className:"flex justify-between gap-1",children:ye.map(({label:s,value:m})=>e.jsx("button",{type:"button",onClick:()=>ce(m),className:`w-9 h-9 flex items-center justify-center font-bold rounded-full border-2 transition-colors ${J.includes(m)?"bg-blue-600 text-white border-blue-600":"bg-gray-100 border-gray-300"}`,children:s},m))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Repetir durante"}),e.jsxs("select",{value:ee,onChange:s=>le(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{value:"4",children:"4 semanas"}),e.jsx("option",{value:"8",children:"8 semanas"}),e.jsx("option",{value:"12",children:"12 semanas"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Empleado"}),e.jsx("select",{value:T,onChange:s=>E(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:w.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Turno"}),e.jsxs("select",{value:M,onChange:s=>L(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{value:"matutino",children:"Matutino"}),e.jsx("option",{value:"pre-apertura",children:"Pre Apertura"}),e.jsx("option",{value:"cierre",children:"Cierre"}),e.jsx("option",{value:"default",children:"Otro"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Hora"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("select",{value:i,onChange:s=>f(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Array.from({length:12},(s,m)=>m+1).map(s=>e.jsx("option",{value:String(s).padStart(2,"0"),children:String(s).padStart(2,"0")},s))}),e.jsx("select",{value:r,onChange:s=>c(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Array.from({length:60},(s,m)=>m).map(s=>e.jsx("option",{value:String(s).padStart(2,"0"),children:String(s).padStart(2,"0")},s))}),e.jsxs("select",{value:n,onChange:s=>o(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{children:"AM"}),e.jsx("option",{children:"PM"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Duración"}),e.jsx("select",{value:d,onChange:s=>b(s.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:ge.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"form-group mt-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Zona (Opcional)"}),e.jsx("input",{type:"text",value:z,onChange:s=>P(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"form-group mt-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Notas (Opcional)"}),e.jsx("textarea",{value:W,onChange:s=>I(s.target.value),rows:3,placeholder:"Añade comentarios o detalles adicionales aquí...",className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"form-group mt-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Subtareas"}),e.jsxs("div",{className:"bg-gray-100 p-3 rounded-lg",children:[B.length>0&&e.jsx("ul",{className:"space-y-2 mb-3",children:B.map(s=>e.jsxs("li",{className:"flex items-center justify-between bg-white p-2 rounded",children:[e.jsx("span",{className:"text-sm text-gray-700",children:s.text}),e.jsx("button",{type:"button",onClick:()=>ne(s.id),className:"p-1 text-gray-400 hover:text-red-600",children:e.jsx(C,{name:"trash-2",size:16})})]},s.id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:se,onChange:s=>ae(s.target.value),onKeyDown:de,placeholder:"Añadir una subtarea...",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-sm"}),e.jsx("button",{type:"button",onClick:Q,className:"py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 text-sm",children:"Añadir"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"task-critical",checked:A,onChange:s=>D(s.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"task-critical",className:"text-sm font-medium text-gray-600",children:"Es una tarea crítica"})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t sticky bottom-0 bg-white",children:[e.jsx("div",{children:a&&e.jsx("button",{type:"button",onClick:u,disabled:y,className:"py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 disabled:bg-red-400",children:"Eliminar Tarea"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:g,disabled:y,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 disabled:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:y,className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 w-36 flex items-center justify-center disabled:bg-blue-400",children:y?e.jsxs(e.Fragment,{children:[e.jsx(C,{name:"refresh-cw",className:"animate-spin mr-2",size:16}),"Guardando..."]}):"Guardar Cambios"})]})]})]})})},Ne=({selectedDate:t,setSelectedDate:g})=>{const[p,S]=l.useState(t),[a,v]=l.useState(""),w=l.useRef(0);l.useEffect(()=>{S(t)},[t]),l.useEffect(()=>{if(a.startsWith("slide-out")){const n=a.includes("left")?"next":"prev",o=setTimeout(()=>{const d=new Date(p);d.setDate(d.getDate()+(n==="prev"?-7:7)),S(d);const b=new Date(t);b.setDate(b.getDate()+(n==="prev"?-7:7)),g(b),v(n==="next"?"slide-in-from-right":"slide-in-from-left")},200);return()=>clearTimeout(o)}else if(a.startsWith("slide-in")){const n=setTimeout(()=>{v("")},200);return()=>clearTimeout(n)}},[a,p,t,g]);const x=n=>{a||v(n==="next"?"slide-out-left":"slide-out-right")},y=n=>{const o=n.target.value;if(o){const d=new Date(o);d.setMinutes(d.getMinutes()+d.getTimezoneOffset()),g(d)}},k=n=>{w.current=n.targetTouches[0].clientX},j=n=>{const o=n.changedTouches[0].clientX,d=50,b=w.current-o;b>d?x("next"):b<-d&&x("prev")},h=new Date;h.setHours(0,0,0,0);const T=new Date(p),E=p.getDay(),i=p.getDate()-E+(E===0?-6:1);T.setDate(i),T.setHours(0,0,0,0);const f=[];for(let n=0;n<7;n++){const o=new Date(T);o.setDate(T.getDate()+n),f.push(o)}const r=(n,o)=>n.getFullYear()===o.getFullYear()&&n.getMonth()===o.getMonth()&&n.getDate()===o.getDate(),c=p.toLocaleDateString("es-ES",{month:"long",year:"numeric"});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 px-2",children:[e.jsx("button",{onClick:()=>x("prev"),className:"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(C,{name:"chevron-left",size:20})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold text-gray-700 capitalize text-sm",children:c}),e.jsxs("div",{className:"relative w-9 h-9 flex items-center justify-center text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors cursor-pointer",title:"Seleccionar fecha",children:[e.jsx(C,{name:"calendar",size:18}),e.jsx("input",{type:"date",onChange:y,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer","aria-label":"Seleccionar fecha"})]})]}),e.jsx("button",{onClick:()=>x("next"),className:"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(C,{name:"chevron-right",size:20})})]}),e.jsx("div",{className:"p-1 bg-gray-200 rounded-lg overflow-hidden relative touch-pan-y",children:e.jsx("div",{className:`flex justify-between items-center gap-1 md:gap-2 ${a}`,onTouchStart:k,onTouchEnd:j,children:f.map(n=>{const o=r(n,t),d=r(n,h);return e.jsx("button",{onClick:()=>g(n),className:"px-1 py-1 md:px-2 md:py-2 rounded-md transition-all duration-200 text-center flex-1",children:e.jsxs("div",{className:`${o?"bg-white shadow-sm rounded-md":""} py-1`,children:[e.jsx("span",{className:`text-xs uppercase font-bold ${o?"text-blue-600":"text-gray-500"}`,children:n.toLocaleDateString("es-ES",{weekday:"short"}).replace(".","")}),e.jsx("p",{className:`font-bold text-lg ${d?"text-blue-600":o?"text-gray-800":"text-gray-600"}`,children:n.getDate()})]})},n.toISOString())})})})]})},ve=t=>{switch(t){case"inprogress":return"opacity-100 animate-pulse-yellow";case"done":return"opacity-50";case"todo":default:return"opacity-100"}},we=({task:t,onUpdateStatus:g,onEdit:p,onViewSubtasks:S,style:a,userColor:v})=>{var f,r;const w=ve(t.status),x=c=>{c.stopPropagation(),t.status==="todo"?g(t.id,"inprogress"):t.status==="inprogress"?g(t.id,"done"):t.status==="done"&&g(t.id,"todo")},y=new Date(`${t.date}T${t.time}`),j=new Date(y.getTime()+t.duration*6e4).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hourCycle:"h23"}),h=((f=t.subtasks)==null?void 0:f.length)||0,T=((r=t.subtasks)==null?void 0:r.filter(c=>c.isCompleted).length)||0,E={...a,borderWidth:"2px",borderColor:t.status==="inprogress"?v:"transparent",backgroundColor:"#f9fafb"},i={color:"#374151"};return e.jsxs("div",{style:E,onClick:S,className:`absolute rounded-lg p-2 flex gap-2 transition-all duration-300 cursor-pointer ${w}`,children:[e.jsx("div",{className:"flex-shrink-0 w-1 h-full rounded-full",style:{backgroundColor:v}}),e.jsxs("div",{className:"flex-grow flex flex-col min-w-0 min-h-0",children:[e.jsxs("div",{className:"flex-grow overflow-hidden",children:[e.jsxs("p",{className:`font-bold text-sm break-words ${t.status==="done"?"line-through":""}`,style:i,children:[t.isCritical&&e.jsx(C,{name:"alert-triangle",size:14,className:"inline-block mr-1 text-red-600",title:"Tarea Crítica"}),t.text]}),e.jsxs("p",{className:`text-xs ${t.status==="done"?"line-through":""}`,style:i,children:[t.time," - ",j," (",t.duration," min)"]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1 flex-shrink-0",children:[e.jsx("span",{className:"text-xs font-bold px-2 py-0.5 rounded-full bg-white/60",style:i,children:t.employee}),e.jsxs("div",{className:"flex items-center gap-2",style:i,children:[t.notes&&t.notes.trim()!==""&&e.jsx(C,{name:"message-square",size:14,title:"Esta tarea tiene notas"}),h>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs font-semibold",children:[e.jsx(C,{name:"list",size:14}),e.jsxs("span",{children:[T,"/",h]})]}),e.jsx("button",{onClick:c=>{c.stopPropagation(),p(t)},className:"p-1 rounded-full hover:bg-black/10 transition-colors",title:"Editar Tarea",children:e.jsx(C,{name:"pencil",size:14})})]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:x,className:"w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all",style:{borderColor:t.status==="done"?"#4ade80":"#9ca3af",backgroundColor:t.status==="done"?"#4ade80":"white"},children:[t.status==="inprogress"&&e.jsx("div",{className:"w-2.5 h-2.5 bg-yellow-500 rounded-full"}),t.status==="done"&&e.jsx(C,{name:"check",size:16,className:"text-white"})]})})]})},Se=({task:t,onClose:g,onUpdateTask:p})=>{var T,E;const[S,a]=l.useState(""),v=i=>{const f=(t.subtasks||[]).map(r=>r.id===i?{...r,isCompleted:!r.isCompleted}:r);p({...t,subtasks:f})},w=()=>{if(S.trim()==="")return;const i={id:`sub-${Date.now()}`,text:S.trim(),isCompleted:!1},f=[...t.subtasks||[],i];p({...t,subtasks:f}),a("")},x=i=>{const f=(t.subtasks||[]).filter(r=>r.id!==i);p({...t,subtasks:f})},y=i=>{i.key==="Enter"&&(i.preventDefault(),w())},k=((T=t.subtasks)==null?void 0:T.filter(i=>i.isCompleted).length)||0,j=((E=t.subtasks)==null?void 0:E.length)||0,h=j>0?k/j*100:0;return e.jsx("div",{className:"absolute inset-0 bg-gray-900/40 z-50 flex justify-center items-center p-4",onClick:g,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md flex flex-col",onClick:i=>i.stopPropagation(),children:[e.jsxs("header",{className:"p-4 border-b",children:[e.jsx("h3",{className:"font-bold text-lg text-blue-700",children:t.text}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.time," - ",t.employee]})]}),e.jsxs("div",{className:"p-4 flex-grow overflow-y-auto max-h-[50vh]",children:[t.notes&&t.notes.trim()!==""&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-2",children:"Notas"}),e.jsx("div",{className:"p-3 bg-yellow-50 border-l-4 border-yellow-400 text-gray-800 text-sm rounded-r-lg whitespace-pre-wrap",children:t.notes})]}),j>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Progreso de Subtareas"}),e.jsxs("span",{children:[k," / ",j]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${h}%`}})})]}),e.jsx("div",{className:"space-y-2",children:(t.subtasks||[]).map(i=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-md group",children:[e.jsx("input",{type:"checkbox",checked:i.isCompleted,onChange:()=>v(i.id),className:"w-5 h-5 rounded text-blue-600 focus:ring-blue-500 flex-shrink-0"}),e.jsx("span",{className:`flex-grow text-gray-800 ${i.isCompleted?"line-through text-gray-400":""}`,children:i.text}),e.jsx("button",{onClick:()=>x(i.id),className:"p-1 text-gray-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(C,{name:"trash-2",size:16})})]},i.id))}),j===0&&(!t.notes||t.notes.trim()==="")&&e.jsx("p",{className:"text-center text-gray-500 py-6",children:"No hay subtareas ni notas. ¡Añade la primera!"})]}),e.jsx("div",{className:"p-4 border-t bg-gray-50 rounded-b-xl",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:S,onChange:i=>a(i.target.value),onKeyDown:y,placeholder:"Añadir nueva subtarea...",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-sm focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:w,className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 text-sm",children:"Añadir"})]})})]})})},he=120,Te=30,De=({tasks:t,onUpdateStatus:g,onEditTask:p,onUpdateTask:S,users:a})=>{const[v,w]=l.useState(new Date),[x,y]=l.useState(null),k=l.useMemo(()=>a.reduce((r,c)=>(r[c.name]=c.color,r),{}),[a]);l.useEffect(()=>{const r=setInterval(()=>w(new Date),6e4);return()=>clearInterval(r)},[]),l.useEffect(()=>{if(x){const r=t.find(c=>c.id===x.id);y(r||null)}},[t,x]);const j=l.useMemo(()=>{const r={};return t.forEach(c=>{const n=parseInt(c.time.split(":")[0],10);r[n]=!0}),r},[t]),h=l.useMemo(()=>{let r=0;const c=[];for(let n=fe;n<=pe;n++){const d=!!j[n]?he:Te;c.push({hour:n,top:r,height:d}),r+=d}return c},[j]),T=h.length>0?h[h.length-1].top+h[h.length-1].height:0,E=r=>{const[c,n]=r.split(":").map(Number),o=h.find(b=>b.hour===c);if(!o)return 0;const d=n/60*o.height;return o.top+d},i=l.useMemo(()=>{const r=[...t].sort((n,o)=>n.time.localeCompare(o.time)||o.duration-n.duration),c=[];for(const n of r){const o=E(n.time),d=new Date(`${n.date}T${n.time}`).getTime(),b=d+n.duration*6e4,M=h.find(D=>D.hour===parseInt(n.time.split(":")[0],10)),L=M?M.height:he,z=n.duration/60*L,P=[];for(const D of c){const W=new Date(`${D.task.date}T${D.task.time}`).getTime(),I=W+D.task.duration*6e4;d<I&&b>W&&P.push(D)}let A=0;for(;P.some(D=>D.left===A);)A++;c.push({task:n,top:o,height:z,left:A,width:1,zIndex:A})}return c.map((n,o,d)=>{const{task:b}=n,M=new Date(`${b.date}T${b.time}`).getTime(),L=M+b.duration*6e4,z=d.filter(I=>{const O=new Date(`${I.task.date}T${I.task.time}`).getTime(),X=O+I.task.duration*6e4;return M<X&&L>O}),P=new Set(z.map(I=>I.left)),A=P.size;let D=0;return D=Array.from(P).sort((I,O)=>I-O).indexOf(n.left),{...n,width:100/A,left:D/A*100}})},[t,h]),f=E(`${v.getHours()}:${v.getMinutes()}`);return e.jsxs("div",{className:"p-4 md:p-6 h-full relative",children:[e.jsxs("div",{className:"relative z-10",style:{height:`${T}px`},children:[h.map(({hour:r,top:c,height:n})=>e.jsxs("div",{className:"absolute w-full",style:{top:`${c}px`,height:`${n}px`},children:[e.jsxs("span",{className:"absolute -top-3 left-0 text-sm font-semibold text-gray-400 w-16 text-right pr-4",children:[r,":00"]}),e.jsx("div",{className:"h-px bg-gray-200 ml-16"})]},r)),f>=0&&f<=T&&e.jsx("div",{className:"absolute left-16 right-0 h-0.5 bg-red-500 z-20",style:{top:`${f}px`},children:e.jsx("div",{className:"absolute -left-1.5 -top-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white"})}),e.jsx("div",{className:"absolute top-0 bottom-0 left-16 right-0",children:i.map(({task:r,top:c,height:n,left:o,width:d,zIndex:b})=>e.jsx(we,{task:r,onUpdateStatus:g,onEdit:p,onViewSubtasks:()=>y(r),userColor:k[r.employee]||"#9ca3af",style:{top:`${c}px`,height:`${Math.max(n-4,80)}px`,left:`${o}%`,width:`calc(${d}% - 4px)`,zIndex:b}},r.id))})]}),x&&e.jsx(Se,{task:x,onClose:()=>y(null),onUpdateTask:S})]})},Ce=t=>t>0?`en ${t} min`:t===0?"¡Ahora!":`hace ${Math.abs(t)} min`,Ee=({tasksWithDiff:t})=>e.jsxs("div",{className:"bg-yellow-100 border-b-2 border-yellow-300 p-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(C,{name:"alert-triangle",className:"text-yellow-600",size:20}),e.jsx("h3",{className:"font-bold text-yellow-800 text-base",children:"Tareas Críticas Próximas"})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:t.map(({task:g,diff:p})=>e.jsxs("div",{className:"bg-white/70 p-2 rounded-lg border border-yellow-300 flex-shrink-0 w-60",children:[e.jsx("p",{className:"font-bold text-sm text-gray-800 truncate",children:g.text}),e.jsxs("p",{className:`text-xs font-semibold ${p<=0?"text-red-600 animate-pulse":"text-blue-600"}`,children:[g.time," (",Ce(p),")"]})]},g.id))})]}),Me=({isOpen:t,onClose:g,onSelectThisOne:p,onSelectFuture:S,isDelete:a=!1})=>{const w=`¿Qué tareas quieres ${a?"eliminar":"editar"}?`,x=a?"Eliminar solo esta tarea":"Editar solo esta tarea",y="La acción solo se aplicará a esta instancia. El resto de la serie no se verá afectado.",k=a?"Eliminar esta y futuras tareas":"Editar esta y futuras tareas",j="La acción se aplicará a esta y a todas las repeticiones futuras de la serie.",h=a?"trash-2":"pencil";return e.jsx(xe,{isOpen:t,onClose:g,title:w,children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("button",{onClick:p,className:"p-4 bg-gray-100 rounded-lg border-2 border-transparent hover:border-blue-500 transition-all text-left",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{name:h,size:24,className:"text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-800",children:x}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:y})]})]})}),e.jsx("button",{onClick:S,className:"p-4 bg-gray-100 rounded-lg border-2 border-transparent hover:border-blue-500 transition-all text-left",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{name:"calendar",size:24,className:"text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-800",children:k}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:j})]})]})}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:g,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"})})]})})},Oe=({kanbanHook:t,criticalTasks:g,users:p})=>{const{tasks:S,addTask:a,addMultipleTasks:v,updateTask:w,updateTaskStatus:x,deleteTask:y,updateFutureTasks:k,deleteFutureTasks:j}=t,[h,T]=l.useState(new Date),[E,i]=l.useState(!1),[f,r]=l.useState(null),[c,n]=l.useState("All"),[o,d]=l.useState(null),[b,M]=l.useState(null),[L,z]=l.useState("new"),[P,A]=l.useState(null),[D,W]=l.useState(!1),[I,O]=l.useState(""),[X,J]=l.useState(""),[V,ee]=l.useState(!1),le=u=>{u.recurrenceId?(M("edit"),d(u)):(z("single"),r(u),i(!0))},B=()=>{i(!1),r(null),z("new")},te=async(u,Y)=>{const{recurrence:s,selectedDays:m,recurrenceWeeks:q,...H}=u;ee(!0);try{if(Y&&f)if(L==="future")if(s==="weekly"&&m&&m.length>0){await j(f);const N=new Date(f.date);N.setMinutes(N.getMinutes()+N.getTimezoneOffset());const R=parseInt(q||"4",10),F=[],_=new Date(N),K=N.getDay(),Z=N.getDate()-K+(K===0?-6:1);_.setDate(Z);for(let U=0;U<R;U++){const G=new Date(_);G.setDate(_.getDate()+U*7),m.forEach(me=>{const re=parseInt(me,10),$=new Date(G);re===0?$.setDate(G.getDate()+6):$.setDate(G.getDate()+(re-1)),$.getTime()>=N.getTime()&&($.setMinutes($.getMinutes()-$.getTimezoneOffset()),F.push({...H,date:$.toISOString().split("T")[0]}))})}await v(F)}else{const{date:N,time:R,...F}=H;await k(f,F)}else{const{recurrenceId:N,...R}=f,F={...R,...H,id:Y};await w(F)}else{const N=new Date(H.date);if(N.setMinutes(N.getMinutes()+N.getTimezoneOffset()),s==="weekly"&&m&&m.length>0){const R=parseInt(q||"4",10),F=[],_=new Date(N),K=N.getDay(),Z=N.getDate()-K+(K===0?-6:1);_.setDate(Z);for(let U=0;U<R;U++){const G=new Date(_);G.setDate(_.getDate()+U*7),m.forEach(me=>{const re=parseInt(me,10),$=new Date(G);re===0?$.setDate(G.getDate()+6):$.setDate(G.getDate()+(re-1)),$.setMinutes($.getMinutes()-$.getTimezoneOffset()),F.push({...H,date:$.toISOString().split("T")[0]})})}await v(F)}else await a(H)}B()}catch(N){console.error("Error saving task:",N)}finally{ee(!1)}},se=u=>{i(!1),r(null),u.recurrenceId?(M("delete"),d(u)):Q(()=>y(u.id))},ae=()=>{o&&(z("single"),r(o),i(!0),d(null),M(null))},oe=()=>{o&&(z("future"),r(o),i(!0),d(null),M(null))},ie=()=>{o&&(Q(()=>{y(o.id)}),d(null),M(null))},ce=()=>{o&&(Q(()=>j(o)),d(null),M(null))},Q=u=>{A(()=>u),W(!0),O(""),J("")},de=()=>{I===be?(P==null||P(),W(!1),A(null)):(J("PIN incorrecto. Inténtalo de nuevo."),O(""))},ne=l.useMemo(()=>{const u=new Date(h);return u.setMinutes(u.getMinutes()-u.getTimezoneOffset()),u.toISOString().split("T")[0]},[h]),ue=l.useMemo(()=>S.filter(u=>{const Y=u.date===ne,s=c==="All"||u.employee===c;return Y&&s}),[S,ne,c]);return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50",children:[g.length>0&&e.jsx(Ee,{tasksWithDiff:g}),e.jsxs("div",{className:"operations-header flex flex-col p-4 border-b border-gray-200 gap-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center w-full gap-4",children:[e.jsx(Ne,{selectedDate:h,setSelectedDate:T}),e.jsx("div",{className:"flex gap-2 w-full md:w-auto",children:e.jsxs("button",{onClick:()=>{z("new"),r(null),i(!0)},className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm w-full justify-center",children:[e.jsx(C,{name:"plus-circle",size:16}),"Añadir Tarea"]})})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-200 rounded-lg p-1 w-full overflow-x-auto",children:[e.jsx("button",{onClick:()=>n("All"),className:`px-3 py-1 text-sm font-bold rounded-md transition-colors ${c==="All"?"bg-white shadow-sm":"bg-transparent text-gray-600"}`,children:"Todos"}),p.map(u=>e.jsx("button",{onClick:()=>n(u.name),className:`px-3 py-1 text-sm font-bold rounded-md transition-colors ${c===u.name?"bg-white shadow-sm":"bg-transparent text-gray-600"}`,children:u.name},u.id))]})]}),e.jsx("div",{className:"flex-grow overflow-auto relative",children:e.jsx(De,{tasks:ue,onEditTask:le,onUpdateStatus:x,onUpdateTask:w,users:p})}),e.jsx(je,{isOpen:E,onClose:B,onSave:te,onDelete:se,task:f,selectedDate:ne,users:p,editMode:L,isSaving:V,allTasks:S}),e.jsx(Me,{isOpen:!!o,onClose:()=>d(null),onSelectThisOne:b==="edit"?ae:ie,onSelectFuture:b==="edit"?oe:ce,isDelete:b==="delete"}),D&&e.jsx(xe,{isOpen:D,onClose:()=>W(!1),title:"Confirmar Acción",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"font-bold text-lg text-gray-800",children:"Acción Protegida"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2 mb-4",children:"Para continuar, introduce el PIN de operaciones."}),e.jsx("input",{type:"password",value:I,onChange:u=>{O(u.target.value),J("")},placeholder:"PIN de Seguridad",autoFocus:!0,className:"w-full p-2 border border-gray-300 rounded-md text-center"}),X&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:X}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{onClick:()=>W(!1),className:"flex-1 py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{onClick:de,className:"flex-1 py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Confirmar"})]})]})})]})};export{Oe as default};
