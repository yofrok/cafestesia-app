import{r as f,j as e,I as b}from"./index-CX_C9JaK.js";import{M as P}from"./Modal-XGf6XRlw.js";const M=({isOpen:r,onClose:a,onSelectRecipe:l,onSelectHeating:i,recipes:x})=>{var d;const[t,o]=f.useState(null),g=s=>{!s.variants||s.variants.length===0?(l(s),a()):o(s)},m=s=>{t&&l(t,s),c(),a()},c=()=>{o(null)},u=(s,j)=>{c(),i(s,j),a()},p=t?`Variantes de: ${t.name}`:"Iniciar un Nuevo Proceso";return e.jsx(P,{isOpen:r,onClose:a,title:p,children:t?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>m("base"),className:"w-full p-4 bg-blue-100 text-blue-800 rounded-lg border border-blue-200 hover:bg-blue-200 hover:border-blue-300 transition-colors text-left",children:[e.jsx("p",{className:"font-bold",children:t.baseVariantName||"Receta Estándar"}),t.baseVariantDescription&&e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:t.baseVariantDescription})]}),(d=t.variants)==null?void 0:d.map(s=>e.jsxs("button",{onClick:()=>m(s.id),className:"w-full p-4 bg-gray-100 text-gray-800 rounded-lg border border-gray-200 hover:bg-gray-200 hover:border-gray-300 transition-colors text-left",children:[e.jsx("p",{className:"font-bold",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description})]},s.id)),e.jsx("button",{onClick:c,className:"mt-4 text-sm text-gray-600 hover:underline font-semibold",children:"← Volver a recetas"})]}):e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-blue-700 mb-2",children:"Recetas de Horneado"}),e.jsx("div",{className:"flex flex-col gap-3",children:x.map(s=>e.jsxs("button",{onClick:()=>g(s),className:"w-full p-4 bg-gray-100 text-gray-800 font-bold rounded-lg border border-gray-200 hover:bg-gray-200 hover:border-gray-300 transition-colors text-left",children:["Hornear ",s.name]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-blue-700 mb-2",children:"Procesos de Calentamiento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>u(15*60,"Precalentar (15 min)"),className:"w-full p-4 flex items-center justify-center gap-2 bg-gray-100 text-gray-800 font-bold rounded-lg border border-gray-200 hover:bg-gray-200 hover:border-gray-300 transition-colors",children:[e.jsx(b,{name:"thermometer-snowflake",size:20})," Precalentar"]}),e.jsxs("button",{onClick:()=>u(7*60,"Recalentar (7 min)"),className:"w-full p-4 flex items-center justify-center gap-2 bg-gray-100 text-gray-800 font-bold rounded-lg border border-gray-200 hover:bg-gray-200 hover:border-gray-300 transition-colors",children:[e.jsx(b,{name:"thermometer-sun",size:20})," Recalentar"]})]})]})]})})},S=r=>{(isNaN(r)||r<0)&&(r=0);const a=Math.floor(r/60),l=r%60;return`${String(a).padStart(2,"0")}:${String(l).padStart(2,"0")}`},$=({step:r,isCompleted:a,isCurrent:l})=>{let i="text-gray-500";return l&&(i="font-bold text-blue-700"),a&&(i="text-gray-400 line-through"),e.jsxs("div",{className:"flex items-start gap-3 py-2",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:a?e.jsx(b,{name:"check-circle",size:16,className:"text-green-500"}):e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${l?"border-blue-500 bg-blue-100":"border-gray-300"}`})}),e.jsx("p",{className:`text-sm ${i}`,children:r.instruction})]})},C=({process:r,onAdvance:a,onTogglePause:l,onCancel:i,onAcknowledgeFinish:x,isAudioReady:t})=>{const{state:o,name:g,steps:m,currentStepIndex:c,totalTimeLeft:u,stepTimeLeft:p}=r,[d,s]=f.useState(!1),j=()=>{switch(o){case"running":return"border-green-500";case"alarm":return"border-red-500 animate-pulse-red";case"finished":return"border-blue-500";case"intermission":return"border-yellow-500 animate-pulse-yellow";case"paused":return"border-gray-300";default:return"border-gray-300"}},N=()=>{switch(o){case"running":return"bg-green-100 text-green-800";case"alarm":return"bg-red-100 text-red-800";case"finished":return"bg-blue-100 text-blue-800";case"intermission":return"bg-yellow-100 text-yellow-800";case"paused":return"bg-gray-100 text-gray-800";default:return"bg-gray-100"}},h=()=>{switch(o){case"paused":case"intermission":return e.jsx("button",{onClick:()=>l(r.id),disabled:!t,className:"w-full bg-green-500 text-white font-bold py-3 rounded-lg hover:bg-green-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:t?"INICIAR":"Cargando audio..."});case"running":return e.jsx("button",{onClick:()=>l(r.id),className:"w-full bg-yellow-500 text-white font-bold py-3 rounded-lg hover:bg-yellow-600 transition-colors",children:"PAUSAR"});case"alarm":return e.jsx("button",{onClick:()=>a(r.id),className:"w-full bg-blue-500 text-white font-bold py-3 rounded-lg hover:bg-blue-600 transition-colors animate-pulse",children:"SIGUIENTE PASO"});case"finished":return e.jsx("button",{onClick:()=>x(r),className:"w-full bg-gray-500 text-white font-bold py-3 rounded-lg hover:bg-gray-600 transition-colors",children:"LIMPIAR"})}};return d?e.jsxs("div",{className:"flex flex-col bg-white rounded-lg border-2 border-red-400 shadow-lg p-4 justify-center items-center text-center",children:[e.jsx("h4",{className:"font-bold text-lg mb-2 text-gray-800",children:"¿Estás seguro?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Se perderá todo el progreso de este proceso."}),e.jsxs("div",{className:"flex gap-4 w-full",children:[e.jsx("button",{onClick:()=>s(!1),className:"flex-1 py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"No, volver"}),e.jsx("button",{onClick:()=>i(r.id),className:"flex-1 py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700",children:"Sí, cancelar"})]})]}):e.jsxs("div",{className:`flex flex-col bg-white rounded-lg border-2 shadow-sm ${j()}`,children:[e.jsx("header",{className:`p-3 rounded-t-md ${N()}`,children:e.jsx("h3",{className:"font-bold text-lg",children:g})}),e.jsxs("div",{className:"p-4 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{className:"timers flex justify-around text-center mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase font-bold",children:"Total Restante"}),e.jsx("p",{className:"text-3xl font-bold",children:S(u)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase font-bold",children:"Paso Actual"}),e.jsx("p",{className:"text-3xl font-bold",children:S(p)})]})]}),e.jsxs("div",{className:"steps-list mb-4 p-3 bg-gray-50 rounded-lg max-h-56 overflow-y-auto border border-gray-200",children:[m.map((v,y)=>e.jsx($,{step:v,isCompleted:y<c,isCurrent:y===c&&o!=="finished"},y)),o==="finished"&&e.jsxs("div",{className:"flex items-start gap-3 py-2 text-green-700 font-bold",children:[e.jsx(b,{name:"check-circle",size:16,className:"mt-1"}),e.jsx("p",{className:"text-sm",children:"¡Proceso completado!"})]})]}),e.jsxs("div",{className:"action-buttons space-y-2",children:[h(),o!=="finished"&&e.jsx("button",{onClick:()=>s(!0),className:"w-full text-center text-xs text-gray-500 hover:text-red-600 font-semibold py-1 transition-colors",children:"Cancelar Proceso"})]})]})]})},E=({rating:r,setRating:a})=>e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3,4,5].map(l=>e.jsx("button",{type:"button",onClick:()=>a(l),onMouseEnter:()=>{},onMouseLeave:()=>{},className:"transition-transform transform hover:scale-125",children:e.jsx(b,{name:"star",size:40,className:`cursor-pointer ${l<=r?"text-yellow-400 fill-current":"text-gray-300"}`})},l))}),H=({isOpen:r,processName:a,onSave:l,onSkip:i})=>{const[x,t]=f.useState(3),[o,g]=f.useState(""),m=()=>{l(x,o)};return e.jsx(P,{isOpen:r,onClose:i,title:`Feedback para: ${a}`,children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"¿Qué tal salió el resultado?"}),e.jsx(E,{rating:x,setRating:t})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedback-notes",className:"block text-sm font-medium text-gray-600 mb-1",children:"Notas (Opcional)"}),e.jsx("textarea",{id:"feedback-notes",value:o,onChange:c=>g(c.target.value),rows:4,placeholder:"Ej: El color fue perfecto, pero la próxima vez intentaré con 1 minuto menos...",className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("button",{type:"button",onClick:i,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Omitir"}),e.jsx("button",{type:"button",onClick:m,className:"py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Guardar"})]})]})})},V=({productionHook:r,recipeLogHook:a,recipesHook:l})=>{const[i,x]=f.useState(!1),[t,o]=f.useState(null),{processes:g,startBakingProcess:m,startHeatingProcess:c,advanceProcess:u,togglePauseProcess:p,cancelProcess:d,isSoundMuted:s,toggleSoundMute:j,isAudioReady:N,isSuspended:h,unlockAudio:v}=r,{addFeedback:y}=a,{recipes:I}=l,R=n=>{n.type==="baking"&&n.recipeId?o(n):d(n.id)},A=(n,z)=>{t&&t.recipeId&&(y({recipeId:t.recipeId,rating:n,notes:z}),d(t.id)),o(null)},F=()=>{t&&d(t.id),o(null)},w=g.filter(n=>n.state!=="finished"),k=g.filter(n=>n.state==="finished");return e.jsxs("div",{className:"p-4 md:p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-xl font-bold text-blue-700",children:"Procesos Activos"}),e.jsx("button",{onClick:h?v:j,title:h?"Sonidos bloqueados por el navegador. Haz clic para activar.":s?"Activar Sonidos":"Silenciar Sonidos",className:`p-2 rounded-full transition-colors ${h?"text-yellow-600 animate-pulse":"text-gray-500 hover:text-blue-600 hover:bg-gray-100"}`,children:e.jsx(b,{name:s||h?"volume-x":"volume-2",size:20})})]}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(b,{name:"plus-circle",size:16}),"Iniciar Proceso"]})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto",children:[w.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:w.map(n=>e.jsx(C,{process:n,onAdvance:u,onTogglePause:p,onCancel:d,onAcknowledgeFinish:()=>{},isAudioReady:N},n.id))}):e.jsxs("div",{className:"text-center py-16 text-gray-500",children:[e.jsx("p",{children:"No hay procesos activos en este momento."}),e.jsx("p",{children:'Haz clic en "Iniciar Proceso" para comenzar.'})]}),k.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-600",children:"Finalizados Recientemente"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:k.map(n=>e.jsx(C,{process:n,onAdvance:u,onTogglePause:()=>{},onCancel:d,onAcknowledgeFinish:()=>R(n),isAudioReady:N},n.id))})]})]}),e.jsx(M,{isOpen:i,onClose:()=>x(!1),onSelectRecipe:m,onSelectHeating:c,recipes:I}),t&&e.jsx(H,{isOpen:!!t,processName:t.name,onSave:A,onSkip:F})]})};export{V as default};
