import{r as o,j as e,I as A,T as Se,a as de,b as ge,O as Te}from"./index-B_fH8Xl6.js";import{M as Ne}from"./Modal-09WXJ7L2.js";const Me=[{label:"L",value:"1"},{label:"M",value:"2"},{label:"M",value:"3"},{label:"J",value:"4"},{label:"V",value:"5"},{label:"S",value:"6"},{label:"D",value:"0"}],De=({isOpen:a,onClose:g,onSave:f,onDelete:E,task:s,selectedDate:I,users:w,editMode:N,isSaving:M,allTasks:F})=>{const[v,D]=o.useState(""),[O,z]=o.useState(""),[d,S]=o.useState("08"),[y,n]=o.useState("00"),[T,m]=o.useState("AM"),[j,p]=o.useState("30"),[t,i]=o.useState("pre-apertura"),[l,c]=o.useState(""),[u,h]=o.useState(!1),[P,_]=o.useState(""),[$,R]=o.useState("once"),[K,Y]=o.useState([]),[J,ue]=o.useState("4"),[U,Q]=o.useState([]),[ee,ne]=o.useState(""),[me,le]=o.useState(I),[X,xe]=o.useState(!0),[oe,te]=o.useState("");o.useEffect(()=>{if(a){const r=w.length>0?w[0].name:"";xe(!!(s!=null&&s.date)||N==="new"),D((s==null?void 0:s.text)||""),z((s==null?void 0:s.employee)||r),te((s==null?void 0:s.addedBy)||r),le((s==null?void 0:s.date)||I);const b=(s==null?void 0:s.time)||"08:00",[k,re]=b.split(":").map(Number),W=k>=12?"PM":"AM";let C=k%12;if(C===0&&(C=12),S(String(C).padStart(2,"0")),n(String(re).padStart(2,"0")),m(W),p(String((s==null?void 0:s.duration)||"30")),i((s==null?void 0:s.shift)||"pre-apertura"),c((s==null?void 0:s.zone)||""),h((s==null?void 0:s.isCritical)||!1),_((s==null?void 0:s.notes)||""),Q((s==null?void 0:s.subtasks)||[]),ne(""),s&&N==="future"&&s.recurrenceId){R("weekly");const V=F.filter(B=>B.recurrenceId===s.recurrenceId),L=new Set;V.forEach(B=>{if(B.date){const G=new Date(B.date);G.setMinutes(G.getMinutes()+G.getTimezoneOffset());const ie=G.getDay();L.add(String(ie))}}),Y(Array.from(L))}else R("once"),Y([]);ue("4")}},[a,s,w,I,N,F]);const be=r=>{Y(b=>b.includes(r)?b.filter(k=>k!==r):[...b,r])},se=()=>{if(ee.trim()==="")return;const r={id:`sub-${Date.now()}`,text:ee.trim(),isCompleted:!1};Q([...U,r]),ne("")},ae=r=>{r.key==="Enter"&&(r.preventDefault(),se())},ye=r=>{Q(U.filter(b=>b.id!==r))},he=r=>{if(r.preventDefault(),!v||!oe){alert("Por favor completa el nombre de la tarea y quién la añadió.");return}if(X&&$==="weekly"&&K.length===0&&N!=="single"){alert("Por favor selecciona al menos un día para la tarea recurrente.");return}let b=parseInt(d,10);T==="PM"&&b!==12?b+=12:T==="AM"&&b===12&&(b=0);const k=`${String(b).padStart(2,"0")}:${y}`,re={text:v,employee:O,addedBy:oe,duration:parseInt(j,10),shift:t,zone:l,isCritical:u,notes:P,subtasks:U,...X&&{time:k,date:me,recurrence:$,selectedDays:K,recurrenceWeeks:J}};f(re,s==null?void 0:s.id)},pe=()=>{s&&E(s)},x=!!s;return e.jsx(Ne,{isOpen:a,onClose:M?()=>{}:g,title:s?"Editar Tarea":"Añadir Nueva Tarea",children:e.jsxs("form",{onSubmit:he,className:"flex flex-col gap-4 max-h-[80vh] overflow-y-auto pr-2",children:[e.jsxs("fieldset",{disabled:M,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Nombre de la Tarea"}),e.jsx("input",{type:"text",value:v,onChange:r=>D(r.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Asignada a"}),e.jsx("select",{value:O,onChange:r=>z(r.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:w.map(r=>e.jsx("option",{value:r.name,children:r.name},r.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Añadida por"}),e.jsx("select",{value:oe,onChange:r=>te(r.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:w.map(r=>e.jsx("option",{value:r.name,children:r.name},r.id))})]})]}),e.jsx("div",{className:"form-group mt-4 p-3 bg-gray-100 rounded-lg",children:e.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Planificar fecha y hora"}),e.jsx("div",{className:`w-11 h-6 rounded-full p-1 transition-colors ${X?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full shadow-md transform transition-transform ${X?"translate-x-5":""}`})}),e.jsx("input",{type:"checkbox",checked:X,onChange:r=>{const b=r.target.checked;if(xe(b),b&&!(s!=null&&s.date)){const k=new Date;k.setMinutes(k.getMinutes()-k.getTimezoneOffset()),le(k.toISOString().split("T")[0])}},className:"hidden"})]})}),X&&e.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[(N==="single"||N==="new")&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Fecha"}),e.jsx("input",{type:"date",value:me,onChange:r=>le(r.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("fieldset",{disabled:x&&N!=="future",className:"",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Repetición"}),e.jsxs("div",{className:"flex gap-2 bg-gray-200 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>R("once"),className:`flex-1 p-2 rounded-md text-sm font-bold transition-colors ${$==="once"?"bg-white shadow-sm":""}`,children:"Una vez"}),e.jsx("button",{type:"button",onClick:()=>R("weekly"),className:`flex-1 p-2 rounded-md text-sm font-bold transition-colors ${$==="weekly"?"bg-white shadow-sm":""}`,children:"Semanalmente"})]}),x&&N==="single"&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"La repetición no se puede cambiar al editar una sola instancia."}),x&&N==="future"&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 text-sm rounded-r-lg flex items-start gap-3",children:[e.jsx(A,{name:"alert-triangle",size:20,className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"Atención"}),e.jsx("p",{children:"Cambiar la repetición reemplazará todas las futuras tareas de esta serie."})]})]})]}),$==="weekly"&&e.jsxs("div",{className:"flex flex-col gap-4 mt-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Días de la semana"}),e.jsx("div",{className:"flex justify-between gap-1",children:Me.map(({label:r,value:b})=>e.jsx("button",{type:"button",onClick:()=>be(b),className:`w-9 h-9 flex items-center justify-center font-bold rounded-full border-2 transition-colors ${K.includes(b)?"bg-blue-600 text-white border-blue-600":"bg-gray-100 border-gray-300"}`,children:r},b))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Repetir durante"}),e.jsxs("select",{value:J,onChange:r=>ue(r.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{value:"4",children:"4 semanas"}),e.jsx("option",{value:"8",children:"8 semanas"}),e.jsx("option",{value:"12",children:"12 semanas"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Hora"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("select",{value:d,onChange:r=>S(r.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Array.from({length:12},(r,b)=>b+1).map(r=>e.jsx("option",{value:String(r).padStart(2,"0"),children:String(r).padStart(2,"0")},r))}),e.jsx("select",{value:y,onChange:r=>n(r.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Array.from({length:60},(r,b)=>b).map(r=>e.jsx("option",{value:String(r).padStart(2,"0"),children:String(r).padStart(2,"0")},r))}),e.jsxs("select",{value:T,onChange:r=>m(r.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{children:"AM"}),e.jsx("option",{children:"PM"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Turno"}),e.jsxs("select",{value:t,onChange:r=>i(r.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{value:"matutino",children:"Matutino"}),e.jsx("option",{value:"pre-apertura",children:"Pre Apertura"}),e.jsx("option",{value:"cierre",children:"Cierre"}),e.jsx("option",{value:"default",children:"Otro"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Duración Estimada"}),e.jsx("select",{value:j,onChange:r=>p(r.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Se.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Zona (Opcional)"}),e.jsx("input",{type:"text",value:l,onChange:r=>c(r.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]})]}),e.jsxs("div",{className:"form-group mt-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Notas (Opcional)"}),e.jsx("textarea",{value:P,onChange:r=>_(r.target.value),rows:3,placeholder:"Añade comentarios o detalles adicionales aquí...",className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"form-group mt-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Subtareas"}),e.jsxs("div",{className:"bg-gray-100 p-3 rounded-lg",children:[U.length>0&&e.jsx("ul",{className:"space-y-2 mb-3",children:U.map(r=>e.jsxs("li",{className:"flex items-center justify-between bg-white p-2 rounded",children:[e.jsx("span",{className:"text-sm text-gray-700",children:r.text}),e.jsx("button",{type:"button",onClick:()=>ye(r.id),className:"p-1 text-gray-400 hover:text-red-600",children:e.jsx(A,{name:"trash-2",size:16})})]},r.id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:ee,onChange:r=>ne(r.target.value),onKeyDown:ae,placeholder:"Añadir una subtarea...",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-sm"}),e.jsx("button",{type:"button",onClick:se,className:"py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 text-sm",children:"Añadir"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"task-critical",checked:u,onChange:r=>h(r.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"task-critical",className:"text-sm font-medium text-gray-600",children:"Es una tarea crítica"})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t sticky bottom-0 bg-white",children:[e.jsx("div",{children:s&&e.jsx("button",{type:"button",onClick:pe,disabled:M,className:"py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 disabled:bg-red-400",children:"Eliminar"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:g,disabled:M,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 disabled:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:M,className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 w-36 flex items-center justify-center disabled:bg-blue-400",children:M?e.jsxs(e.Fragment,{children:[e.jsx(A,{name:"refresh-cw",className:"animate-spin mr-2",size:16}),"Guardando..."]}):"Guardar"})]})]})]})})},Ce=({selectedDate:a,setSelectedDate:g,tasks:f,users:E})=>{const[s,I]=o.useState(a),[w,N]=o.useState(""),M=o.useRef(0),F=o.useMemo(()=>E.reduce((t,i)=>(t[i.name]=i.color,t),{}),[E]),v=o.useMemo(()=>{const t=new Map;f.forEach(i=>{if(i.date){const l=i.date;t.has(l)||t.set(l,[]),t.get(l).push(i.employee)}});for(const[i,l]of t.entries())t.set(i,Array.from(new Set(l)));return t},[f]);o.useEffect(()=>{I(a)},[a]),o.useEffect(()=>{if(w.startsWith("slide-out")){const t=w.includes("left")?"next":"prev",i=setTimeout(()=>{const l=new Date(s);l.setDate(l.getDate()+(t==="prev"?-7:7)),I(l);const c=new Date(a);c.setDate(c.getDate()+(t==="prev"?-7:7)),g(c),N(t==="next"?"slide-in-from-right":"slide-in-from-left")},200);return()=>clearTimeout(i)}else if(w.startsWith("slide-in")){const t=setTimeout(()=>{N("")},200);return()=>clearTimeout(t)}},[w,s,a,g]);const D=t=>{w||N(t==="next"?"slide-out-left":"slide-out-right")},O=t=>{const i=t.target.value;if(i){const l=new Date(i);l.setMinutes(l.getMinutes()+l.getTimezoneOffset()),g(l)}},z=t=>{M.current=t.targetTouches[0].clientX},d=t=>{const i=t.changedTouches[0].clientX,l=50,c=M.current-i;c>l?D("next"):c<-l&&D("prev")},S=new Date;S.setHours(0,0,0,0);const y=new Date(s),n=s.getDay(),T=s.getDate()-n+(n===0?-6:1);y.setDate(T),y.setHours(0,0,0,0);const m=[];for(let t=0;t<7;t++){const i=new Date(y);i.setDate(y.getDate()+t),m.push(i)}const j=(t,i)=>t.getFullYear()===i.getFullYear()&&t.getMonth()===i.getMonth()&&t.getDate()===i.getDate(),p=s.toLocaleDateString("es-ES",{month:"long",year:"numeric"});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 px-2",children:[e.jsx("button",{onClick:()=>D("prev"),className:"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(A,{name:"chevron-left",size:20})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold text-gray-700 capitalize text-sm",children:p}),e.jsxs("div",{className:"relative w-9 h-9 flex items-center justify-center text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors cursor-pointer",title:"Seleccionar fecha",children:[e.jsx(A,{name:"calendar",size:18}),e.jsx("input",{type:"date",onChange:O,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer","aria-label":"Seleccionar fecha"})]})]}),e.jsx("button",{onClick:()=>D("next"),className:"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(A,{name:"chevron-right",size:20})})]}),e.jsx("div",{className:"p-1 bg-gray-200 rounded-lg overflow-hidden relative touch-pan-y",children:e.jsx("div",{className:`flex justify-between items-center gap-1 md:gap-2 ${w}`,onTouchStart:z,onTouchEnd:d,children:m.map(t=>{const i=j(t,a),l=j(t,S),c=new Date(t);c.setMinutes(c.getMinutes()-c.getTimezoneOffset());const u=c.toISOString().split("T")[0],h=v.get(u)||[];return e.jsx("button",{onClick:()=>g(t),className:"px-1 py-1 md:px-2 md:py-2 rounded-md transition-all duration-200 text-center flex-1",children:e.jsxs("div",{className:`${i?"bg-white shadow-sm rounded-md":""} py-1`,children:[e.jsx("span",{className:`text-xs uppercase font-bold ${i?"text-blue-600":"text-gray-500"}`,children:t.toLocaleDateString("es-ES",{weekday:"short"}).replace(".","")}),e.jsx("p",{className:`font-bold text-lg ${l?"text-blue-600":i?"text-gray-800":"text-gray-600"}`,children:t.getDate()}),e.jsx("div",{className:"flex justify-center items-center h-2 mt-1 gap-0.5",children:h.slice(0,4).map(P=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:F[P]||"#9ca3af"},title:P},P))})]})},t.toISOString())})})})]})},Ee=a=>{switch(a){case"inprogress":return"opacity-100 animate-pulse-yellow";case"done":return"opacity-50";case"todo":default:return"opacity-100"}},Ie=({task:a,onUpdateStatus:g,onEdit:f,onViewSubtasks:E,style:s,userColor:I})=>{var S,y;const w=Ee(a.status),N=n=>{n.stopPropagation(),a.status==="todo"?g(a.id,"inprogress"):a.status==="inprogress"?g(a.id,"done"):a.status==="done"&&g(a.id,"todo")},M=new Date(`${a.date}T${a.time}`),v=new Date(M.getTime()+a.duration*6e4).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hourCycle:"h23"}),D=((S=a.subtasks)==null?void 0:S.length)||0,O=((y=a.subtasks)==null?void 0:y.filter(n=>n.isCompleted).length)||0,z={...s,borderWidth:"2px",borderColor:a.status==="inprogress"?I:"transparent",backgroundColor:"#f9fafb"},d={color:"#374151"};return e.jsxs("div",{style:z,onClick:E,className:`absolute rounded-lg p-2 flex gap-2 transition-all duration-300 cursor-pointer ${w}`,children:[e.jsx("div",{className:"flex-shrink-0 w-1 h-full rounded-full",style:{backgroundColor:I}}),e.jsxs("div",{className:"flex-grow flex flex-col min-w-0 min-h-0",children:[e.jsxs("div",{className:"flex-grow overflow-hidden",children:[e.jsxs("p",{className:`font-bold text-sm truncate ${a.status==="done"?"line-through":""}`,style:d,children:[a.isCritical&&e.jsx(A,{name:"alert-triangle",size:14,className:"inline-block mr-1 text-red-600",title:"Tarea Crítica"}),a.text]}),e.jsxs("p",{className:`text-xs ${a.status==="done"?"line-through":""}`,style:d,children:[a.time," - ",v," (",a.duration," min)"]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1 flex-shrink-0",children:[e.jsx("span",{className:"text-xs font-bold px-2 py-0.5 rounded-full bg-white/60",style:d,children:a.employee}),e.jsxs("div",{className:"flex items-center gap-2",style:d,children:[a.notes&&a.notes.trim()!==""&&e.jsx(A,{name:"message-square",size:14,title:"Esta tarea tiene notas"}),D>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs font-semibold",children:[e.jsx(A,{name:"list",size:14}),e.jsxs("span",{children:[O,"/",D]})]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),f(a)},className:"p-1 rounded-full hover:bg-black/10 transition-colors",title:"Editar Tarea",children:e.jsx(A,{name:"pencil",size:14})})]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:N,className:"w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all",style:{borderColor:a.status==="done"?"#4ade80":"#9ca3af",backgroundColor:a.status==="done"?"#4ade80":"white"},children:[a.status==="inprogress"&&e.jsx("div",{className:"w-2.5 h-2.5 bg-yellow-500 rounded-full"}),a.status==="done"&&e.jsx(A,{name:"check",size:16,className:"text-white"})]})})]})},ke=({task:a,onClose:g,onUpdateTask:f})=>{var O,z;const[E,s]=o.useState(""),I=d=>{const S=(a.subtasks||[]).map(y=>y.id===d?{...y,isCompleted:!y.isCompleted}:y);f({...a,subtasks:S})},w=()=>{if(E.trim()==="")return;const d={id:`sub-${Date.now()}`,text:E.trim(),isCompleted:!1},S=[...a.subtasks||[],d];f({...a,subtasks:S}),s("")},N=d=>{const S=(a.subtasks||[]).filter(y=>y.id!==d);f({...a,subtasks:S})},M=d=>{d.key==="Enter"&&(d.preventDefault(),w())},F=((O=a.subtasks)==null?void 0:O.filter(d=>d.isCompleted).length)||0,v=((z=a.subtasks)==null?void 0:z.length)||0,D=v>0?F/v*100:0;return e.jsx("div",{className:"absolute inset-0 bg-gray-900/40 z-50 flex justify-center items-center p-4",onClick:g,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md flex flex-col",onClick:d=>d.stopPropagation(),children:[e.jsxs("header",{className:"p-4 border-b",children:[e.jsx("h3",{className:"font-bold text-lg text-blue-700",children:a.text}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.time," - ",a.employee]})]}),e.jsxs("div",{className:"p-4 flex-grow overflow-y-auto max-h-[50vh]",children:[a.notes&&a.notes.trim()!==""&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-2",children:"Notas"}),e.jsx("div",{className:"p-3 bg-yellow-50 border-l-4 border-yellow-400 text-gray-800 text-sm rounded-r-lg whitespace-pre-wrap",children:a.notes})]}),v>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Progreso de Subtareas"}),e.jsxs("span",{children:[F," / ",v]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${D}%`}})})]}),e.jsx("div",{className:"space-y-2",children:(a.subtasks||[]).map(d=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-md group",children:[e.jsx("input",{type:"checkbox",checked:d.isCompleted,onChange:()=>I(d.id),className:"w-5 h-5 rounded text-blue-600 focus:ring-blue-500 flex-shrink-0"}),e.jsx("span",{className:`flex-grow text-gray-800 ${d.isCompleted?"line-through text-gray-400":""}`,children:d.text}),e.jsx("button",{onClick:()=>N(d.id),className:"p-1 text-gray-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(A,{name:"trash-2",size:16})})]},d.id))}),v===0&&(!a.notes||a.notes.trim()==="")&&e.jsx("p",{className:"text-center text-gray-500 py-6",children:"No hay subtareas ni notas. ¡Añade la primera!"})]}),e.jsx("div",{className:"p-4 border-t bg-gray-50 rounded-b-xl",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:E,onChange:d=>s(d.target.value),onKeyDown:M,placeholder:"Añadir nueva subtarea...",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-sm focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:w,className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 text-sm",children:"Añadir"})]})})]})})},fe=2.5,ve=90,we=15,Ae=70,Pe=100,$e=40,Oe=a=>{const g=Math.floor(a/60),f=Math.round(a%60);return`${g}h ${f}min entre tareas`},ze=a=>{const[g,f]=a.split(":").map(Number);return g*60+f},_e=({tasks:a,onUpdateStatus:g,onEditTask:f,onUpdateTask:E,users:s})=>{const[I,w]=o.useState(new Date),[N,M]=o.useState(null),F=o.useMemo(()=>s.reduce((n,T)=>(n[T.name]=T.color,n),{}),[s]);o.useEffect(()=>{const n=setInterval(()=>w(new Date),6e4);return()=>clearInterval(n)},[]),o.useEffect(()=>{if(N){const n=a.find(T=>T.id===N.id);M(n||null)}},[a,N]);const{timelineItems:v,totalHeight:D,getPositionForMinute:O}=o.useMemo(()=>{const n=[],T=a.filter(l=>l.time).sort((l,c)=>l.time.localeCompare(c.time));let m=ge*60;T.forEach(l=>{const c=ze(l.time),u=c+l.duration,h=c-m;h>ve?n.push({type:"gap",startMinute:m,duration:h}):h>=we?n.push({type:"short_break",startMinute:m,duration:h}):h>0&&n.push({type:"empty",startMinute:m,duration:h}),n.push({type:"task",task:l,startMinute:c,duration:l.duration}),m=Math.max(m,u)});const j=de*60-m;j>ve?n.push({type:"gap",startMinute:m,duration:j}):j>=we?n.push({type:"short_break",startMinute:m,duration:j}):j>0&&n.push({type:"empty",startMinute:m,duration:j});let p=0;const t=n.map(l=>{const c=p;let u=0;return l.type==="task"?u=Math.max(l.duration*fe,Pe):l.type==="gap"?u=Ae:l.type==="short_break"?u=$e:l.type==="empty"&&(u=l.duration*fe),p+=u,{...l,top:c,height:u}});return{timelineItems:t,totalHeight:p,getPositionForMinute:l=>{for(const u of t)if(l>=u.startMinute&&l<u.startMinute+u.duration){const h=l-u.startMinute;if(u.type==="task"||u.type==="empty")return u.top+h*fe;if(u.type==="gap"||u.type==="short_break")return u.top+h/u.duration*u.height}const c=t[t.length-1];return c?c.top+c.height:(l-ge*60)*fe}}},[a]),z=o.useMemo(()=>{const n=v.filter(p=>p.type==="task");if(n.length===0)return[];const T=[],m=new Set,j=[...n].sort((p,t)=>p.startMinute-t.startMinute);for(const p of j){if(m.has(p.task.id))continue;const t=[],i=[p],l=new Set([p.task.id]);for(;i.length>0;){const h=i.shift();t.push(h);const P=h.startMinute,_=P+h.task.duration;for(const $ of j)if(!l.has($.task.id)){const R=$.startMinute,K=R+$.task.duration;P<K&&_>R&&(l.add($.task.id),i.push($))}}t.forEach(h=>m.add(h.task.id)),t.sort((h,P)=>h.startMinute-P.startMinute);const c=[];for(const h of t){let P=!1;for(const _ of c){const $=_[_.length-1],R=$.startMinute+$.task.duration;if(h.startMinute>=R){_.push(h),P=!0;break}}P||c.push([h])}const u=c.length;c.forEach((h,P)=>{h.forEach(_=>{T.push({task:_.task,top:_.top,height:_.height,width:100/u,left:P/u*100,zIndex:P+1})})})}return T},[v]),d=o.useMemo(()=>{const n=new Map,T=new Map(z.map(t=>[t.task.id,t])),m=new Set;if(v.length===0)for(let t=ge;t<=de;t++)m.add(t);else v.forEach(t=>{const i=Math.floor(t.startMinute/60),l=t.startMinute+t.duration,c=Math.ceil(l/60);t.type==="gap"?(m.add(i),m.add(c)):(t.type==="task"||(t.type==="empty"||t.type==="short_break")&&t.startMinute%60===0)&&m.add(i)}),m.add(ge),m.add(de);m.forEach(t=>{t>de||n.set(t*60,`${String(t).padStart(2,"0")}:00`)}),v.forEach(t=>{if(t.type==="task"){const{startMinute:i,task:l}=t,c=T.get(l.id);if(c&&c.left>0)return;const u=Math.floor(i/60),h=i%60;h!==0&&n.set(i,`${String(u).padStart(2,"0")}:${String(h).padStart(2,"0")}`)}});const j=Array.from(n.entries()).map(([t,i])=>({minute:t,label:i})).sort((t,i)=>t.minute-i.minute);if(j.length<2)return j;const p=[j[0]];for(let t=1;t<j.length;t++){const i=p[p.length-1],l=j[t],c=O(i.minute);O(l.minute)-c>20&&p.push(l)}return p},[v,O,z]),S=I.getHours()*60+I.getMinutes(),y=O(S);return e.jsxs("div",{className:"p-4 md:p-6 h-full relative",children:[e.jsxs("div",{className:"relative z-10",style:{height:`${D}px`},children:[d.map(({minute:n,label:T})=>{const m=O(n);if(m>D+1||n>de*60)return null;const j=n%60===0;return e.jsxs("div",{className:"absolute w-full",style:{top:`${m}px`},children:[e.jsx("span",{className:`absolute -top-2.5 left-0 text-xs w-16 text-right pr-4 ${j?"font-semibold text-gray-500":"font-normal text-gray-400"}`,children:T}),e.jsx("div",{className:`h-px ml-16 ${j?"bg-gray-200":"bg-gray-200/60"}`})]},n)}),y>=0&&y<=D&&e.jsx("div",{className:"absolute left-16 right-0 h-0.5 bg-red-500 z-20",style:{top:`${y}px`},children:e.jsx("div",{className:"absolute -left-1.5 -top-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white"})}),e.jsxs("div",{className:"absolute top-0 bottom-0 left-16 right-0",children:[v.filter(n=>n.type==="gap").map(n=>e.jsx("div",{className:"absolute w-full flex items-center",style:{top:`${n.top}px`,height:`${n.height}px`},children:e.jsx("div",{className:"w-full border-t-2 border-dashed border-gray-300 relative",children:e.jsx("span",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gray-50 px-2 text-xs font-semibold text-gray-500",children:Oe(n.duration)})})},`gap-${n.startMinute}`)),v.filter(n=>n.type==="short_break").map(n=>e.jsx("div",{className:"absolute w-full flex items-center",style:{top:`${n.top}px`,height:`${n.height}px`},children:e.jsxs("div",{className:"w-full flex items-center justify-center gap-2 text-gray-400",children:[e.jsx("div",{className:"flex-grow border-t border-dashed border-gray-300"}),e.jsxs("span",{className:"text-xs font-semibold whitespace-nowrap",children:[Math.round(n.duration)," min libres"]}),e.jsx("div",{className:"flex-grow border-t border-dashed border-gray-300"})]})},`break-${n.startMinute}`)),z.map(({task:n,top:T,height:m,left:j,width:p,zIndex:t})=>e.jsx(Ie,{task:n,onUpdateStatus:g,onEdit:f,onViewSubtasks:()=>M(n),userColor:F[n.employee]||"#9ca3af",style:{top:`${T}px`,height:`${m-4}px`,left:`${j}%`,width:`calc(${p}% - 4px)`,zIndex:t}},n.id))]})]}),N&&e.jsx(ke,{task:N,onClose:()=>M(null),onUpdateTask:E})]})},Fe=a=>a>0?`en ${a} min`:a===0?"¡Ahora!":`hace ${Math.abs(a)} min`,He=({tasksWithDiff:a})=>e.jsxs("div",{className:"bg-yellow-100 border-b-2 border-yellow-300 p-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(A,{name:"alert-triangle",className:"text-yellow-600",size:20}),e.jsx("h3",{className:"font-bold text-yellow-800 text-base",children:"Tareas Críticas Próximas"})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:a.map(({task:g,diff:f})=>e.jsxs("div",{className:"bg-white/70 p-2 rounded-lg border border-yellow-300 flex-shrink-0 w-60",children:[e.jsx("p",{className:"font-bold text-sm text-gray-800 truncate",children:g.text}),e.jsxs("p",{className:`text-xs font-semibold ${f<=0?"text-red-600 animate-pulse":"text-blue-600"}`,children:[g.time," (",Fe(f),")"]})]},g.id))})]}),Re=({isOpen:a,onClose:g,onSelectThisOne:f,onSelectFuture:E,isDelete:s=!1})=>{const w=`¿Qué tareas quieres ${s?"eliminar":"editar"}?`,N=s?"Eliminar solo esta tarea":"Editar solo esta tarea",M="La acción solo se aplicará a esta instancia. El resto de la serie no se verá afectado.",F=s?"Eliminar esta y futuras tareas":"Editar esta y futuras tareas",v="La acción se aplicará a esta y a todas las repeticiones futuras de la serie.",D=s?"trash-2":"pencil";return e.jsx(Ne,{isOpen:a,onClose:g,title:w,children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("button",{onClick:f,className:"p-4 bg-gray-100 rounded-lg border-2 border-transparent hover:border-blue-500 transition-all text-left",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{name:D,size:24,className:"text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-800",children:N}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:M})]})]})}),e.jsx("button",{onClick:E,className:"p-4 bg-gray-100 rounded-lg border-2 border-transparent hover:border-blue-500 transition-all text-left",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{name:"calendar",size:24,className:"text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-800",children:F}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:v})]})]})}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:g,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"})})]})})},We=({tasks:a,onEditTask:g,users:f})=>{const E=o.useMemo(()=>f.reduce((s,I)=>(s[I.name]=I.color,s),{}),[f]);return a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500 p-8",children:[e.jsx(A,{name:"check-circle",size:48,className:"text-green-500 mb-4"}),e.jsx("h3",{className:"text-xl font-bold",children:"¡Bandeja Limpia!"}),e.jsx("p",{children:"No hay tareas pendientes sin planificar."})]}):e.jsx("div",{className:"p-4 md:p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-[3fr_1.5fr_1.5fr_1fr] gap-4 px-4 pb-2 border-b border-gray-200",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500",children:"Tarea"}),e.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500",children:"Asignado a"}),e.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500",children:"Añadida por"}),e.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500 text-right",children:"Acciones"})]}),a.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm hover:border-blue-400 transition-all grid grid-cols-2 md:grid-cols-[3fr_1.5fr_1.5fr_1fr] gap-x-4 gap-y-2 items-center",children:[e.jsx("div",{className:"col-span-2 md:col-span-1",children:e.jsxs("p",{className:"font-bold text-gray-800 break-words flex items-center gap-2",children:[s.isCritical&&e.jsx(A,{name:"alert-triangle",size:16,className:"text-red-500 flex-shrink-0",title:"Tarea Crítica"}),s.text,s.notes&&e.jsx(A,{name:"message-square",size:14,className:"text-gray-400 flex-shrink-0",title:"Tiene notas"})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-500 md:hidden",children:"Asignado:"}),e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:E[s.employee]||"#9ca3af"}}),e.jsx("span",{className:"text-gray-700",children:s.employee})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-500 md:hidden",children:"Añadida:"}),e.jsx("span",{className:"text-gray-700",children:s.addedBy})]}),e.jsx("div",{className:"col-span-2 md:col-span-1 flex justify-end",children:e.jsxs("button",{onClick:()=>g(s),className:"w-full md:w-auto flex-shrink-0 flex items-center justify-center gap-2 bg-blue-100 text-blue-700 font-semibold py-2 px-3 rounded-lg hover:bg-blue-200 transition-colors text-xs",children:[e.jsx(A,{name:"calendar",size:14}),"Planificar"]})})]},s.id))]})})},Ge=({kanbanHook:a,criticalTasks:g,users:f})=>{const{tasks:E,addTask:s,addMultipleTasks:I,updateTask:w,updateTaskStatus:N,deleteTask:M,updateFutureTasks:F,deleteFutureTasks:v}=a,[D,O]=o.useState(new Date),[z,d]=o.useState(!1),[S,y]=o.useState(null),[n,T]=o.useState("All"),[m,j]=o.useState("agenda"),[p,t]=o.useState(null),[i,l]=o.useState(null),[c,u]=o.useState("new"),[h,P]=o.useState(null),[_,$]=o.useState(!1),[R,K]=o.useState(""),[Y,J]=o.useState(""),[ue,U]=o.useState(!1),Q=x=>{x.recurrenceId?(l("edit"),t(x)):(u("single"),y(x),d(!0))},ee=()=>{d(!1),y(null),u("new")},ne=async(x,r)=>{const{recurrence:b,selectedDays:k,recurrenceWeeks:re,...W}=x;U(!0);try{if(r&&S)if(!W.date)await w({...W,id:r,status:S.status});else if(c==="future")if(b==="weekly"&&k&&k.length>0){await v(S);const C=new Date(S.date);C.setMinutes(C.getMinutes()+C.getTimezoneOffset());const V=parseInt(re||"4",10),L=[],B=new Date(C),G=C.getDay(),ie=C.getDate()-G+(G===0?-6:1);B.setDate(ie);for(let Z=0;Z<V;Z++){const q=new Date(B);q.setDate(B.getDate()+Z*7),k.forEach(je=>{const ce=parseInt(je,10),H=new Date(q);ce===0?H.setDate(q.getDate()+6):H.setDate(q.getDate()+(ce-1)),H.getTime()>=C.getTime()&&(H.setMinutes(H.getMinutes()-H.getTimezoneOffset()),L.push({...W,date:H.toISOString().split("T")[0]}))})}await I(L)}else{const{date:C,time:V,...L}=W;await F(S,L)}else{const{recurrenceId:C,...V}=S,L={...V,...W,id:r};await w(L)}else if(!W.date)await s(W);else{const C=new Date(W.date);if(C.setMinutes(C.getMinutes()+C.getTimezoneOffset()),b==="weekly"&&k&&k.length>0){const V=parseInt(re||"4",10),L=[],B=new Date(C),G=C.getDay(),ie=C.getDate()-G+(G===0?-6:1);B.setDate(ie);for(let Z=0;Z<V;Z++){const q=new Date(B);q.setDate(B.getDate()+Z*7),k.forEach(je=>{const ce=parseInt(je,10),H=new Date(q);ce===0?H.setDate(q.getDate()+6):H.setDate(q.getDate()+(ce-1)),H.setMinutes(H.getMinutes()-H.getTimezoneOffset()),L.push({...W,date:H.toISOString().split("T")[0]})})}await I(L)}else await s(W)}ee()}catch(C){console.error("Error saving task:",C)}finally{U(!1)}},me=x=>{d(!1),y(null),x.recurrenceId?(l("delete"),t(x)):te(()=>M(x.id))},le=()=>{p&&(u("single"),y(p),d(!0),t(null),l(null))},X=()=>{p&&(u("future"),y(p),d(!0),t(null),l(null))},xe=()=>{p&&(te(()=>M(p.id)),t(null),l(null))},oe=()=>{p&&(te(()=>v(p)),t(null),l(null))},te=x=>{P(()=>x),$(!0),K(""),J("")},be=()=>{R===Te?(h==null||h(),$(!1),P(null)):(J("PIN incorrecto. Inténtalo de nuevo."),K(""))},se=o.useMemo(()=>{const x=new Date(D);return x.setMinutes(x.getMinutes()-x.getTimezoneOffset()),x.toISOString().split("T")[0]},[D]),ae=o.useMemo(()=>E.filter(x=>n==="All"||x.employee===n),[E,n]),ye=o.useMemo(()=>ae.filter(x=>x.date===se),[ae,se]),he=o.useMemo(()=>ae.filter(x=>!x.date),[ae]),pe=({view:x,label:r,icon:b,count:k})=>e.jsxs("button",{onClick:()=>j(x),className:`flex items-center gap-2 py-2 px-4 text-sm md:text-base font-bold border-b-4 transition-colors ${m===x?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-800"}`,children:[e.jsx(A,{name:b,size:18}),r,k>0&&e.jsx("span",{className:"text-xs bg-gray-300 text-gray-700 font-bold rounded-full px-2",children:k})]});return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50",children:[g.length>0&&e.jsx(He,{tasksWithDiff:g}),e.jsxs("div",{className:"operations-header flex flex-col p-4 border-b border-gray-200 gap-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-center w-full gap-4",children:[e.jsxs("div",{className:"flex",children:[e.jsx(pe,{view:"agenda",label:"Agenda Diaria",icon:"calendar",count:0}),e.jsx(pe,{view:"pending",label:"Tareas Pendientes",icon:"clipboard-list",count:he.length})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:()=>{u("new"),y(null),d(!0)},className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-3 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(A,{name:"plus-circle",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Añadir Tarea"}),e.jsx("span",{className:"md:hidden",children:"Añadir"})]})})]}),m==="agenda"&&e.jsx(Ce,{selectedDate:D,setSelectedDate:O,tasks:E,users:f}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-200 rounded-lg p-1 w-full overflow-x-auto",children:[e.jsx("button",{onClick:()=>T("All"),className:`px-3 py-1 text-sm font-bold rounded-md transition-colors ${n==="All"?"bg-white shadow-sm":"bg-transparent text-gray-600"}`,children:"Todos"}),f.map(x=>e.jsx("button",{onClick:()=>T(x.name),className:`px-3 py-1 text-sm font-bold rounded-md transition-colors ${n===x.name?"bg-white shadow-sm":"bg-transparent text-gray-600"}`,children:x.name},x.id))]})]}),e.jsx("div",{className:"flex-grow overflow-auto relative",children:m==="agenda"?e.jsx(_e,{tasks:ye,onEditTask:Q,onUpdateStatus:N,onUpdateTask:w,users:f}):e.jsx(We,{tasks:he,onEditTask:Q,users:f})}),e.jsx(De,{isOpen:z,onClose:ee,onSave:ne,onDelete:me,task:S,selectedDate:se,users:f,editMode:c,isSaving:ue,allTasks:E}),e.jsx(Re,{isOpen:!!p,onClose:()=>t(null),onSelectThisOne:i==="edit"?le:xe,onSelectFuture:i==="edit"?X:oe,isDelete:i==="delete"}),_&&e.jsx(Ne,{isOpen:_,onClose:()=>$(!1),title:"Confirmar Acción",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"font-bold text-lg text-gray-800",children:"Acción Protegida"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2 mb-4",children:"Para continuar, introduce el PIN de operaciones."}),e.jsx("input",{type:"password",value:R,onChange:x=>{K(x.target.value),J("")},placeholder:"PIN de Seguridad",autoFocus:!0,className:"w-full p-2 border border-gray-300 rounded-md text-center"}),Y&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:Y}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{onClick:()=>$(!1),className:"flex-1 py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{onClick:be,className:"flex-1 py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Confirmar"})]})]})})]})};export{Ge as default};
