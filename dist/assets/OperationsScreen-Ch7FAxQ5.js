import{r as o,j as e,T as ee,I as F,O as te,a as se,b as ae}from"./index-DclevHzB.js";import{M as le}from"./Modal-ujGdIQ6G.js";const re=[{label:"L",value:"1"},{label:"M",value:"2"},{label:"M",value:"3"},{label:"J",value:"4"},{label:"V",value:"5"},{label:"S",value:"6"},{label:"D",value:"0"}],ne=({isOpen:t,onClose:x,onSave:f,onDelete:N,task:l,selectedDate:k})=>{const[y,h]=o.useState(""),[d,i]=o.useState("Ali"),[w,M]=o.useState("08"),[I,D]=o.useState("00"),[a,n]=o.useState("AM"),[r,c]=o.useState("30"),[v,S]=o.useState("pre-apertura"),[O,u]=o.useState(""),[A,E]=o.useState(!1),[p,g]=o.useState("once"),[j,b]=o.useState([]),[T,C]=o.useState([]),[P,H]=o.useState(""),[R,$]=o.useState(!1),[L,_]=o.useState(""),[z,K]=o.useState("");o.useEffect(()=>{if(t){h((l==null?void 0:l.text)||""),i((l==null?void 0:l.employee)||"Ali");const s=(l==null?void 0:l.time)||"08:00",[m,W]=s.split(":").map(Number),U=m>=12?"PM":"AM";let G=m%12;G===0&&(G=12),M(String(G).padStart(2,"0")),D(String(W).padStart(2,"0")),n(U),c(String((l==null?void 0:l.duration)||"30")),S((l==null?void 0:l.shift)||"pre-apertura"),u((l==null?void 0:l.zone)||""),E((l==null?void 0:l.isCritical)||!1),g("once"),b([]),C((l==null?void 0:l.subtasks)||[]),H(""),$(!1),_(""),K("")}},[t,l]);const Y=s=>{b(m=>m.includes(s)?m.filter(W=>W!==s):[...m,s])},X=()=>{if(P.trim()==="")return;const s={id:`sub-${Date.now()}`,text:P.trim(),isCompleted:!1};C([...T,s]),H("")},Z=s=>{s.key==="Enter"&&(s.preventDefault(),X())},J=s=>{C(T.filter(m=>m.id!==s))},V=s=>{if(s.preventDefault(),!y){alert("Por favor completa el nombre de la tarea.");return}if(p==="weekly"&&j.length===0){alert("Por favor selecciona al menos un día para la tarea recurrente.");return}let m=parseInt(w,10);a==="PM"&&m!==12?m+=12:a==="AM"&&m===12&&(m=0);const W=`${String(m).padStart(2,"0")}:${I}`,U={text:y,employee:d,time:W,duration:parseInt(r,10),shift:v,zone:O,isCritical:A,date:(l==null?void 0:l.date)||k,recurrence:p,selectedDays:j,subtasks:T};f(U,l==null?void 0:l.id),x()},Q=()=>{L===te?(l&&N(l.id),x()):(K("PIN incorrecto. Inténtalo de nuevo."),_(""))};return e.jsx(le,{isOpen:t,onClose:x,title:l?"Editar Tarea":"Añadir Nueva Tarea",children:e.jsxs("div",{className:"relative",children:[e.jsxs("form",{onSubmit:V,className:"flex flex-col gap-4 max-h-[80vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Nombre de la Tarea"}),e.jsx("input",{type:"text",value:y,onChange:s=>h(s.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Repetición"}),e.jsxs("div",{className:"flex gap-2 bg-gray-200 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>g("once"),className:`flex-1 p-2 rounded-md text-sm font-bold transition-colors ${p==="once"?"bg-white shadow-sm":""}`,children:"Una vez"}),e.jsx("button",{type:"button",onClick:()=>g("weekly"),className:`flex-1 p-2 rounded-md text-sm font-bold transition-colors ${p==="weekly"?"bg-white shadow-sm":""}`,children:"Semanalmente"})]})]}),p==="weekly"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Días de la semana"}),e.jsx("div",{className:"flex justify-between gap-1",children:re.map(({label:s,value:m})=>e.jsx("button",{type:"button",onClick:()=>Y(m),className:`w-9 h-9 flex items-center justify-center font-bold rounded-full border-2 transition-colors ${j.includes(m)?"bg-blue-600 text-white border-blue-600":"bg-gray-100 border-gray-300"}`,children:s},m))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Empleado"}),e.jsxs("select",{value:d,onChange:s=>i(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{children:"Ali"}),e.jsx("option",{children:"Fer"}),e.jsx("option",{children:"Claudia"}),e.jsx("option",{children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Turno"}),e.jsxs("select",{value:v,onChange:s=>S(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{value:"matutino",children:"Matutino"}),e.jsx("option",{value:"pre-apertura",children:"Pre Apertura"}),e.jsx("option",{value:"cierre",children:"Cierre"}),e.jsx("option",{value:"default",children:"Otro"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Hora"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("select",{value:w,onChange:s=>M(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Array.from({length:12},(s,m)=>m+1).map(s=>e.jsx("option",{value:String(s).padStart(2,"0"),children:String(s).padStart(2,"0")},s))}),e.jsx("select",{value:I,onChange:s=>D(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Array.from({length:60},(s,m)=>m).map(s=>e.jsx("option",{value:String(s).padStart(2,"0"),children:String(s).padStart(2,"0")},s))}),e.jsxs("select",{value:a,onChange:s=>n(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{children:"AM"}),e.jsx("option",{children:"PM"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Duración"}),e.jsx("select",{value:r,onChange:s=>c(s.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:ee.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Zona (Opcional)"}),e.jsx("input",{type:"text",value:O,onChange:s=>u(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"form-group mt-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Subtareas"}),e.jsxs("div",{className:"bg-gray-100 p-3 rounded-lg",children:[T.length>0&&e.jsx("ul",{className:"space-y-2 mb-3",children:T.map(s=>e.jsxs("li",{className:"flex items-center justify-between bg-white p-2 rounded",children:[e.jsx("span",{className:"text-sm text-gray-700",children:s.text}),e.jsx("button",{type:"button",onClick:()=>J(s.id),className:"p-1 text-gray-400 hover:text-red-600",children:e.jsx(F,{name:"trash-2",size:16})})]},s.id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:P,onChange:s=>H(s.target.value),onKeyDown:Z,placeholder:"Añadir una subtarea...",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-sm"}),e.jsx("button",{type:"button",onClick:X,className:"py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 text-sm",children:"Añadir"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"task-critical",checked:A,onChange:s=>E(s.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"task-critical",className:"text-sm font-medium text-gray-600",children:"Es una tarea crítica"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t sticky bottom-0 bg-white",children:[e.jsx("div",{children:l&&e.jsx("button",{type:"button",onClick:()=>$(!0),className:"py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700",children:"Eliminar Tarea"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:x,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Guardar Cambios"})]})]})]}),R&&e.jsx("div",{className:"absolute inset-0 bg-white/80 backdrop-blur-sm flex justify-center items-center z-10",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-gray-200 w-full max-w-sm text-center",children:[e.jsx("h4",{className:"font-bold text-lg text-gray-800",children:"Confirmar Eliminación"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2 mb-4",children:"Para confirmar, introduce el PIN de operaciones. Esta acción no se puede deshacer."}),e.jsx("input",{type:"password",value:L,onChange:s=>{_(s.target.value),K("")},placeholder:"PIN de Seguridad",autoFocus:!0,className:"w-full p-2 border border-gray-300 rounded-md text-center"}),z&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:z}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{onClick:()=>$(!1),className:"flex-1 py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{onClick:Q,className:"flex-1 py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700",children:"Confirmar"})]})]})})]})})},oe=({selectedDate:t,setSelectedDate:x})=>{const f=new Date;f.setHours(0,0,0,0);const N=new Date(t),l=t.getDay(),k=t.getDate()-l+(l===0?-6:1);N.setDate(k),N.setHours(0,0,0,0);const y=[];for(let d=0;d<7;d++){const i=new Date(N);i.setDate(N.getDate()+d),y.push(i)}const h=(d,i)=>d.getFullYear()===i.getFullYear()&&d.getMonth()===i.getMonth()&&d.getDate()===i.getDate();return e.jsx("div",{className:"flex justify-center items-center gap-1 md:gap-2 p-1 bg-gray-200 rounded-lg",children:y.map(d=>{const i=h(d,t),w=h(d,f);return e.jsxs("button",{onClick:()=>x(d),className:`px-2 py-1 md:px-4 md:py-2 rounded-md transition-all duration-200 w-full text-center ${i?"bg-white shadow-sm":"bg-transparent"}`,children:[e.jsx("span",{className:`text-xs uppercase font-bold ${i?"text-blue-600":"text-gray-500"}`,children:d.toLocaleDateString("es-ES",{weekday:"short"})}),e.jsx("p",{className:`font-bold text-lg ${w?"text-blue-600":i?"text-gray-800":"text-gray-600"}`,children:d.getDate()})]},d.toISOString())})})},q={Ali:{bg:"bg-pink-100",border:"border-pink-500",text:"text-pink-800"},Fer:{bg:"bg-purple-100",border:"border-purple-500",text:"text-purple-800"},Claudia:{bg:"bg-teal-100",border:"border-teal-500",text:"text-teal-800"},Admin:{bg:"bg-yellow-100",border:"border-yellow-600",text:"text-yellow-900"}},ie=t=>{switch(t){case"inprogress":return"opacity-100 animate-pulse-yellow";case"done":return"opacity-50";case"todo":default:return"opacity-100"}},de=({task:t,onUpdateStatus:x,onEdit:f,onViewSubtasks:N,style:l})=>{var n,r;const{bg:k,border:y,text:h}=q[t.employee]||q.Admin,d=ie(t.status),i=c=>{c.stopPropagation(),t.status==="todo"?x(t.id,"inprogress"):t.status==="inprogress"?x(t.id,"done"):t.status==="done"&&x(t.id,"todo")},w=new Date(`${t.date}T${t.time}`),I=new Date(w.getTime()+t.duration*6e4).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hourCycle:"h23"}),D=((n=t.subtasks)==null?void 0:n.length)||0,a=((r=t.subtasks)==null?void 0:r.filter(c=>c.isCompleted).length)||0;return e.jsxs("div",{style:l,onClick:N,className:`absolute rounded-lg p-2 flex gap-2 transition-all duration-300 cursor-pointer ${k} border-2 ${d} ${t.status==="inprogress"?y:"border-transparent"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-1 h-full ${y.replace("border-","bg-")} rounded-full`}),e.jsxs("div",{className:"flex-grow flex flex-col min-w-0 min-h-0",children:[e.jsxs("div",{className:"flex-grow overflow-hidden",children:[e.jsx("p",{className:`font-bold text-sm break-words ${h} ${t.status==="done"?"line-through":""}`,children:t.text}),e.jsxs("p",{className:`text-xs ${h} ${t.status==="done"?"line-through":""}`,children:[t.time," - ",I," (",t.duration," min)"]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1 flex-shrink-0",children:[e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded-full bg-white/60 ${h}`,children:t.employee}),e.jsxs("div",{className:"flex items-center gap-2",children:[D>0&&e.jsxs("div",{className:`flex items-center gap-1 text-xs font-semibold ${h}`,children:[e.jsx(F,{name:"list",size:14}),e.jsxs("span",{children:[a,"/",D]})]}),e.jsx("button",{onClick:c=>{c.stopPropagation(),f(t)},className:`p-1 rounded-full hover:bg-black/10 transition-colors ${h}`,title:"Editar Tarea",children:e.jsx(F,{name:"pencil",size:14})})]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:i,className:"w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all",style:{borderColor:t.status==="done"?"#4ade80":"#9ca3af",backgroundColor:t.status==="done"?"#4ade80":"white"},children:[t.status==="inprogress"&&e.jsx("div",{className:"w-2.5 h-2.5 bg-yellow-500 rounded-full"}),t.status==="done"&&e.jsx(F,{name:"check",size:16,className:"text-white"})]})})]})},ce=({task:t,onClose:x,onUpdateTask:f})=>{var I,D;const[N,l]=o.useState(""),k=a=>{const n=(t.subtasks||[]).map(r=>r.id===a?{...r,isCompleted:!r.isCompleted}:r);f({...t,subtasks:n})},y=()=>{if(N.trim()==="")return;const a={id:`sub-${Date.now()}`,text:N.trim(),isCompleted:!1},n=[...t.subtasks||[],a];f({...t,subtasks:n}),l("")},h=a=>{const n=(t.subtasks||[]).filter(r=>r.id!==a);f({...t,subtasks:n})},d=a=>{a.key==="Enter"&&(a.preventDefault(),y())},i=((I=t.subtasks)==null?void 0:I.filter(a=>a.isCompleted).length)||0,w=((D=t.subtasks)==null?void 0:D.length)||0,M=w>0?i/w*100:0;return e.jsx("div",{className:"absolute inset-0 bg-gray-900/40 z-50 flex justify-center items-center p-4",onClick:x,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md flex flex-col",onClick:a=>a.stopPropagation(),children:[e.jsxs("header",{className:"p-4 border-b",children:[e.jsx("h3",{className:"font-bold text-lg text-blue-700",children:t.text}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.time," - ",t.employee]})]}),e.jsxs("div",{className:"p-4 flex-grow overflow-y-auto max-h-[50vh]",children:[w>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Progreso"}),e.jsxs("span",{children:[i," / ",w]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${M}%`}})})]}),e.jsx("div",{className:"space-y-2",children:(t.subtasks||[]).map(a=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-md group",children:[e.jsx("input",{type:"checkbox",checked:a.isCompleted,onChange:()=>k(a.id),className:"w-5 h-5 rounded text-blue-600 focus:ring-blue-500 flex-shrink-0"}),e.jsx("span",{className:`flex-grow text-gray-800 ${a.isCompleted?"line-through text-gray-400":""}`,children:a.text}),e.jsx("button",{onClick:()=>h(a.id),className:"p-1 text-gray-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(F,{name:"trash-2",size:16})})]},a.id))}),w===0&&e.jsx("p",{className:"text-center text-gray-500 py-6",children:"No hay subtareas. ¡Añade la primera!"})]}),e.jsx("div",{className:"p-4 border-t bg-gray-50 rounded-b-xl",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:N,onChange:a=>l(a.target.value),onKeyDown:d,placeholder:"Añadir nueva subtarea...",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-sm focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:y,className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 text-sm",children:"Añadir"})]})})]})})},B=120,ue=30,me=({tasks:t,onUpdateStatus:x,onEditTask:f,onUpdateTask:N})=>{const[l,k]=o.useState(new Date),[y,h]=o.useState(null);o.useEffect(()=>{const a=setInterval(()=>k(new Date),6e4);return()=>clearInterval(a)},[]),o.useEffect(()=>{if(y){const a=t.find(n=>n.id===y.id);h(a||null)}},[t]);const d=o.useMemo(()=>{const a={};return t.forEach(n=>{const r=parseInt(n.time.split(":")[0],10);a[r]=!0}),a},[t]),i=o.useMemo(()=>{let a=0;const n=[];for(let r=ae;r<=se;r++){const v=!!d[r]?B:ue;n.push({hour:r,top:a,height:v}),a+=v}return n},[d]),w=i.length>0?i[i.length-1].top+i[i.length-1].height:0,M=a=>{const[n,r]=a.split(":").map(Number),c=i.find(S=>S.hour===n);if(!c)return 0;const v=r/60*c.height;return c.top+v},I=o.useMemo(()=>{const a=[...t].sort((r,c)=>r.time.localeCompare(c.time)||c.duration-r.duration),n=[];for(const r of a){const c=M(r.time),v=new Date(`${r.date}T${r.time}`).getTime(),S=v+r.duration*6e4,O=i.find(g=>g.hour===parseInt(r.time.split(":")[0],10)),u=O?O.height:B,A=r.duration/60*u,E=[];for(const g of n){const j=new Date(`${g.task.date}T${g.task.time}`).getTime(),b=j+g.task.duration*6e4;v<b&&S>j&&E.push(g)}let p=0;for(;E.some(g=>g.left===p);)p++;n.push({task:r,top:c,height:A,left:p,width:1,zIndex:p})}return n.map((r,c,v)=>{const{task:S}=r,O=new Date(`${S.date}T${S.time}`).getTime(),u=O+S.duration*6e4,A=v.filter(b=>{const T=new Date(`${b.task.date}T${b.task.time}`).getTime(),C=T+b.task.duration*6e4;return O<C&&u>T}),E=new Set(A.map(b=>b.left)),p=E.size;let g=0;return g=Array.from(E).sort((b,T)=>b-T).indexOf(r.left),{...r,width:100/p,left:g/p*100}})},[t,i]),D=M(`${l.getHours()}:${l.getMinutes()}`);return e.jsxs("div",{className:"p-4 md:p-6 h-full relative",children:[e.jsxs("div",{className:"relative z-10",style:{height:`${w}px`},children:[i.map(({hour:a,top:n,height:r})=>e.jsxs("div",{className:"absolute w-full",style:{top:`${n}px`,height:`${r}px`},children:[e.jsxs("span",{className:"absolute -top-3 left-0 text-sm font-semibold text-gray-400 w-16 text-right pr-4",children:[a,":00"]}),e.jsx("div",{className:"h-px bg-gray-200 ml-16"})]},a)),D>=0&&D<=w&&e.jsx("div",{className:"absolute left-16 right-0 h-0.5 bg-red-500 z-20",style:{top:`${D}px`},children:e.jsx("div",{className:"absolute -left-1.5 -top-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white"})}),e.jsx("div",{className:"absolute top-0 bottom-0 left-16 right-0",children:I.map(({task:a,top:n,height:r,left:c,width:v,zIndex:S})=>e.jsx(de,{task:a,onUpdateStatus:x,onEdit:f,onViewSubtasks:()=>h(a),style:{top:`${n}px`,height:`${Math.max(r-4,80)}px`,left:`${c}%`,width:`calc(${v}% - 4px)`,zIndex:S}},a.id))})]}),y&&e.jsx(ce,{task:y,onClose:()=>h(null),onUpdateTask:N})]})},xe=t=>t>0?`en ${t} min`:t===0?"¡Ahora!":`hace ${Math.abs(t)} min`,ge=({tasksWithDiff:t})=>e.jsxs("div",{className:"bg-yellow-100 border-b-2 border-yellow-300 p-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(F,{name:"alert-triangle",className:"text-yellow-600",size:20}),e.jsx("h3",{className:"font-bold text-yellow-800 text-base",children:"Tareas Críticas Próximas"})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:t.map(({task:x,diff:f})=>e.jsxs("div",{className:"bg-white/70 p-2 rounded-lg border border-yellow-300 flex-shrink-0 w-60",children:[e.jsx("p",{className:"font-bold text-sm text-gray-800 truncate",children:x.text}),e.jsxs("p",{className:`text-xs font-semibold ${f<=0?"text-red-600 animate-pulse":"text-blue-600"}`,children:[x.time," (",xe(f),")"]})]},x.id))})]}),he=["Ali","Fer","Claudia","Admin"],fe=({kanbanHook:t,criticalTasks:x})=>{const{tasks:f,addTask:N,addMultipleTasks:l,updateTask:k,updateTaskStatus:y,deleteTask:h}=t,[d,i]=o.useState(new Date),[w,M]=o.useState(!1),[I,D]=o.useState(null),[a,n]=o.useState("All"),r=u=>{D(u),M(!0)},c=()=>{M(!1),D(null)},v=(u,A)=>{const{recurrence:E,selectedDays:p,...g}=u,j=new Date(g.date);if(j.setMinutes(j.getMinutes()+j.getTimezoneOffset()),A){const b=f.find(C=>C.id===A);if(!b)return;const T={...b,...g,id:A};if(k(T),E==="weekly"&&p&&p.length>0){const C=new Date(j),P=j.getDay(),H=j.getDate()-P+(P===0?-6:1);C.setDate(H);const R=j.getDay(),$=[];p.forEach(L=>{const _=parseInt(L,10);if(_===R)return;const z=new Date(C);_===0?z.setDate(C.getDate()+6):z.setDate(C.getDate()+(_-1)),z.setMinutes(z.getMinutes()-z.getTimezoneOffset()),$.push({...g,date:z.toISOString().split("T")[0]})}),$.length>0&&l($)}}else if(E==="weekly"&&p&&p.length>0){const b=new Date(j),T=j.getDay(),C=j.getDate()-T+(T===0?-6:1);b.setDate(C);const P=[];p.forEach(H=>{const R=parseInt(H,10),$=new Date(b);R===0?$.setDate(b.getDate()+6):$.setDate(b.getDate()+(R-1)),$.setMinutes($.getMinutes()-$.getTimezoneOffset()),P.push({...g,date:$.toISOString().split("T")[0]})}),l(P)}else N(g)},S=o.useMemo(()=>{const u=new Date(d);return u.setMinutes(u.getMinutes()-u.getTimezoneOffset()),u.toISOString().split("T")[0]},[d]),O=o.useMemo(()=>f.filter(u=>{const A=u.date===S,E=a==="All"||u.employee===a;return A&&E}),[f,S,a]);return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50",children:[x.length>0&&e.jsx(ge,{tasksWithDiff:x}),e.jsxs("div",{className:"operations-header flex flex-col p-4 border-b border-gray-200 gap-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center w-full gap-4",children:[e.jsx(oe,{selectedDate:d,setSelectedDate:i}),e.jsx("div",{className:"flex gap-2 w-full md:w-auto",children:e.jsxs("button",{onClick:()=>M(!0),className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm w-full justify-center",children:[e.jsx(F,{name:"plus-circle",size:16}),"Añadir Tarea"]})})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-200 rounded-lg p-1 w-full overflow-x-auto",children:[e.jsx("button",{onClick:()=>n("All"),className:`px-3 py-1 text-sm font-bold rounded-md transition-colors ${a==="All"?"bg-white shadow-sm":"bg-transparent text-gray-600"}`,children:"Todos"}),he.map(u=>e.jsx("button",{onClick:()=>n(u),className:`px-3 py-1 text-sm font-bold rounded-md transition-colors ${a===u?"bg-white shadow-sm":"bg-transparent text-gray-600"}`,children:u},u))]})]}),e.jsx("div",{className:"flex-grow overflow-auto relative",children:e.jsx(me,{tasks:O,onEditTask:r,onUpdateStatus:y,onUpdateTask:k})}),e.jsx(ne,{isOpen:w,onClose:c,onSave:v,onDelete:h,task:I,selectedDate:S})]})};export{fe as default};
