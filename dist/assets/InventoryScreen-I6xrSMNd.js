import{r as d,j as e,R as H,I as N,c as A}from"./index-BhvwMvOn.js";import{M as q}from"./Modal-DiwVflEb.js";const T=({isOpen:r,onClose:i,onUpdate:m,item:o,isAdding:t,providers:a})=>{const[l,u]=d.useState(""),[c,h]=d.useState(""),[p,v]=d.useState(""),[y,b]=d.useState(""),f=t?"Añadir":"Usar";d.useEffect(()=>{r&&(u(""),h(""),v(o.providerPreferido||(a.length>0?a[0].name:"")),b(""))},[r,o,a]);const j=n=>{n.preventDefault(),b("");const x=parseFloat(l);if(isNaN(x)||x<=0){b("Introduce una cantidad válida mayor que 0.");return}if(t){const g=parseFloat(c);if(isNaN(g)||g<0){b("Introduce un precio total válido.");return}m({itemId:o.id,change:x,purchaseDetails:{totalPrice:g,providerName:p}})}else m({itemId:o.id,change:-x});i()};return e.jsx(q,{isOpen:r,onClose:i,title:`${f} Stock`,children:e.jsxs("form",{onSubmit:j,className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{children:["Producto: ",e.jsx("span",{className:"font-bold",children:o.name})]}),e.jsxs("p",{children:["Stock Actual: ",o.currentStock," ",o.unit]})]}),e.jsx(E,{label:`Cantidad a ${f.toLowerCase()}`,children:e.jsx("input",{type:"number",value:l,onChange:n=>u(n.target.value),step:"any",min:"0.01",required:!0,autoFocus:!0})}),t&&e.jsxs(e.Fragment,{children:[e.jsx(E,{label:"Precio Total de la Compra ($)",children:e.jsx("input",{type:"number",value:c,onChange:n=>h(n.target.value),step:"any",min:"0",required:!0})}),e.jsx(E,{label:"Proveedor",children:e.jsxs("select",{value:p,onChange:n=>v(n.target.value),required:!0,children:[a.map(n=>e.jsx("option",{value:n.name,children:n.name},n.id)),e.jsx("option",{value:"Otro",children:"Otro"})]})})]}),y&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:y}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx("button",{type:"button",onClick:i,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:f})]})]})})},E=({label:r,children:i})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:r}),H.cloneElement(i,{className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),$=({icon:r,onClick:i,colorClass:m,title:o})=>e.jsx("button",{title:o,onClick:i,className:`w-10 h-10 flex items-center justify-center bg-gray-100 border border-gray-200 rounded-full transition-colors ${m}`,children:e.jsx(N,{name:r,size:20})}),L=({item:r,onEdit:i,onAddStock:m,onUseStock:o,onViewHistory:t})=>{const a=r.currentStock<=r.minStock,l=r.purchaseHistory&&r.purchaseHistory.length>0?r.purchaseHistory[r.purchaseHistory.length-1]:null,u=l?(l.totalPrice/l.quantity).toFixed(2):null;return e.jsxs("div",{className:`p-4 bg-white rounded-lg border flex flex-col md:flex-row md:items-center justify-between gap-4 ${a?"border-red-300 bg-red-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-bold text-lg",children:r.name}),e.jsxs("div",{className:"flex flex-wrap items-baseline gap-x-4 gap-y-1 text-sm",children:[e.jsxs("p",{children:["Stock: ",e.jsx("span",{className:"font-semibold",children:r.currentStock.toFixed(2)})," ",r.unit]}),e.jsxs("p",{className:"text-gray-500",children:["(Mín: ",r.minStock," ",r.unit,")"]}),u&&e.jsxs("p",{className:"text-gray-500 font-semibold",children:["Último Precio: $",u," / ",r.unit]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 justify-end",children:[e.jsx($,{icon:"plus",onClick:m,colorClass:"hover:bg-green-100 hover:text-green-600",title:"Añadir Stock"}),e.jsx($,{icon:"minus",onClick:o,colorClass:"hover:bg-red-100 hover:text-red-600",title:"Usar Stock"}),e.jsx($,{icon:"bar-chart-2",onClick:t,colorClass:"hover:bg-yellow-100 hover:text-yellow-600",title:"Historial de Precios"}),e.jsx($,{icon:"pencil",onClick:()=>i(r),colorClass:"hover:bg-blue-100 hover:text-blue-600",title:"Editar Producto"})]})]})},O=({isOpen:r,onClose:i,item:m})=>{const o=d.useMemo(()=>m.purchaseHistory?[...m.purchaseHistory].sort((a,l)=>new Date(l.date).getTime()-new Date(a.date).getTime()):[],[m.purchaseHistory]),t=d.useMemo(()=>!o||o.length===0?null:o.reduce((a,l)=>{const u=l.totalPrice/l.quantity;return u<a?u:a},1/0),[o]);return e.jsxs(q,{isOpen:r,onClose:i,title:`Historial de Precios: ${m.name}`,children:[e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[t&&t!==1/0&&e.jsx("div",{className:"p-3 mb-4 bg-green-100 border border-green-300 rounded-lg text-center",children:e.jsxs("p",{className:"font-bold text-green-800",children:["Mejor Precio Histórico: $",t.toFixed(2)," / ",m.unit]})}),o.length>0?e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"Fecha"}),e.jsx("th",{className:"p-2",children:"Proveedor"}),e.jsx("th",{className:"p-2",children:"Cant."}),e.jsx("th",{className:"p-2",children:"Total"}),e.jsx("th",{className:"p-2",children:"Unitario"})]})}),e.jsx("tbody",{children:o.map(a=>{const l=a.totalPrice/a.quantity,u=l.toFixed(2)===(t==null?void 0:t.toFixed(2));return e.jsxs("tr",{className:`border-b ${u?"bg-green-50":""}`,children:[e.jsx("td",{className:"p-2",children:new Date(a.date).toLocaleDateString()}),e.jsx("td",{className:"p-2",children:a.providerName}),e.jsxs("td",{className:"p-2",children:[a.quantity," ",m.unit]}),e.jsxs("td",{className:"p-2",children:["$",a.totalPrice.toFixed(2)]}),e.jsxs("td",{className:`p-2 font-bold ${u?"text-green-700":""}`,children:["$",l.toFixed(2)]})]},a.id)})})]}):e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No hay historial de compras para este producto."})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:i,className:"py-2 px-6 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cerrar"})})]})},z=({title:r,count:i,children:m,defaultOpen:o=!0,icon:t,colorClass:a="text-gray-800",bgClass:l="bg-gray-100"})=>{const[u,c]=d.useState(o);return e.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("button",{onClick:()=>c(!u),className:`w-full flex items-center justify-between p-4 transition-colors ${l} hover:brightness-95`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t&&e.jsx(N,{name:t,size:20,className:a}),e.jsx("h3",{className:`text-lg font-bold ${a}`,children:r}),i!==void 0&&e.jsx("span",{className:"bg-white px-2 py-0.5 rounded-full text-xs font-bold text-gray-500 shadow-sm",children:i})]}),e.jsx("div",{className:`text-gray-400 transition-transform duration-300 ${u?"rotate-90":""}`,children:e.jsx(N,{name:"chevron-right",size:20})})]}),e.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${u?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"}`,children:e.jsx("div",{className:"p-4 bg-white border-t border-gray-100",children:m})})]})},U=({items:r,onEdit:i,onRecordStockChange:m,providers:o})=>{const[t,a]=d.useState(null),[l,u]=d.useState(null),[c,h]=d.useState("name"),[p,v]=d.useState("all"),y=d.useMemo(()=>r.filter(n=>p==="all"?!0:(n.providerPreferido||"Sin Proveedor")===p),[r,p]),b=d.useMemo(()=>{const n=[...y];switch(c){case"name":n.sort((x,g)=>x.name.localeCompare(g.name));break;case"stockAsc":n.sort((x,g)=>x.currentStock/(x.minStock||1)-g.currentStock/(g.minStock||1));break;case"stockDesc":n.sort((x,g)=>g.currentStock-x.currentStock);break}return n},[y,c]),f=d.useMemo(()=>b.reduce((n,x)=>{const g=x.category||"Sin Categoría";return n[g]||(n[g]=[]),n[g].push(x),n},{}),[b]),j=Object.keys(f).sort();return r.length===0?e.jsx("p",{className:"text-center text-gray-500 mt-8",children:"No se encontraron productos."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 p-3 bg-white rounded-xl border border-gray-200 shadow-sm sticky top-0 z-20",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Ordenar por"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h("name"),className:`flex-1 py-1.5 px-3 rounded-lg text-sm font-medium border transition-colors ${c==="name"?"bg-blue-50 border-blue-300 text-blue-700":"bg-white border-gray-200 text-gray-600"}`,children:"A-Z"}),e.jsx("button",{onClick:()=>h("stockAsc"),className:`flex-1 py-1.5 px-3 rounded-lg text-sm font-medium border transition-colors ${c==="stockAsc"?"bg-blue-50 border-blue-300 text-blue-700":"bg-white border-gray-200 text-gray-600"}`,children:"Stock Bajo"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Filtrar Proveedor"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:p,onChange:n=>v(n.target.value),className:"w-full py-1.5 pl-2 pr-8 rounded-lg text-sm border border-gray-200 bg-white text-gray-700 focus:ring-2 focus:ring-blue-500 appearance-none",children:[e.jsx("option",{value:"all",children:"Todos los Proveedores"}),o.map(n=>e.jsx("option",{value:n.name,children:n.name},n.id)),e.jsx("option",{value:"Sin Proveedor",children:"Sin Proveedor"})]}),e.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none",children:e.jsx(N,{name:"chevron-right",size:14,className:"rotate-90"})})]})]})]}),e.jsxs("div",{className:"space-y-4 pb-20",children:[j.map(n=>e.jsx(z,{title:n,count:f[n].length,colorClass:"text-blue-800",bgClass:"bg-blue-50/50",children:e.jsx("div",{className:"space-y-3",children:f[n].map(x=>e.jsx(L,{item:x,onEdit:i,onAddStock:()=>a({item:x,isAdding:!0}),onUseStock:()=>a({item:x,isAdding:!1}),onViewHistory:()=>u(x)},x.id))})},n)),j.length===0&&e.jsx("div",{className:"text-center py-10 bg-gray-50 rounded-lg border border-dashed",children:e.jsx("p",{className:"text-gray-500",children:"No hay productos que coincidan con los filtros."})})]}),t&&e.jsx(T,{isOpen:!!t,onClose:()=>a(null),item:t.item,isAdding:t.isAdding,onUpdate:m,providers:o}),l&&e.jsx(O,{isOpen:!!l,onClose:()=>u(null),item:l})]})},B=({items:r,onRecordStockChange:i,providers:m})=>{const[o,t]=d.useState(null),a=r.filter(c=>c.currentStock<=c.minStock),l=a.reduce((c,h)=>{const p=h.providerPreferido||"Sin Proveedor";return c[p]||(c[p]=[]),c[p].push(h),c},{}),u=Object.keys(l).sort((c,h)=>c==="Sin Proveedor"?1:h==="Sin Proveedor"?-1:c.localeCompare(h));return a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"bg-green-100 p-4 rounded-full mb-4",children:e.jsx(N,{name:"check-circle",size:48,className:"text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"¡Todo en orden!"}),e.jsx("p",{className:"text-gray-500",children:"No hay productos por debajo del stock mínimo."})]}):e.jsxs("div",{className:"space-y-4 pb-20",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 p-4 rounded-xl flex items-center gap-4",children:[e.jsx("div",{className:"bg-white p-2 rounded-full shadow-sm",children:e.jsx(N,{name:"shopping-cart",className:"text-red-500",size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-red-800 text-lg",children:"Lista de Compras Activa"}),e.jsxs("p",{className:"text-red-600 text-sm",children:[a.length," productos requieren reabastecimiento."]})]})]}),u.map(c=>e.jsx(z,{title:c,count:l[c].length,icon:"store",colorClass:"text-gray-800",bgClass:"bg-white",children:e.jsx("div",{className:"space-y-3",children:l[c].map(h=>e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg flex flex-col sm:flex-row justify-between sm:items-center gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-800",children:h.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm mt-1",children:[e.jsxs("span",{className:"text-red-600 font-bold bg-red-100 px-2 py-0.5 rounded",children:["Quedan: ",h.currentStock," ",h.unit]}),e.jsxs("span",{className:"text-gray-500",children:["(Mín: ",h.minStock," ",h.unit,")"]})]})]}),e.jsxs("button",{onClick:()=>t(h),className:"flex-shrink-0 flex items-center justify-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm shadow-sm active:scale-95",children:[e.jsx(N,{name:"plus-circle",size:16}),"Comprar"]})]},h.id))})},c)),o&&e.jsx(T,{isOpen:!!o,onClose:()=>t(null),item:o,isAdding:!0,onUpdate:i,providers:m})]})},D=({isOpen:r,onClose:i,onSave:m,onDelete:o,item:t,providers:a,categories:l})=>{const[u,c]=d.useState(""),[h,p]=d.useState(""),[v,y]=d.useState(""),[b,f]=d.useState("0"),[j,n]=d.useState(A[0]),[x,g]=d.useState("0"),[I,S]=d.useState("");d.useEffect(()=>{r&&(c((t==null?void 0:t.name)||""),p((t==null?void 0:t.category)||(l.length>0?l[0].name:"")),y((t==null?void 0:t.providerPreferido)||""),f(String((t==null?void 0:t.currentStock)||0)),n((t==null?void 0:t.unit)||A[0]),g(String((t==null?void 0:t.minStock)||0)),S(""))},[r,t,l]);const F=s=>{s.preventDefault(),S("");const w=parseFloat(b),C=parseFloat(x);if(!u.trim()){S("El nombre es obligatorio.");return}if(!j.trim()){S("La unidad es obligatoria.");return}if(isNaN(w)||w<0){S("Stock debe ser un número positivo.");return}if(isNaN(C)||C<0){S("Nivel mínimo debe ser un número positivo.");return}if(t){const k={...t,name:u.trim(),category:h.trim()||"Sin Categoría",providerPreferido:v.trim(),currentStock:w,unit:j.trim(),minStock:C};m(k)}else{const k={name:u.trim(),category:h.trim()||"Sin Categoría",providerPreferido:v.trim(),currentStock:w,unit:j.trim(),minStock:C};m(k)}i()},M=()=>{t&&window.confirm(`¿Estás seguro de que quieres eliminar "${t.name}"?`)&&(o(t.id),i())};return e.jsx(q,{isOpen:r,onClose:i,title:t?"Editar Producto":"Añadir Producto",children:e.jsxs("form",{onSubmit:F,className:"flex flex-col gap-4",children:[e.jsx(P,{label:"Nombre del Producto",children:e.jsx("input",{type:"text",value:u,onChange:s=>c(s.target.value),required:!0})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Categoría",children:e.jsxs("select",{value:h,onChange:s=>p(s.target.value),children:[e.jsx("option",{value:"",children:"Sin Categoría"}),l.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]})}),e.jsx(P,{label:"Proveedor Preferido",children:e.jsxs("select",{value:v,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"",children:"Sin Proveedor"}),a.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Stock Actual",children:e.jsx("input",{type:"number",value:b,onChange:s=>f(s.target.value),step:"any",min:"0",required:!0})}),e.jsx(P,{label:"Unidad",children:e.jsx("select",{value:j,onChange:s=>n(s.target.value),required:!0,children:A.map(s=>e.jsx("option",{value:s,children:s},s))})})]}),e.jsx(P,{label:"Nivel Mínimo (para Alertas)",children:e.jsx("input",{type:"number",value:x,onChange:s=>g(s.target.value),step:"any",min:"0",required:!0})}),I&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:I}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("div",{children:t&&e.jsx("button",{type:"button",onClick:M,className:"py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700",children:"Eliminar"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:i,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Guardar"})]})]})]})})},P=({label:r,children:i})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:r}),H.cloneElement(i,{className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),V=({inventoryHook:r,providers:i,categories:m})=>{const{items:o,addItem:t,updateItem:a,deleteItem:l,recordStockChange:u}=r,[c,h]=d.useState("general"),[p,v]=d.useState(""),[y,b]=d.useState(!1),[f,j]=d.useState(null),n=s=>{j(s),b(!0)},x=()=>{j(null),b(!0)},g=()=>{b(!1),j(null)},I=s=>{"id"in s?a(s):t(s)},S=d.useMemo(()=>o.filter(s=>s.name.toLowerCase().includes(p.toLowerCase())),[o,p]),F=d.useMemo(()=>o.filter(s=>s.currentStock<=s.minStock).length,[o]),M=({view:s,label:w,icon:C,badge:k})=>e.jsxs("button",{onClick:()=>h(s),className:`relative flex items-center gap-2 py-3 px-4 text-sm md:text-base font-bold border-b-4 transition-colors ${c===s?"border-blue-600 text-blue-600 bg-blue-50/50":"border-transparent text-gray-500 hover:text-gray-800 hover:bg-gray-50"}`,children:[e.jsx(N,{name:C,size:18}),w,k!==void 0&&k>0&&e.jsx("span",{className:"ml-1 bg-red-500 text-white text-[10px] px-1.5 py-0.5 rounded-full",children:k})]});return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Inventario"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:[o.length," productos totales • ",F," alertas"]})]}),e.jsxs("button",{onClick:x,className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm shadow-sm",children:[e.jsx(N,{name:"plus-circle",size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Producto"})]})]}),e.jsxs("div",{className:"flex px-4 gap-1 overflow-x-auto",children:[e.jsx(M,{view:"general",label:"General",icon:"boxes"}),e.jsx(M,{view:"shopping-list",label:"Lista de Compras",icon:"shopping-cart",badge:F})]})]}),e.jsx("div",{className:"p-4 bg-gray-50 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400",children:[e.jsx(N,{name:"search",size:20})," "]}),e.jsx("input",{type:"search",value:p,onChange:s=>v(s.target.value),placeholder:"Buscar por nombre...",className:"w-full p-3 pl-4 border border-gray-300 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm transition-shadow"})]})}),e.jsx("div",{className:"flex-grow overflow-y-auto px-4 pb-4",children:c==="general"?e.jsx(U,{items:S,onEdit:n,onRecordStockChange:u,providers:i}):e.jsx(B,{items:S,onRecordStockChange:u,providers:i})}),e.jsx(D,{isOpen:y,onClose:g,onSave:I,onDelete:l,item:f,providers:i,categories:m})]})};export{V as default};
