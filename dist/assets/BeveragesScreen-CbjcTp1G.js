import{r as d,j as e,I as c}from"./index-CE1MFFCv.js";import{u as O}from"./useBeverages-BdwPV319.js";import{M}from"./Modal-dsQ9zPJa.js";import{S as E}from"./SwipeButton-CJC_Jtfy.js";const R=()=>{var I;const{beverages:r,createOrder:l}=O(),[n,b]=d.useState("beverage"),[x,h]=d.useState("all"),[o,m]=d.useState([]),[j,N]=d.useState(""),[p,v]=d.useState(""),[f,a]=d.useState(null),s=d.useMemo(()=>r.filter(t=>t.type===n||!t.type&&n==="beverage"),[r,n]),w=d.useMemo(()=>{const t=new Set(s.map(i=>i.category));return Array.from(t)},[s]),g=d.useMemo(()=>p.trim()?s.filter(t=>t.name.toLowerCase().includes(p.toLowerCase())):x==="all"?s:s.filter(t=>t.category===x),[s,x,p]),u=t=>{b(t),h("all"),v("")},k=t=>{t.hasSizes&&t.sizes&&t.sizes.length>0?a(t):C(t,void 0,t.recipe),v("")},C=(t,i,S)=>{const A={id:`item-${Date.now()}`,beverageId:t.id,beverageName:t.name,type:t.type||"beverage",sizeName:i,modifiers:[],recipeRef:S||t.recipe};m([...o,A]),a(null)},y=()=>{m(t=>t.slice(0,-1))},B=t=>{if(o.length===0)return;const i=[...o],S=i[i.length-1];S.modifiers.includes(t)||(S.modifiers.push(t),m(i))},T=()=>{if(o.length===0)return;const t=j.trim()||"Mostrador";l(t,o),N(""),m([])},z=Array.from(new Set(s.flatMap(t=>t.modifiers||[]))).slice(0,6);return e.jsxs("div",{className:"flex flex-col h-full md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"h-[60%] md:h-auto md:flex-1 flex flex-col bg-gray-100 border-r border-gray-200",children:[e.jsxs("div",{className:"p-1 md:p-2 bg-white flex gap-2 border-b border-gray-200 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>u("beverage"),className:`flex-1 py-2 md:py-3 rounded-lg font-bold flex items-center justify-center gap-2 transition-colors text-xs md:text-base ${n==="beverage"?"bg-blue-600 text-white":"bg-gray-100 text-gray-500"}`,children:[e.jsx(c,{name:"star",size:16,className:"md:w-5 md:h-5"}),"Bebidas"]}),e.jsxs("button",{onClick:()=>u("food"),className:`flex-1 py-2 md:py-3 rounded-lg font-bold flex items-center justify-center gap-2 transition-colors text-xs md:text-base ${n==="food"?"bg-orange-500 text-white":"bg-gray-100 text-gray-500"}`,children:[e.jsx(c,{name:"cake-slice",size:16,className:"md:w-5 md:h-5"}),"Comida"]})]}),e.jsx("div",{className:"px-2 pt-2 pb-1 bg-gray-100 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-2 md:pl-3 flex items-center pointer-events-none text-gray-400",children:e.jsx(c,{name:"list",size:16,className:"md:w-[18px]"})}),e.jsx("input",{type:"text",value:p,onChange:t=>v(t.target.value),placeholder:"Buscar...",className:"w-full pl-8 md:pl-10 pr-8 py-1.5 md:py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-sm"}),p&&e.jsx("button",{onClick:()=>v(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:e.jsx(c,{name:"x",size:16})})]})}),!p&&e.jsxs("div",{className:"flex gap-1 md:gap-2 p-1 md:p-2 bg-gray-100 overflow-x-auto flex-shrink-0 custom-scrollbar",children:[e.jsx("button",{onClick:()=>h("all"),className:`px-3 py-1.5 md:px-4 md:py-2 rounded-full font-bold capitalize flex-shrink-0 transition-colors border text-xs md:text-sm ${x==="all"?"bg-gray-700 text-white border-gray-700":"bg-white text-gray-600 border-gray-300"}`,children:"Todos"}),w.map(t=>e.jsx("button",{onClick:()=>h(t),className:`px-3 py-1.5 md:px-4 md:py-2 rounded-full font-bold capitalize flex-shrink-0 transition-colors border text-xs md:text-sm ${x===t?"bg-gray-700 text-white border-gray-700":"bg-white text-gray-600 border-gray-300"}`,children:t},t))]}),e.jsx("div",{className:"p-2 md:p-3 grid grid-cols-3 md:grid-cols-3 lg:grid-cols-4 gap-2 md:gap-3 overflow-y-auto content-start flex-grow",children:g.length>0?g.map(t=>e.jsxs("button",{onClick:()=>k(t),className:"bg-white p-1 md:p-4 h-20 md:h-28 rounded-lg shadow-sm border border-gray-200 hover:border-amber-500 hover:shadow-md transition-all flex flex-col items-center justify-center text-center active:scale-95 relative",children:[e.jsx("span",{className:"font-bold text-gray-800 leading-none text-xs md:text-base line-clamp-3",children:t.name}),t.hasSizes&&e.jsx("span",{className:"absolute top-1 right-1 text-[9px] md:text-[10px] bg-gray-100 text-gray-500 px-1 rounded",children:"Var"})]},t.id)):e.jsx("div",{className:"col-span-full text-center py-10 text-gray-400",children:e.jsx("p",{children:"No se encontraron productos."})})}),o.length>0&&z.length>0&&e.jsx("div",{className:"p-2 bg-gray-200 flex gap-2 overflow-x-auto flex-shrink-0",children:z.map(t=>e.jsxs("button",{onClick:()=>B(t),className:"px-2 py-1.5 md:px-3 md:py-2 bg-white rounded-full text-[10px] md:text-xs font-bold text-gray-700 border border-gray-300 shadow-sm hover:bg-blue-50 active:bg-blue-100 whitespace-nowrap",children:["+ ",t]},t))})]}),e.jsxs("div",{className:"h-[40%] md:h-auto w-full md:w-80 bg-white flex flex-col flex-shrink-0 border-l border-gray-200 shadow-xl z-10",children:[e.jsx("div",{className:"p-2 md:p-4 bg-gray-50 border-b border-gray-200",children:e.jsx("input",{type:"text",value:j,onChange:t=>N(t.target.value),placeholder:"Nombre / Mesa",className:"w-full p-2 border border-gray-300 rounded-md text-sm md:text-lg font-semibold"})}),e.jsx("div",{className:"flex-grow overflow-y-auto p-2 md:p-4 space-y-2 md:space-y-3",children:o.length===0?e.jsxs("div",{className:"text-center text-gray-400 mt-6 md:mt-10",children:[e.jsx(c,{name:"shopping-cart",size:32,className:"mx-auto mb-2 opacity-20"}),e.jsx("p",{className:"text-xs md:text-sm",children:"Ticket vacío"})]}):o.map((t,i)=>e.jsx("div",{className:`flex justify-between items-start pb-1 md:pb-2 border-b border-dashed border-gray-200 ${i===o.length-1?"opacity-100":"opacity-70"}`,children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-gray-800 text-sm md:text-base",children:[t.beverageName,t.sizeName&&e.jsxs("span",{className:"text-amber-700 ml-1 text-xs md:text-sm",children:["(",t.sizeName,")"]})]}),e.jsx("span",{className:`text-[10px] px-1 rounded ${t.type==="food"?"bg-orange-100 text-orange-800":"bg-blue-100 text-blue-800"}`,children:t.type==="food"?"COCINA":"BARRA"}),t.modifiers.length>0&&e.jsx("p",{className:"text-[10px] md:text-xs text-blue-600 mt-0.5",children:t.modifiers.join(", ")})]})},i))}),e.jsxs("div",{className:"p-2 md:p-4 bg-gray-50 border-t border-gray-200 grid grid-cols-2 gap-2 md:gap-3",children:[e.jsx("button",{onClick:y,disabled:o.length===0,className:"py-2 md:py-3 bg-gray-200 text-gray-600 font-bold rounded-lg disabled:opacity-50 flex items-center justify-center",children:e.jsx(c,{name:"rotate-ccw",className:"mx-auto",size:18})}),e.jsxs("button",{onClick:T,disabled:o.length===0,className:"py-2 md:py-3 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 shadow-md disabled:opacity-50 flex items-center justify-center gap-2 text-sm md:text-base",children:[e.jsx("span",{children:"ENVIAR"}),e.jsx(c,{name:"play-circle",size:18})]})]})]}),f&&e.jsx(M,{isOpen:!!f,onClose:()=>a(null),title:`Variante para: ${f.name}`,children:e.jsxs("div",{className:"flex flex-col gap-3",children:[(I=f.sizes)==null?void 0:I.map((t,i)=>e.jsx("button",{onClick:()=>C(f,t.name,t.recipe),className:"p-4 bg-blue-50 border border-blue-200 rounded-xl text-blue-800 font-bold text-lg hover:bg-blue-100 transition-colors",children:t.name},i)),e.jsx("button",{onClick:()=>a(null),className:"p-3 mt-2 bg-gray-100 text-gray-600 rounded-lg font-semibold",children:"Cancelar"})]})})]})},V=({timestamp:r})=>{const[l,n]=d.useState(0);d.useEffect(()=>{const x=()=>n(Math.floor((Date.now()-r)/6e4));x();const h=setInterval(x,6e4);return()=>clearInterval(h)},[r]);let b="bg-green-100 text-green-800";return l>=5&&(b="bg-yellow-100 text-yellow-800"),l>=10&&(b="bg-red-100 text-red-800 animate-pulse"),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${b}`,children:[l," min"]})},$=({type:r,inventoryHook:l})=>{const{activeOrders:n,completeOrder:b,cancelOrder:x,beverages:h}=O(),{recordStockChange:o}=l,[m,j]=d.useState(null),N=d.useMemo(()=>n.filter(a=>a.items.some(s=>(s.type||"beverage")===r)),[n,r]),p=a=>{a.items.forEach(s=>{if((s.type||"beverage")!==r)return;const g=h.find(y=>y.id===s.beverageId);if(!(g!=null&&g.stockConfig))return;const{mode:u,directItemId:k,ingredients:C}=g.stockConfig;u==="direct"&&k?o({itemId:k,change:-1,responsible:"KDS System",reason:`Venta: ${s.beverageName}`}):u==="recipe"&&C&&C.forEach(y=>{y.quantity>0&&o({itemId:y.inventoryItemId,change:-y.quantity,responsible:"KDS System",reason:`Insumo Venta: ${s.beverageName}`})})}),b(a.id)},v=r==="food"?"bg-orange-50 border-orange-200":"bg-blue-50 border-blue-200",f=r==="food"?"text-orange-500":"text-blue-600";return e.jsxs("div",{className:"h-full overflow-y-auto p-4 bg-gray-100",children:[N.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-400",children:[e.jsx(c,{name:r==="food"?"cake-slice":"star",size:64,className:"mb-4 text-gray-300"}),e.jsxs("p",{className:"text-xl font-bold",children:[r==="food"?"Cocina":"Barra"," Limpia"]}),e.jsx("p",{children:"Esperando pedidos..."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:N.map(a=>e.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:`p-3 border-b flex justify-between items-center ${v}`,children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg truncate max-w-[150px] text-gray-800",children:a.customerName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["#",a.id.slice(-4)]})]}),e.jsx(V,{timestamp:a.createdAt})]}),e.jsxs("div",{className:"p-4 flex-grow space-y-4",children:[a.items.filter(s=>(s.type||"beverage")===r).map((s,w)=>e.jsxs("div",{className:"flex items-start gap-2 animate-fadeIn",children:[e.jsx("div",{className:"mt-1",children:e.jsx("button",{onClick:()=>j({name:`${s.beverageName} ${s.sizeName?`(${s.sizeName})`:""}`,text:s.recipeRef||"Sin receta disponible."}),className:`p-1 rounded-full transition-colors hover:bg-gray-100 ${f}`,title:"Ver Instrucción",children:e.jsx(c,{name:"list",size:18})})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-gray-800 text-lg leading-tight",children:[s.beverageName,s.sizeName&&e.jsxs("span",{className:"text-gray-500 ml-1 text-base font-bold",children:["(",s.sizeName,")"]})]}),s.modifiers.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.modifiers.map((g,u)=>e.jsx("span",{className:"bg-gray-100 text-gray-700 px-2 py-0.5 rounded text-xs font-bold border border-gray-200",children:g},u))})]})]},w)),a.items.some(s=>(s.type||"beverage")!==r)&&e.jsx("div",{className:"pt-2 border-t border-dashed border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-400 italic text-center",children:["+ ",a.items.filter(s=>(s.type||"beverage")!==r).length," items en otra estación"]})})]}),e.jsxs("div",{className:"p-3 border-t border-gray-100 bg-gray-50",children:[e.jsx(E,{onSwipe:()=>p(a),text:"Completar",icon:"check",className:"bg-white border-gray-300 shadow-sm h-12"}),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{onClick:()=>{confirm("¿Cancelar ticket entero?")&&x(a.id)},className:"text-xs text-gray-400 hover:text-red-500",children:"Cancelar Ticket"})})]})]},a.id))}),m&&e.jsxs(M,{isOpen:!!m,onClose:()=>j(null),title:m.name,children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 text-gray-800 whitespace-pre-wrap font-medium text-lg",children:m.text}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>j(null),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold shadow-md text-lg w-full",children:"¡Entendido!"})})]})]})},q=({inventoryHook:r})=>{const[l,n]=d.useState("pos");return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("header",{className:"flex-shrink-0 bg-white border-b border-gray-200 p-2 overflow-x-auto",children:e.jsxs("div",{className:"flex justify-center gap-2 min-w-max",children:[e.jsxs("button",{onClick:()=>n("pos"),className:`flex items-center gap-2 px-4 py-2 rounded-full font-bold transition-all ${l==="pos"?"bg-gray-800 text-white shadow-md":"text-gray-500 hover:bg-gray-100"}`,children:[e.jsx(c,{name:"plus-circle",size:18}),"Comanda (POS)"]}),e.jsx("div",{className:"w-px bg-gray-300 mx-2 h-8 self-center"}),e.jsxs("button",{onClick:()=>n("kds-bar"),className:`flex items-center gap-2 px-4 py-2 rounded-full font-bold transition-all ${l==="kds-bar"?"bg-blue-600 text-white shadow-md":"text-gray-500 hover:bg-gray-100"}`,children:[e.jsx(c,{name:"star",size:18}),"Barra (KDS)"]}),e.jsxs("button",{onClick:()=>n("kds-kitchen"),className:`flex items-center gap-2 px-4 py-2 rounded-full font-bold transition-all ${l==="kds-kitchen"?"bg-orange-500 text-white shadow-md":"text-gray-500 hover:bg-gray-100"}`,children:[e.jsx(c,{name:"cake-slice",size:18}),"Cocina (KDS)"]})]})}),e.jsxs("div",{className:"flex-grow overflow-hidden relative",children:[l==="pos"&&e.jsx(R,{}),l==="kds-bar"&&e.jsx($,{type:"beverage",inventoryHook:r}),l==="kds-kitchen"&&e.jsx($,{type:"food",inventoryHook:r})]})]})};export{q as default};
