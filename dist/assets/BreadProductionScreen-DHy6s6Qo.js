import{r as f,j as e,I as b}from"./index-BcEhsMjZ.js";import{M as E}from"./Modal-pn_fuNFk.js";const D=({isOpen:a,onClose:l,onSelectRecipe:o,onSelectHeating:m,recipes:i})=>{var v;const[t,s]=f.useState(null),g=r=>{!r.variants||r.variants.length===0?(o(r),l()):s(r)},x=r=>{t&&o(t,r),d(),l()},d=()=>{s(null)},y=(r,N)=>{d(),m(r,N),l()},u=i.filter(r=>r.name.toLowerCase().includes("(horneado)")),p=i.filter(r=>!r.name.toLowerCase().includes("(horneado)")),h=t?`Variantes de: ${t.name}`:"Iniciar un Nuevo Proceso";return e.jsx(E,{isOpen:a,onClose:l,title:h,children:t?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>x("base"),className:"w-full p-4 bg-blue-100 text-blue-800 rounded-lg border border-blue-200 hover:bg-blue-200 hover:border-blue-300 transition-colors text-left",children:[e.jsx("p",{className:"font-bold",children:t.baseVariantName||"Receta EstÃ¡ndar"}),t.baseVariantDescription&&e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:t.baseVariantDescription})]}),(v=t.variants)==null?void 0:v.map(r=>e.jsxs("button",{onClick:()=>x(r.id),className:"w-full p-4 bg-gray-100 text-gray-800 rounded-lg border border-gray-200 hover:bg-gray-200 hover:border-gray-300 transition-colors text-left",children:[e.jsx("p",{className:"font-bold",children:r.name}),r.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r.description})]},r.id)),e.jsx("button",{onClick:d,className:"mt-4 text-sm text-gray-600 hover:underline font-semibold",children:"â† Volver a recetas"})]}):e.jsxs("div",{className:"flex flex-col gap-6 max-h-[70vh] overflow-y-auto pr-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-blue-700 mb-2 flex items-center gap-2 pb-1 border-b border-blue-100",children:[e.jsx("span",{children:"ðŸ¥£"})," ElaboraciÃ³n de Masas"]}),e.jsx("div",{className:"flex flex-col gap-3",children:p.length>0?p.map(r=>e.jsx("button",{onClick:()=>g(r),className:"w-full p-3 bg-white text-gray-800 font-bold rounded-lg border border-gray-200 hover:bg-blue-50 hover:border-blue-300 transition-colors text-left shadow-sm",children:r.name},r.id)):e.jsx("p",{className:"text-sm text-gray-400 italic px-2",children:"No hay recetas de masas configuradas."})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-orange-700 mb-2 flex items-center gap-2 pb-1 border-b border-orange-100",children:[e.jsx("span",{children:"ðŸ”¥"})," Horneado Final"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:u.length>0?u.map(r=>e.jsx("button",{onClick:()=>g(r),className:"w-full p-3 bg-orange-50 text-gray-800 font-bold rounded-lg border border-orange-200 hover:bg-orange-100 hover:border-orange-300 transition-colors text-left shadow-sm",children:r.name.replace(/\(Horneado\)/i,"").trim()},r.id)):e.jsx("p",{className:"text-sm text-gray-400 italic px-2",children:"No hay recetas de horneado configuradas."})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-600 mb-2 flex items-center gap-2 pb-1 border-b border-gray-200",children:[e.jsx("span",{children:"â±ï¸"})," Herramientas"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>y(15*60,"Precalentar (15 min)"),className:"w-full p-3 flex flex-col items-center justify-center gap-1 bg-gray-50 text-gray-700 font-bold rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors text-sm",children:[e.jsx(b,{name:"thermometer-snowflake",size:20}),e.jsx("span",{children:"Precalentar"})]}),e.jsxs("button",{onClick:()=>y(7*60,"Recalentar (7 min)"),className:"w-full p-3 flex flex-col items-center justify-center gap-1 bg-gray-50 text-gray-700 font-bold rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors text-sm",children:[e.jsx(b,{name:"thermometer-sun",size:20}),e.jsx("span",{children:"Recalentar"})]})]})]})]})})},$=({onSwipe:a,text:l,icon:o="chevron-right",className:m="bg-gray-100 border-gray-300",disabled:i=!1})=>{const[t,s]=f.useState(!1),[g,x]=f.useState(0),[d,y]=f.useState(!1),u=f.useRef(null),p=f.useRef(null);f.useEffect(()=>{i&&(x(0),s(!1))},[i]);const h=()=>{i||d||s(!0)},v=w=>{if(!t||!u.current||!p.current)return;const c=u.current.getBoundingClientRect(),S=p.current.offsetWidth,n=c.width-S-8;let k=w-c.left-S/2;k=Math.max(0,Math.min(k,n)),x(k)},r=()=>{if(!t||!u.current||!p.current)return;const c=u.current.getBoundingClientRect().width-p.current.offsetWidth-8,S=c*.9;g>=S?(x(c),y(!0),a(),setTimeout(()=>{y(!1),x(0)},1e3)):x(0),s(!1)},N=()=>h(),j=w=>t&&v(w.clientX),P=()=>r(),R=()=>t&&r(),I=()=>h(),M=w=>t&&v(w.touches[0].clientX),z=()=>r();return e.jsxs("div",{className:`relative h-14 rounded-full overflow-hidden select-none shadow-inner border ${i?"opacity-50 cursor-not-allowed":"cursor-pointer"} ${m}`,ref:u,onMouseMove:j,onMouseUp:P,onMouseLeave:R,onTouchMove:M,onTouchEnd:z,children:[e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center z-0",children:[e.jsx("span",{className:`text-sm font-bold uppercase tracking-widest transition-opacity duration-300 ${t?"opacity-50":"text-gray-500"}`,children:d?"Â¡Completado!":l}),!d&&!t&&e.jsx("div",{className:"absolute right-4 animate-pulse text-gray-400",children:e.jsx(b,{name:"chevron-right",size:20})})]}),e.jsx("div",{ref:p,className:`absolute top-1 bottom-1 left-1 w-12 rounded-full flex items-center justify-center z-10 shadow-md border border-gray-100 transition-transform duration-100 ease-out ${d?"bg-green-500":"bg-white"}`,style:{transform:`translateX(${g}px)`,transition:t?"none":"transform 0.3s ease-out"},onMouseDown:N,onTouchStart:I,children:e.jsx(b,{name:d?"check":o,className:d?"text-white":"text-blue-600",size:24})}),e.jsx("div",{className:"absolute top-0 bottom-0 left-0 bg-green-500/20 z-0 transition-all duration-100 ease-out",style:{width:`${g+24}px`}})]})},A=a=>{(isNaN(a)||a<0)&&(a=0);const l=Math.floor(a/60),o=a%60;return`${String(l).padStart(2,"0")}:${String(o).padStart(2,"0")}`},F=({step:a,isCompleted:l,isCurrent:o})=>{let m="text-gray-500",i="border-gray-300 text-gray-300",t="";return o?(m="font-bold text-gray-900",a.type==="passive"?(i="border-teal-500 bg-teal-500 text-white animate-pulse",t="bg-teal-50/80 shadow-md -mx-2 px-3 py-3 rounded-lg border-l-4 border-teal-500 transition-all duration-300 my-1"):(i="border-blue-600 bg-blue-600 text-white animate-pulse",t="bg-blue-50/80 shadow-md -mx-2 px-3 py-3 rounded-lg border-l-4 border-blue-600 transition-all duration-300 my-1")):l?(m="text-gray-400 line-through decoration-gray-400",i="border-green-500 text-green-500 bg-green-50",t="py-1 opacity-75"):t="py-1",e.jsxs("div",{className:`flex items-center gap-3 transition-all duration-300 ${t}`,children:[e.jsx("div",{className:`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${i}`,children:l?e.jsx(b,{name:"check",size:12}):o?e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"}):null}),e.jsx("div",{className:"flex-grow",children:e.jsx("p",{className:`text-sm leading-tight ${m}`,children:a.instruction})}),o&&e.jsx("span",{className:`text-[10px] font-bold uppercase px-2 py-1 rounded-full flex-shrink-0 shadow-sm ${a.type==="passive"?"bg-white text-teal-700 border border-teal-200":"bg-white text-blue-700 border border-blue-200"}`,children:a.type==="passive"?"Espera":"Manual"})]})},T=({process:a,onAdvance:l,onPrevious:o,onTogglePause:m,onCancel:i,onAcknowledgeFinish:t})=>{var n;const{state:s,name:g,steps:x,currentStepIndex:d,totalTimeLeft:y,stepTimeLeft:u}=a,[p,h]=f.useState(!1),[v,r]=f.useState(!1),N=x[d],j=(N==null?void 0:N.type)==="passive",P=s==="paused"||s==="intermission",R={card:"bg-teal-50 text-teal-900 border-teal-300",header:"bg-teal-100/60 border-b border-teal-200",textMain:"text-teal-800",textSub:"text-teal-600",timer:"text-teal-700",stepList:"bg-white/80 border-teal-200",controls:"border-t border-teal-200 pt-3"},I={card:"bg-white text-gray-800 border-blue-500",header:"bg-blue-50/60 border-b border-blue-100",textSub:"text-gray-500",timer:"text-blue-700",stepList:"bg-gray-50 border-gray-200",controls:"border-t border-gray-100 pt-3"},M={card:"bg-amber-50 text-amber-900 border-amber-400 shadow-md",header:"bg-amber-100 border-b border-amber-200",textMain:"text-amber-800",textSub:"text-amber-700 font-bold",timer:"text-amber-700",stepList:"bg-white/60 border-amber-200",controls:"border-t border-amber-200 pt-3"},z={card:"bg-red-50 text-red-900 border-red-500 animate-pulse-red",header:"bg-red-100 border-b border-red-200",textMain:"text-red-700",textSub:"text-red-600",timer:"text-red-600 animate-pulse",stepList:"bg-white border-red-200",controls:"border-t border-red-200 pt-3"},w={card:"bg-green-50 text-green-900 border-green-600",header:"bg-green-100 border-b border-green-200",textMain:"text-green-700",textSub:"text-green-600",timer:"text-green-700",stepList:"bg-white border-green-200",controls:"border-t border-green-200 pt-3"};let c=I;s==="finished"?c=w:s==="alarm"?c=z:P?c=M:j&&(c=R);const S=()=>{if(s==="finished")return e.jsx("button",{onClick:()=>t(a),className:"w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition-colors shadow-sm uppercase tracking-wider",children:"Terminar y Archivar"});if(s==="alarm")return e.jsx($,{onSwipe:()=>l(a.id),text:"Deslizar para apagar alarma",icon:"check-circle",className:"bg-red-100 border-red-300"});if(v)return e.jsxs("div",{className:"flex flex-col gap-2 bg-orange-50 p-3 rounded-lg border border-orange-200 animate-fadeIn",children:[e.jsx("p",{className:"text-xs font-bold text-orange-800 text-center",children:"Â¿Regresar? Se perderÃ¡ el progreso de este paso."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r(!1),className:"flex-1 py-2 px-3 bg-white border border-gray-300 text-gray-700 font-bold rounded-lg text-xs hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:()=>{o(a.id),r(!1)},className:"flex-1 py-2 px-3 bg-orange-500 text-white font-bold rounded-lg text-xs hover:bg-orange-600 shadow-sm",children:"SÃ­, Regresar"})]})]});const k=d>0,C=s==="paused"||s==="intermission";return e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>r(!0),disabled:!k,className:`p-3 rounded-lg transition-colors flex-shrink-0 ${k?"bg-white border border-gray-200 hover:bg-gray-50 text-gray-700 shadow-sm":"bg-transparent border border-transparent text-gray-300 cursor-not-allowed"}`,title:"Paso Anterior",children:e.jsx(b,{name:"rotate-ccw",size:20})}),e.jsxs("button",{onClick:()=>m(a.id),className:`flex-grow flex items-center justify-center gap-2 font-bold rounded-lg transition-colors shadow-sm border text-sm md:text-base ${C?"bg-green-500 text-white border-green-600 hover:bg-green-600 animate-pulse":"bg-amber-100 text-amber-900 border-amber-300 hover:bg-amber-200"}`,children:[e.jsx(b,{name:C?"play-circle":"minus",size:20}),C?s==="intermission"?"INICIAR SIGUIENTE":"REANUDAR":"PAUSAR"]})]}),e.jsx("div",{className:"relative z-0",children:e.jsx($,{onSwipe:()=>l(a.id),text:"Deslizar al completar",disabled:s==="intermission",className:P?"bg-amber-100 border-amber-300":j?"bg-teal-100 border-teal-300":"bg-gray-100 border-gray-300"})})]})};return p?e.jsxs("div",{className:"flex flex-col bg-white rounded-xl border-2 border-red-400 shadow-lg p-6 justify-center items-center text-center min-h-[320px]",children:[e.jsx("div",{className:"bg-red-100 p-4 rounded-full mb-4",children:e.jsx(b,{name:"alert-triangle",size:40,className:"text-red-600"})}),e.jsx("h4",{className:"font-bold text-xl mb-2 text-gray-800",children:"Â¿Cancelar Proceso?"}),e.jsxs("p",{className:"text-gray-600 mb-8",children:["Se perderÃ¡ el progreso actual de ",e.jsx("span",{className:"font-bold",children:g}),"."]}),e.jsxs("div",{className:"flex gap-4 w-full",children:[e.jsx("button",{onClick:()=>h(!1),className:"flex-1 py-3 px-4 bg-gray-100 text-gray-800 font-bold rounded-lg hover:bg-gray-200",children:"Volver"}),e.jsx("button",{onClick:()=>i(a.id),className:"flex-1 py-3 px-4 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 shadow-md",children:"SÃ­, Cancelar"})]})]}):e.jsxs("div",{className:`flex flex-col rounded-xl border-2 shadow-sm hover:shadow-md transition-all duration-300 overflow-hidden ${c.card}`,children:[e.jsxs("header",{className:`p-4 flex justify-between items-start ${c.header}`,children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-xl leading-tight flex items-center gap-2 text-gray-800",children:[j?e.jsx(b,{name:"thermometer",className:s==="running"?"animate-pulse text-teal-600":"text-teal-600"}):e.jsx(b,{name:"cake-slice",className:"text-blue-600"}),g]}),e.jsx("p",{className:`text-xs font-bold uppercase tracking-wider mt-1 ${c.textSub}`,children:s==="running"?j?"â€¢ Proceso AutomÃ¡tico":"â€¢ AcciÃ³n Requerida":s==="paused"?"â€¢ En Pausa - Requiere AtenciÃ³n":s==="intermission"?"â€¢ Listo para iniciar - Dale Play":s==="alarm"?"â€¢ Â¡TIEMPO TERMINADO!":"â€¢ Finalizado"})]}),j&&s==="running"&&e.jsx("div",{className:"flex flex-col items-end",children:e.jsx("span",{className:"bg-white border border-teal-300 text-teal-700 px-3 py-1 rounded-full text-xs font-bold shadow-sm animate-pulse",children:"LIBRE"})})]}),d===0&&((n=a.recipe)==null?void 0:n.setupInstruction)&&e.jsx("div",{className:"bg-yellow-100 border-b-2 border-yellow-300 p-3 mb-0",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(b,{name:"settings",className:"text-yellow-700 mt-1 flex-shrink-0",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-yellow-700 uppercase tracking-wider mb-0.5",children:"ConfiguraciÃ³n Inicial"}),e.jsx("p",{className:"text-sm font-medium text-yellow-900 leading-snug",children:a.recipe.setupInstruction})]})]})}),e.jsxs("div",{className:"p-4 flex-grow flex flex-col justify-between gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center relative",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest mb-1 block opacity-60",children:"Tiempo Restante"}),e.jsx("p",{className:`text-7xl font-bold tabular-nums tracking-tighter leading-none ${c.timer} transition-colors duration-500`,children:A(u)})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs font-semibold opacity-60",children:[e.jsx(b,{name:"rotate-ccw",size:12}),e.jsxs("span",{children:["Total lote: ",A(y)]})]})]}),e.jsx("div",{className:`rounded-lg border overflow-hidden flex flex-col max-h-48 ${c.stepList}`,children:e.jsx("div",{className:"overflow-y-auto p-2 space-y-1 custom-scrollbar",children:x.map((k,C)=>e.jsx(F,{step:k,isCompleted:C<d,isCurrent:C===d&&s!=="finished"},C))})}),e.jsxs("div",{className:`${c.controls}`,children:[S(),s!=="finished"&&s!=="alarm"&&e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{onClick:()=>h(!0),className:"text-xs text-gray-400 hover:text-red-500 font-semibold px-2 py-1 transition-colors",children:"Cancelar Todo"})})]})]})]})},L=({rating:a,setRating:l})=>e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3,4,5].map(o=>e.jsx("button",{type:"button",onClick:()=>l(o),onMouseEnter:()=>{},onMouseLeave:()=>{},className:"transition-transform transform hover:scale-125",children:e.jsx(b,{name:"star",size:40,className:`cursor-pointer ${o<=a?"text-yellow-400 fill-current":"text-gray-300"}`})},o))}),B=({isOpen:a,processName:l,onSave:o,onSkip:m})=>{const[i,t]=f.useState(3),[s,g]=f.useState(""),x=()=>{o(i,s)};return e.jsx(E,{isOpen:a,onClose:m,title:`Feedback para: ${l}`,children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"Â¿QuÃ© tal saliÃ³ el resultado?"}),e.jsx(L,{rating:i,setRating:t})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedback-notes",className:"block text-sm font-medium text-gray-600 mb-1",children:"Notas (Opcional)"}),e.jsx("textarea",{id:"feedback-notes",value:s,onChange:d=>g(d.target.value),rows:4,placeholder:"Ej: El color fue perfecto, pero la prÃ³xima vez intentarÃ© con 1 minuto menos...",className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("button",{type:"button",onClick:m,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Omitir"}),e.jsx("button",{type:"button",onClick:x,className:"py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Guardar"})]})]})})},V=({productionHook:a,recipeLogHook:l,recipesHook:o})=>{const[m,i]=f.useState(!1),[t,s]=f.useState(null),{processes:g,startBakingProcess:x,startHeatingProcess:d,advanceProcess:y,goToPreviousStep:u,togglePauseProcess:p,cancelProcess:h,isSoundMuted:v,toggleSoundMute:r,isAudioReady:N,isSuspended:j,unlockAudio:P}=a,{addFeedback:R}=l,{recipes:I}=o,M=n=>{n.type==="baking"&&n.recipeId?s(n):h(n.id)},z=(n,k)=>{t&&t.recipeId&&(R({recipeId:t.recipeId,rating:n,notes:k}),h(t.id)),s(null)},w=()=>{t&&h(t.id),s(null)},c=g.filter(n=>n.state!=="finished"),S=g.filter(n=>n.state==="finished");return e.jsxs("div",{className:"p-4 md:p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-xl font-bold text-blue-700",children:"Procesos Activos"}),e.jsx("button",{onClick:j?P:r,title:j?"Sonidos bloqueados por el navegador. Haz clic para activar.":v?"Activar Sonidos":"Silenciar Sonidos",className:`p-2 rounded-full transition-colors ${j?"text-yellow-600 animate-pulse":"text-gray-500 hover:text-blue-600 hover:bg-gray-100"}`,children:e.jsx(b,{name:v||j?"volume-x":"volume-2",size:20})})]}),e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(b,{name:"plus-circle",size:16}),"Iniciar Proceso"]})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto",children:[c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(n=>e.jsx(T,{process:n,onAdvance:y,onPrevious:u,onTogglePause:p,onCancel:h,onAcknowledgeFinish:()=>{},isAudioReady:N},n.id))}):e.jsxs("div",{className:"text-center py-16 text-gray-500",children:[e.jsx("p",{children:"No hay procesos activos en este momento."}),e.jsx("p",{children:'Haz clic en "Iniciar Proceso" para comenzar.'})]}),S.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-600",children:"Finalizados Recientemente"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:S.map(n=>e.jsx(T,{process:n,onAdvance:y,onPrevious:u,onTogglePause:()=>{},onCancel:h,onAcknowledgeFinish:()=>M(n),isAudioReady:N},n.id))})]})]}),e.jsx(D,{isOpen:m,onClose:()=>i(!1),onSelectRecipe:x,onSelectHeating:d,recipes:I}),t&&e.jsx(B,{isOpen:!!t,processName:t.name,onSave:z,onSkip:w})]})};export{V as default};
