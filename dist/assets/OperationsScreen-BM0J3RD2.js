import{r,j as e,I,T as je,a as Ne,b as ve,O as we}from"./index-uUIEVMaR.js";import{M as be}from"./Modal-CGiVdZQ0.js";const Se=[{label:"L",value:"1"},{label:"M",value:"2"},{label:"M",value:"3"},{label:"J",value:"4"},{label:"V",value:"5"},{label:"S",value:"6"},{label:"D",value:"0"}],Te=({isOpen:s,onClose:g,onSave:f,onDelete:S,task:t,selectedDate:T,users:y,editMode:p,isSaving:N,allTasks:k})=>{const[D,h]=r.useState(""),[P,W]=r.useState(""),[o,b]=r.useState("08"),[l,c]=r.useState("00"),[j,u]=r.useState("AM"),[O,v]=r.useState("30"),[n,i]=r.useState("pre-apertura"),[m,C]=r.useState(""),[$,z]=r.useState(!1),[E,q]=r.useState(""),[A,F]=r.useState("once"),[X,Z]=r.useState([]),[J,de]=r.useState("4"),[U,Q]=r.useState([]),[ee,re]=r.useState(""),[ue,le]=r.useState(T),[G,me]=r.useState(!0),[oe,te]=r.useState("");r.useEffect(()=>{if(s){const a=y.length>0?y[0].name:"";me(!!(t!=null&&t.date)||p==="new"),h((t==null?void 0:t.text)||""),W((t==null?void 0:t.employee)||a),te((t==null?void 0:t.addedBy)||a),le((t==null?void 0:t.date)||T);const x=(t==null?void 0:t.time)||"08:00",[M,ne]=x.split(":").map(Number),H=M>=12?"PM":"AM";let w=M%12;if(w===0&&(w=12),b(String(w).padStart(2,"0")),c(String(ne).padStart(2,"0")),u(H),v(String((t==null?void 0:t.duration)||"30")),i((t==null?void 0:t.shift)||"pre-apertura"),C((t==null?void 0:t.zone)||""),z((t==null?void 0:t.isCritical)||!1),q((t==null?void 0:t.notes)||""),Q((t==null?void 0:t.subtasks)||[]),re(""),t&&p==="future"&&t.recurrenceId){F("weekly");const V=k.filter(L=>L.recurrenceId===t.recurrenceId),R=new Set;V.forEach(L=>{if(L.date){const B=new Date(L.date);B.setMinutes(B.getMinutes()+B.getTimezoneOffset());const ie=B.getDay();R.add(String(ie))}}),Z(Array.from(R))}else F("once"),Z([]);de("4")}},[s,t,y,T,p,k]);const ge=a=>{Z(x=>x.includes(a)?x.filter(M=>M!==a):[...x,a])},se=()=>{if(ee.trim()==="")return;const a={id:`sub-${Date.now()}`,text:ee.trim(),isCompleted:!1};Q([...U,a]),re("")},ae=a=>{a.key==="Enter"&&(a.preventDefault(),se())},pe=a=>{Q(U.filter(x=>x.id!==a))},xe=a=>{if(a.preventDefault(),!D||!oe){alert("Por favor completa el nombre de la tarea y quién la añadió.");return}if(G&&A==="weekly"&&X.length===0&&p!=="single"){alert("Por favor selecciona al menos un día para la tarea recurrente.");return}let x=parseInt(o,10);j==="PM"&&x!==12?x+=12:j==="AM"&&x===12&&(x=0);const M=`${String(x).padStart(2,"0")}:${l}`,ne={text:D,employee:P,addedBy:oe,duration:parseInt(O,10),shift:n,zone:m,isCritical:$,notes:E,subtasks:U,...G&&{time:M,date:ue,recurrence:A,selectedDays:X,recurrenceWeeks:J}};f(ne,t==null?void 0:t.id)},he=()=>{t&&S(t)},d=!!t;return e.jsx(be,{isOpen:s,onClose:N?()=>{}:g,title:t?"Editar Tarea":"Añadir Nueva Tarea",children:e.jsxs("form",{onSubmit:xe,className:"flex flex-col gap-4 max-h-[80vh] overflow-y-auto pr-2",children:[e.jsxs("fieldset",{disabled:N,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Nombre de la Tarea"}),e.jsx("input",{type:"text",value:D,onChange:a=>h(a.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Asignada a"}),e.jsx("select",{value:P,onChange:a=>W(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:y.map(a=>e.jsx("option",{value:a.name,children:a.name},a.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Añadida por"}),e.jsx("select",{value:oe,onChange:a=>te(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:y.map(a=>e.jsx("option",{value:a.name,children:a.name},a.id))})]})]}),e.jsx("div",{className:"form-group mt-4 p-3 bg-gray-100 rounded-lg",children:e.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Planificar fecha y hora"}),e.jsx("div",{className:`w-11 h-6 rounded-full p-1 transition-colors ${G?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full shadow-md transform transition-transform ${G?"translate-x-5":""}`})}),e.jsx("input",{type:"checkbox",checked:G,onChange:a=>{const x=a.target.checked;if(me(x),x&&!(t!=null&&t.date)){const M=new Date;M.setMinutes(M.getMinutes()-M.getTimezoneOffset()),le(M.toISOString().split("T")[0])}},className:"hidden"})]})}),G&&e.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[(p==="single"||p==="new")&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Fecha"}),e.jsx("input",{type:"date",value:ue,onChange:a=>le(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("fieldset",{disabled:d&&p!=="future",className:"",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Repetición"}),e.jsxs("div",{className:"flex gap-2 bg-gray-200 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>F("once"),className:`flex-1 p-2 rounded-md text-sm font-bold transition-colors ${A==="once"?"bg-white shadow-sm":""}`,children:"Una vez"}),e.jsx("button",{type:"button",onClick:()=>F("weekly"),className:`flex-1 p-2 rounded-md text-sm font-bold transition-colors ${A==="weekly"?"bg-white shadow-sm":""}`,children:"Semanalmente"})]}),d&&p==="single"&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"La repetición no se puede cambiar al editar una sola instancia."}),d&&p==="future"&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 text-sm rounded-r-lg flex items-start gap-3",children:[e.jsx(I,{name:"alert-triangle",size:20,className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"Atención"}),e.jsx("p",{children:"Cambiar la repetición reemplazará todas las futuras tareas de esta serie."})]})]})]}),A==="weekly"&&e.jsxs("div",{className:"flex flex-col gap-4 mt-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Días de la semana"}),e.jsx("div",{className:"flex justify-between gap-1",children:Se.map(({label:a,value:x})=>e.jsx("button",{type:"button",onClick:()=>ge(x),className:`w-9 h-9 flex items-center justify-center font-bold rounded-full border-2 transition-colors ${X.includes(x)?"bg-blue-600 text-white border-blue-600":"bg-gray-100 border-gray-300"}`,children:a},x))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Repetir durante"}),e.jsxs("select",{value:J,onChange:a=>de(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{value:"4",children:"4 semanas"}),e.jsx("option",{value:"8",children:"8 semanas"}),e.jsx("option",{value:"12",children:"12 semanas"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Hora"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("select",{value:o,onChange:a=>b(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Array.from({length:12},(a,x)=>x+1).map(a=>e.jsx("option",{value:String(a).padStart(2,"0"),children:String(a).padStart(2,"0")},a))}),e.jsx("select",{value:l,onChange:a=>c(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Array.from({length:60},(a,x)=>x).map(a=>e.jsx("option",{value:String(a).padStart(2,"0"),children:String(a).padStart(2,"0")},a))}),e.jsxs("select",{value:j,onChange:a=>u(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{children:"AM"}),e.jsx("option",{children:"PM"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Turno"}),e.jsxs("select",{value:n,onChange:a=>i(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{value:"matutino",children:"Matutino"}),e.jsx("option",{value:"pre-apertura",children:"Pre Apertura"}),e.jsx("option",{value:"cierre",children:"Cierre"}),e.jsx("option",{value:"default",children:"Otro"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Duración Estimada"}),e.jsx("select",{value:O,onChange:a=>v(a.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:je.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Zona (Opcional)"}),e.jsx("input",{type:"text",value:m,onChange:a=>C(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]})]}),e.jsxs("div",{className:"form-group mt-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Notas (Opcional)"}),e.jsx("textarea",{value:E,onChange:a=>q(a.target.value),rows:3,placeholder:"Añade comentarios o detalles adicionales aquí...",className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"form-group mt-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Subtareas"}),e.jsxs("div",{className:"bg-gray-100 p-3 rounded-lg",children:[U.length>0&&e.jsx("ul",{className:"space-y-2 mb-3",children:U.map(a=>e.jsxs("li",{className:"flex items-center justify-between bg-white p-2 rounded",children:[e.jsx("span",{className:"text-sm text-gray-700",children:a.text}),e.jsx("button",{type:"button",onClick:()=>pe(a.id),className:"p-1 text-gray-400 hover:text-red-600",children:e.jsx(I,{name:"trash-2",size:16})})]},a.id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:ee,onChange:a=>re(a.target.value),onKeyDown:ae,placeholder:"Añadir una subtarea...",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-sm"}),e.jsx("button",{type:"button",onClick:se,className:"py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 text-sm",children:"Añadir"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"task-critical",checked:$,onChange:a=>z(a.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"task-critical",className:"text-sm font-medium text-gray-600",children:"Es una tarea crítica"})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t sticky bottom-0 bg-white",children:[e.jsx("div",{children:t&&e.jsx("button",{type:"button",onClick:he,disabled:N,className:"py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 disabled:bg-red-400",children:"Eliminar"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:g,disabled:N,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 disabled:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:N,className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 w-36 flex items-center justify-center disabled:bg-blue-400",children:N?e.jsxs(e.Fragment,{children:[e.jsx(I,{name:"refresh-cw",className:"animate-spin mr-2",size:16}),"Guardando..."]}):"Guardar"})]})]})]})})},De=({selectedDate:s,setSelectedDate:g,tasks:f,users:S})=>{const[t,T]=r.useState(s),[y,p]=r.useState(""),N=r.useRef(0),k=r.useMemo(()=>S.reduce((n,i)=>(n[i.name]=i.color,n),{}),[S]),D=r.useMemo(()=>{const n=new Map;f.forEach(i=>{if(i.date){const m=i.date;n.has(m)||n.set(m,[]),n.get(m).push(i.employee)}});for(const[i,m]of n.entries())n.set(i,Array.from(new Set(m)));return n},[f]);r.useEffect(()=>{T(s)},[s]),r.useEffect(()=>{if(y.startsWith("slide-out")){const n=y.includes("left")?"next":"prev",i=setTimeout(()=>{const m=new Date(t);m.setDate(m.getDate()+(n==="prev"?-7:7)),T(m);const C=new Date(s);C.setDate(C.getDate()+(n==="prev"?-7:7)),g(C),p(n==="next"?"slide-in-from-right":"slide-in-from-left")},200);return()=>clearTimeout(i)}else if(y.startsWith("slide-in")){const n=setTimeout(()=>{p("")},200);return()=>clearTimeout(n)}},[y,t,s,g]);const h=n=>{y||p(n==="next"?"slide-out-left":"slide-out-right")},P=n=>{const i=n.target.value;if(i){const m=new Date(i);m.setMinutes(m.getMinutes()+m.getTimezoneOffset()),g(m)}},W=n=>{N.current=n.targetTouches[0].clientX},o=n=>{const i=n.changedTouches[0].clientX,m=50,C=N.current-i;C>m?h("next"):C<-m&&h("prev")},b=new Date;b.setHours(0,0,0,0);const l=new Date(t),c=t.getDay(),j=t.getDate()-c+(c===0?-6:1);l.setDate(j),l.setHours(0,0,0,0);const u=[];for(let n=0;n<7;n++){const i=new Date(l);i.setDate(l.getDate()+n),u.push(i)}const O=(n,i)=>n.getFullYear()===i.getFullYear()&&n.getMonth()===i.getMonth()&&n.getDate()===i.getDate(),v=t.toLocaleDateString("es-ES",{month:"long",year:"numeric"});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 px-2",children:[e.jsx("button",{onClick:()=>h("prev"),className:"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(I,{name:"chevron-left",size:20})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold text-gray-700 capitalize text-sm",children:v}),e.jsxs("div",{className:"relative w-9 h-9 flex items-center justify-center text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors cursor-pointer",title:"Seleccionar fecha",children:[e.jsx(I,{name:"calendar",size:18}),e.jsx("input",{type:"date",onChange:P,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer","aria-label":"Seleccionar fecha"})]})]}),e.jsx("button",{onClick:()=>h("next"),className:"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(I,{name:"chevron-right",size:20})})]}),e.jsx("div",{className:"p-1 bg-gray-200 rounded-lg overflow-hidden relative touch-pan-y",children:e.jsx("div",{className:`flex justify-between items-center gap-1 md:gap-2 ${y}`,onTouchStart:W,onTouchEnd:o,children:u.map(n=>{const i=O(n,s),m=O(n,b),C=new Date(n);C.setMinutes(C.getMinutes()-C.getTimezoneOffset());const $=C.toISOString().split("T")[0],z=D.get($)||[];return e.jsx("button",{onClick:()=>g(n),className:"px-1 py-1 md:px-2 md:py-2 rounded-md transition-all duration-200 text-center flex-1",children:e.jsxs("div",{className:`${i?"bg-white shadow-sm rounded-md":""} py-1`,children:[e.jsx("span",{className:`text-xs uppercase font-bold ${i?"text-blue-600":"text-gray-500"}`,children:n.toLocaleDateString("es-ES",{weekday:"short"}).replace(".","")}),e.jsx("p",{className:`font-bold text-lg ${m?"text-blue-600":i?"text-gray-800":"text-gray-600"}`,children:n.getDate()}),e.jsx("div",{className:"flex justify-center items-center h-2 mt-1 gap-0.5",children:z.slice(0,4).map(E=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:k[E]||"#9ca3af"},title:E},E))})]})},n.toISOString())})})})]})},Ce=s=>{switch(s){case"inprogress":return"opacity-100 animate-pulse-yellow";case"done":return"opacity-50";case"todo":default:return"opacity-100"}},Ee=({task:s,onUpdateStatus:g,onEdit:f,onViewSubtasks:S,style:t,userColor:T})=>{var b,l;const y=Ce(s.status),p=c=>{c.stopPropagation(),s.status==="todo"?g(s.id,"inprogress"):s.status==="inprogress"?g(s.id,"done"):s.status==="done"&&g(s.id,"todo")},N=new Date(`${s.date}T${s.time}`),D=new Date(N.getTime()+s.duration*6e4).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hourCycle:"h23"}),h=((b=s.subtasks)==null?void 0:b.length)||0,P=((l=s.subtasks)==null?void 0:l.filter(c=>c.isCompleted).length)||0,W={...t,borderWidth:"2px",borderColor:s.status==="inprogress"?T:"transparent",backgroundColor:"#f9fafb"},o={color:"#374151"};return e.jsxs("div",{style:W,onClick:S,className:`absolute rounded-lg p-2 flex gap-2 transition-all duration-300 cursor-pointer ${y}`,children:[e.jsx("div",{className:"flex-shrink-0 w-1 h-full rounded-full",style:{backgroundColor:T}}),e.jsxs("div",{className:"flex-grow flex flex-col min-w-0 min-h-0",children:[e.jsxs("div",{className:"flex-grow overflow-hidden",children:[e.jsxs("p",{className:`font-bold text-sm break-words ${s.status==="done"?"line-through":""}`,style:o,children:[s.isCritical&&e.jsx(I,{name:"alert-triangle",size:14,className:"inline-block mr-1 text-red-600",title:"Tarea Crítica"}),s.text]}),e.jsxs("p",{className:`text-xs ${s.status==="done"?"line-through":""}`,style:o,children:[s.time," - ",D," (",s.duration," min)"]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1 flex-shrink-0",children:[e.jsx("span",{className:"text-xs font-bold px-2 py-0.5 rounded-full bg-white/60",style:o,children:s.employee}),e.jsxs("div",{className:"flex items-center gap-2",style:o,children:[s.notes&&s.notes.trim()!==""&&e.jsx(I,{name:"message-square",size:14,title:"Esta tarea tiene notas"}),h>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs font-semibold",children:[e.jsx(I,{name:"list",size:14}),e.jsxs("span",{children:[P,"/",h]})]}),e.jsx("button",{onClick:c=>{c.stopPropagation(),f(s)},className:"p-1 rounded-full hover:bg-black/10 transition-colors",title:"Editar Tarea",children:e.jsx(I,{name:"pencil",size:14})})]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:p,className:"w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all",style:{borderColor:s.status==="done"?"#4ade80":"#9ca3af",backgroundColor:s.status==="done"?"#4ade80":"white"},children:[s.status==="inprogress"&&e.jsx("div",{className:"w-2.5 h-2.5 bg-yellow-500 rounded-full"}),s.status==="done"&&e.jsx(I,{name:"check",size:16,className:"text-white"})]})})]})},Me=({task:s,onClose:g,onUpdateTask:f})=>{var P,W;const[S,t]=r.useState(""),T=o=>{const b=(s.subtasks||[]).map(l=>l.id===o?{...l,isCompleted:!l.isCompleted}:l);f({...s,subtasks:b})},y=()=>{if(S.trim()==="")return;const o={id:`sub-${Date.now()}`,text:S.trim(),isCompleted:!1},b=[...s.subtasks||[],o];f({...s,subtasks:b}),t("")},p=o=>{const b=(s.subtasks||[]).filter(l=>l.id!==o);f({...s,subtasks:b})},N=o=>{o.key==="Enter"&&(o.preventDefault(),y())},k=((P=s.subtasks)==null?void 0:P.filter(o=>o.isCompleted).length)||0,D=((W=s.subtasks)==null?void 0:W.length)||0,h=D>0?k/D*100:0;return e.jsx("div",{className:"absolute inset-0 bg-gray-900/40 z-50 flex justify-center items-center p-4",onClick:g,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md flex flex-col",onClick:o=>o.stopPropagation(),children:[e.jsxs("header",{className:"p-4 border-b",children:[e.jsx("h3",{className:"font-bold text-lg text-blue-700",children:s.text}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.time," - ",s.employee]})]}),e.jsxs("div",{className:"p-4 flex-grow overflow-y-auto max-h-[50vh]",children:[s.notes&&s.notes.trim()!==""&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-2",children:"Notas"}),e.jsx("div",{className:"p-3 bg-yellow-50 border-l-4 border-yellow-400 text-gray-800 text-sm rounded-r-lg whitespace-pre-wrap",children:s.notes})]}),D>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Progreso de Subtareas"}),e.jsxs("span",{children:[k," / ",D]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${h}%`}})})]}),e.jsx("div",{className:"space-y-2",children:(s.subtasks||[]).map(o=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-md group",children:[e.jsx("input",{type:"checkbox",checked:o.isCompleted,onChange:()=>T(o.id),className:"w-5 h-5 rounded text-blue-600 focus:ring-blue-500 flex-shrink-0"}),e.jsx("span",{className:`flex-grow text-gray-800 ${o.isCompleted?"line-through text-gray-400":""}`,children:o.text}),e.jsx("button",{onClick:()=>p(o.id),className:"p-1 text-gray-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(I,{name:"trash-2",size:16})})]},o.id))}),D===0&&(!s.notes||s.notes.trim()==="")&&e.jsx("p",{className:"text-center text-gray-500 py-6",children:"No hay subtareas ni notas. ¡Añade la primera!"})]}),e.jsx("div",{className:"p-4 border-t bg-gray-50 rounded-b-xl",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:S,onChange:o=>t(o.target.value),onKeyDown:N,placeholder:"Añadir nueva subtarea...",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-sm focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:y,className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 text-sm",children:"Añadir"})]})})]})})},ye=120,Ie=30,Oe=({tasks:s,onUpdateStatus:g,onEditTask:f,onUpdateTask:S,users:t})=>{const[T,y]=r.useState(new Date),[p,N]=r.useState(null),k=r.useMemo(()=>t.reduce((l,c)=>(l[c.name]=c.color,l),{}),[t]);r.useEffect(()=>{const l=setInterval(()=>y(new Date),6e4);return()=>clearInterval(l)},[]),r.useEffect(()=>{if(p){const l=s.find(c=>c.id===p.id);N(l||null)}},[s,p]);const D=r.useMemo(()=>{const l={};return s.forEach(c=>{if(c.time){const j=parseInt(c.time.split(":")[0],10);l[j]=!0}}),l},[s]),h=r.useMemo(()=>{let l=0;const c=[];for(let j=ve;j<=Ne;j++){const O=!!D[j]?ye:Ie;c.push({hour:j,top:l,height:O}),l+=O}return c},[D]),P=h.length>0?h[h.length-1].top+h[h.length-1].height:0,W=l=>{const[c,j]=l.split(":").map(Number),u=h.find(v=>v.hour===c);if(!u)return 0;const O=j/60*u.height;return u.top+O},o=r.useMemo(()=>{const c=[...s.filter(u=>!!u.time)].sort((u,O)=>u.time.localeCompare(O.time)||O.duration-u.duration),j=[];for(const u of c){const O=W(u.time),v=new Date(`${u.date}T${u.time}`).getTime(),n=v+u.duration*6e4,i=h.find(E=>E.hour===parseInt(u.time.split(":")[0],10)),m=i?i.height:ye,C=u.duration/60*m,$=[];for(const E of j){const q=new Date(`${E.task.date}T${E.task.time}`).getTime(),A=q+E.task.duration*6e4;v<A&&n>q&&$.push(E)}let z=0;for(;$.some(E=>E.left===z);)z++;j.push({task:u,top:O,height:C,left:z,width:1,zIndex:z})}return j.map((u,O,v)=>{const{task:n}=u,i=new Date(`${n.date}T${n.time}`).getTime(),m=i+n.duration*6e4,C=v.filter(A=>{const F=new Date(`${A.task.date}T${A.task.time}`).getTime(),X=F+A.task.duration*6e4;return i<X&&m>F}),$=new Set(C.map(A=>A.left)),z=$.size;let E=0;return E=Array.from($).sort((A,F)=>A-F).indexOf(u.left),{...u,width:100/z,left:E/z*100}})},[s,h]),b=W(`${T.getHours()}:${T.getMinutes()}`);return e.jsxs("div",{className:"p-4 md:p-6 h-full relative",children:[e.jsxs("div",{className:"relative z-10",style:{height:`${P}px`},children:[h.map(({hour:l,top:c,height:j})=>e.jsxs("div",{className:"absolute w-full",style:{top:`${c}px`,height:`${j}px`},children:[e.jsxs("span",{className:"absolute -top-3 left-0 text-sm font-semibold text-gray-400 w-16 text-right pr-4",children:[l,":00"]}),e.jsx("div",{className:"h-px bg-gray-200 ml-16"})]},l)),b>=0&&b<=P&&e.jsx("div",{className:"absolute left-16 right-0 h-0.5 bg-red-500 z-20",style:{top:`${b}px`},children:e.jsx("div",{className:"absolute -left-1.5 -top-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white"})}),e.jsx("div",{className:"absolute top-0 bottom-0 left-16 right-0",children:o.map(({task:l,top:c,height:j,left:u,width:O,zIndex:v})=>e.jsx(Ee,{task:l,onUpdateStatus:g,onEdit:f,onViewSubtasks:()=>N(l),userColor:k[l.employee]||"#9ca3af",style:{top:`${c}px`,height:`${Math.max(j-4,80)}px`,left:`${u}%`,width:`calc(${O}% - 4px)`,zIndex:v}},l.id))})]}),p&&e.jsx(Me,{task:p,onClose:()=>N(null),onUpdateTask:S})]})},Ae=s=>s>0?`en ${s} min`:s===0?"¡Ahora!":`hace ${Math.abs(s)} min`,$e=({tasksWithDiff:s})=>e.jsxs("div",{className:"bg-yellow-100 border-b-2 border-yellow-300 p-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(I,{name:"alert-triangle",className:"text-yellow-600",size:20}),e.jsx("h3",{className:"font-bold text-yellow-800 text-base",children:"Tareas Críticas Próximas"})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:s.map(({task:g,diff:f})=>e.jsxs("div",{className:"bg-white/70 p-2 rounded-lg border border-yellow-300 flex-shrink-0 w-60",children:[e.jsx("p",{className:"font-bold text-sm text-gray-800 truncate",children:g.text}),e.jsxs("p",{className:`text-xs font-semibold ${f<=0?"text-red-600 animate-pulse":"text-blue-600"}`,children:[g.time," (",Ae(f),")"]})]},g.id))})]}),ze=({isOpen:s,onClose:g,onSelectThisOne:f,onSelectFuture:S,isDelete:t=!1})=>{const y=`¿Qué tareas quieres ${t?"eliminar":"editar"}?`,p=t?"Eliminar solo esta tarea":"Editar solo esta tarea",N="La acción solo se aplicará a esta instancia. El resto de la serie no se verá afectado.",k=t?"Eliminar esta y futuras tareas":"Editar esta y futuras tareas",D="La acción se aplicará a esta y a todas las repeticiones futuras de la serie.",h=t?"trash-2":"pencil";return e.jsx(be,{isOpen:s,onClose:g,title:y,children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("button",{onClick:f,className:"p-4 bg-gray-100 rounded-lg border-2 border-transparent hover:border-blue-500 transition-all text-left",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(I,{name:h,size:24,className:"text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-800",children:p}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:N})]})]})}),e.jsx("button",{onClick:S,className:"p-4 bg-gray-100 rounded-lg border-2 border-transparent hover:border-blue-500 transition-all text-left",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(I,{name:"calendar",size:24,className:"text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-800",children:k}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:D})]})]})}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:g,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"})})]})})},Pe=({tasks:s,onEditTask:g,users:f})=>{const S=r.useMemo(()=>f.reduce((t,T)=>(t[T.name]=T.color,t),{}),[f]);return s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500 p-8",children:[e.jsx(I,{name:"check-circle",size:48,className:"text-green-500 mb-4"}),e.jsx("h3",{className:"text-xl font-bold",children:"¡Bandeja Limpia!"}),e.jsx("p",{children:"No hay tareas pendientes sin planificar."})]}):e.jsx("div",{className:"p-4 md:p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-[3fr_1.5fr_1.5fr_1fr] gap-4 px-4 pb-2 border-b border-gray-200",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500",children:"Tarea"}),e.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500",children:"Asignado a"}),e.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500",children:"Añadida por"}),e.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500 text-right",children:"Acciones"})]}),s.map(t=>e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm hover:border-blue-400 transition-all grid grid-cols-2 md:grid-cols-[3fr_1.5fr_1.5fr_1fr] gap-x-4 gap-y-2 items-center",children:[e.jsx("div",{className:"col-span-2 md:col-span-1",children:e.jsxs("p",{className:"font-bold text-gray-800 break-words flex items-center gap-2",children:[t.isCritical&&e.jsx(I,{name:"alert-triangle",size:16,className:"text-red-500 flex-shrink-0",title:"Tarea Crítica"}),t.text,t.notes&&e.jsx(I,{name:"message-square",size:14,className:"text-gray-400 flex-shrink-0",title:"Tiene notas"})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-500 md:hidden",children:"Asignado:"}),e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:S[t.employee]||"#9ca3af"}}),e.jsx("span",{className:"text-gray-700",children:t.employee})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-500 md:hidden",children:"Añadida:"}),e.jsx("span",{className:"text-gray-700",children:t.addedBy})]}),e.jsx("div",{className:"col-span-2 md:col-span-1 flex justify-end",children:e.jsxs("button",{onClick:()=>g(t),className:"w-full md:w-auto flex-shrink-0 flex items-center justify-center gap-2 bg-blue-100 text-blue-700 font-semibold py-2 px-3 rounded-lg hover:bg-blue-200 transition-colors text-xs",children:[e.jsx(I,{name:"calendar",size:14}),"Planificar"]})})]},t.id))]})})},_e=({kanbanHook:s,criticalTasks:g,users:f})=>{const{tasks:S,addTask:t,addMultipleTasks:T,updateTask:y,updateTaskStatus:p,deleteTask:N,updateFutureTasks:k,deleteFutureTasks:D}=s,[h,P]=r.useState(new Date),[W,o]=r.useState(!1),[b,l]=r.useState(null),[c,j]=r.useState("All"),[u,O]=r.useState("agenda"),[v,n]=r.useState(null),[i,m]=r.useState(null),[C,$]=r.useState("new"),[z,E]=r.useState(null),[q,A]=r.useState(!1),[F,X]=r.useState(""),[Z,J]=r.useState(""),[de,U]=r.useState(!1),Q=d=>{d.recurrenceId?(m("edit"),n(d)):($("single"),l(d),o(!0))},ee=()=>{o(!1),l(null),$("new")},re=async(d,a)=>{const{recurrence:x,selectedDays:M,recurrenceWeeks:ne,...H}=d;U(!0);try{if(a&&b)if(!H.date)await y({...H,id:a,status:b.status});else if(C==="future")if(x==="weekly"&&M&&M.length>0){await D(b);const w=new Date(b.date);w.setMinutes(w.getMinutes()+w.getTimezoneOffset());const V=parseInt(ne||"4",10),R=[],L=new Date(w),B=w.getDay(),ie=w.getDate()-B+(B===0?-6:1);L.setDate(ie);for(let Y=0;Y<V;Y++){const K=new Date(L);K.setDate(L.getDate()+Y*7),M.forEach(fe=>{const ce=parseInt(fe,10),_=new Date(K);ce===0?_.setDate(K.getDate()+6):_.setDate(K.getDate()+(ce-1)),_.getTime()>=w.getTime()&&(_.setMinutes(_.getMinutes()-_.getTimezoneOffset()),R.push({...H,date:_.toISOString().split("T")[0]}))})}await T(R)}else{const{date:w,time:V,...R}=H;await k(b,R)}else{const{recurrenceId:w,...V}=b,R={...V,...H,id:a};await y(R)}else if(!H.date)await t(H);else{const w=new Date(H.date);if(w.setMinutes(w.getMinutes()+w.getTimezoneOffset()),x==="weekly"&&M&&M.length>0){const V=parseInt(ne||"4",10),R=[],L=new Date(w),B=w.getDay(),ie=w.getDate()-B+(B===0?-6:1);L.setDate(ie);for(let Y=0;Y<V;Y++){const K=new Date(L);K.setDate(L.getDate()+Y*7),M.forEach(fe=>{const ce=parseInt(fe,10),_=new Date(K);ce===0?_.setDate(K.getDate()+6):_.setDate(K.getDate()+(ce-1)),_.setMinutes(_.getMinutes()-_.getTimezoneOffset()),R.push({...H,date:_.toISOString().split("T")[0]})})}await T(R)}else await t(H)}ee()}catch(w){console.error("Error saving task:",w)}finally{U(!1)}},ue=d=>{o(!1),l(null),d.recurrenceId?(m("delete"),n(d)):te(()=>N(d.id))},le=()=>{v&&($("single"),l(v),o(!0),n(null),m(null))},G=()=>{v&&($("future"),l(v),o(!0),n(null),m(null))},me=()=>{v&&(te(()=>N(v.id)),n(null),m(null))},oe=()=>{v&&(te(()=>D(v)),n(null),m(null))},te=d=>{E(()=>d),A(!0),X(""),J("")},ge=()=>{F===we?(z==null||z(),A(!1),E(null)):(J("PIN incorrecto. Inténtalo de nuevo."),X(""))},se=r.useMemo(()=>{const d=new Date(h);return d.setMinutes(d.getMinutes()-d.getTimezoneOffset()),d.toISOString().split("T")[0]},[h]),ae=r.useMemo(()=>S.filter(d=>c==="All"||d.employee===c),[S,c]),pe=r.useMemo(()=>ae.filter(d=>d.date===se),[ae,se]),xe=r.useMemo(()=>ae.filter(d=>!d.date),[ae]),he=({view:d,label:a,icon:x,count:M})=>e.jsxs("button",{onClick:()=>O(d),className:`flex items-center gap-2 py-2 px-4 text-sm md:text-base font-bold border-b-4 transition-colors ${u===d?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-800"}`,children:[e.jsx(I,{name:x,size:18}),a,M>0&&e.jsx("span",{className:"text-xs bg-gray-300 text-gray-700 font-bold rounded-full px-2",children:M})]});return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50",children:[g.length>0&&e.jsx($e,{tasksWithDiff:g}),e.jsxs("div",{className:"operations-header flex flex-col p-4 border-b border-gray-200 gap-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-center w-full gap-4",children:[e.jsxs("div",{className:"flex",children:[e.jsx(he,{view:"agenda",label:"Agenda Diaria",icon:"calendar",count:0}),e.jsx(he,{view:"pending",label:"Tareas Pendientes",icon:"clipboard-list",count:xe.length})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:()=>{$("new"),l(null),o(!0)},className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-3 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(I,{name:"plus-circle",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Añadir Tarea"}),e.jsx("span",{className:"md:hidden",children:"Añadir"})]})})]}),u==="agenda"&&e.jsx(De,{selectedDate:h,setSelectedDate:P,tasks:S,users:f}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-200 rounded-lg p-1 w-full overflow-x-auto",children:[e.jsx("button",{onClick:()=>j("All"),className:`px-3 py-1 text-sm font-bold rounded-md transition-colors ${c==="All"?"bg-white shadow-sm":"bg-transparent text-gray-600"}`,children:"Todos"}),f.map(d=>e.jsx("button",{onClick:()=>j(d.name),className:`px-3 py-1 text-sm font-bold rounded-md transition-colors ${c===d.name?"bg-white shadow-sm":"bg-transparent text-gray-600"}`,children:d.name},d.id))]})]}),e.jsx("div",{className:"flex-grow overflow-auto relative",children:u==="agenda"?e.jsx(Oe,{tasks:pe,onEditTask:Q,onUpdateStatus:p,onUpdateTask:y,users:f}):e.jsx(Pe,{tasks:xe,onEditTask:Q,users:f})}),e.jsx(Te,{isOpen:W,onClose:ee,onSave:re,onDelete:ue,task:b,selectedDate:se,users:f,editMode:C,isSaving:de,allTasks:S}),e.jsx(ze,{isOpen:!!v,onClose:()=>n(null),onSelectThisOne:i==="edit"?le:me,onSelectFuture:i==="edit"?G:oe,isDelete:i==="delete"}),q&&e.jsx(be,{isOpen:q,onClose:()=>A(!1),title:"Confirmar Acción",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"font-bold text-lg text-gray-800",children:"Acción Protegida"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2 mb-4",children:"Para continuar, introduce el PIN de operaciones."}),e.jsx("input",{type:"password",value:F,onChange:d=>{X(d.target.value),J("")},placeholder:"PIN de Seguridad",autoFocus:!0,className:"w-full p-2 border border-gray-300 rounded-md text-center"}),Z&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:Z}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{onClick:()=>A(!1),className:"flex-1 py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{onClick:ge,className:"flex-1 py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Confirmar"})]})]})})]})};export{_e as default};
