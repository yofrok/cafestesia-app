import{r as o,j as e,T as ee,I as P,O as te,a as se,b as ae}from"./index-BeXU68QM.js";import{M as re}from"./Modal-Dn4WetBp.js";const le=[{label:"L",value:"1"},{label:"M",value:"2"},{label:"M",value:"3"},{label:"J",value:"4"},{label:"V",value:"5"},{label:"S",value:"6"},{label:"D",value:"0"}],ne=({isOpen:t,onClose:m,onSave:h,onDelete:$,task:r,selectedDate:k})=>{const[v,g]=o.useState(""),[T,f]=o.useState("Ali"),[S,C]=o.useState("08"),[D,w]=o.useState("00"),[s,i]=o.useState("AM"),[l,u]=o.useState("30"),[n,d]=o.useState("pre-apertura"),[x,c]=o.useState(""),[O,I]=o.useState(!1),[y,b]=o.useState("once"),[N,j]=o.useState([]),[E,M]=o.useState([]),[z,_]=o.useState(""),[W,A]=o.useState(!1),[L,R]=o.useState(""),[H,X]=o.useState("");o.useEffect(()=>{if(t){g((r==null?void 0:r.text)||""),f((r==null?void 0:r.employee)||"Ali");const a=(r==null?void 0:r.time)||"08:00",[p,F]=a.split(":").map(Number),K=p>=12?"PM":"AM";let U=p%12;U===0&&(U=12),C(String(U).padStart(2,"0")),w(String(F).padStart(2,"0")),i(K),u(String((r==null?void 0:r.duration)||"30")),d((r==null?void 0:r.shift)||"pre-apertura"),c((r==null?void 0:r.zone)||""),I((r==null?void 0:r.isCritical)||!1),b("once"),j([]),M((r==null?void 0:r.subtasks)||[]),_(""),A(!1),R(""),X("")}},[t,r]);const Y=a=>{j(p=>p.includes(a)?p.filter(F=>F!==a):[...p,a])},G=()=>{if(z.trim()==="")return;const a={id:`sub-${Date.now()}`,text:z.trim(),isCompleted:!1};M([...E,a]),_("")},Z=a=>{a.key==="Enter"&&(a.preventDefault(),G())},J=a=>{M(E.filter(p=>p.id!==a))},V=a=>{if(a.preventDefault(),!v){alert("Por favor completa el nombre de la tarea.");return}if(y==="weekly"&&N.length===0){alert("Por favor selecciona al menos un día para la tarea recurrente.");return}let p=parseInt(S,10);s==="PM"&&p!==12?p+=12:s==="AM"&&p===12&&(p=0);const F=`${String(p).padStart(2,"0")}:${D}`,K={text:v,employee:T,time:F,duration:parseInt(l,10),shift:n,zone:x,isCritical:O,date:(r==null?void 0:r.date)||k,recurrence:y,selectedDays:N,subtasks:E};h(K,r==null?void 0:r.id),m()},Q=()=>{L===te?(r&&$(r.id),m()):(X("PIN incorrecto. Inténtalo de nuevo."),R(""))};return e.jsx(re,{isOpen:t,onClose:m,title:r?"Editar Tarea":"Añadir Nueva Tarea",children:e.jsxs("div",{className:"relative",children:[e.jsxs("form",{onSubmit:V,className:"flex flex-col gap-4 max-h-[80vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Nombre de la Tarea"}),e.jsx("input",{type:"text",value:v,onChange:a=>g(a.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Repetición"}),e.jsxs("div",{className:"flex gap-2 bg-gray-200 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>b("once"),className:`flex-1 p-2 rounded-md text-sm font-bold transition-colors ${y==="once"?"bg-white shadow-sm":""}`,children:"Una vez"}),e.jsx("button",{type:"button",onClick:()=>b("weekly"),className:`flex-1 p-2 rounded-md text-sm font-bold transition-colors ${y==="weekly"?"bg-white shadow-sm":""}`,children:"Semanalmente"})]})]}),y==="weekly"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Días de la semana"}),e.jsx("div",{className:"flex justify-between gap-1",children:le.map(({label:a,value:p})=>e.jsx("button",{type:"button",onClick:()=>Y(p),className:`w-9 h-9 flex items-center justify-center font-bold rounded-full border-2 transition-colors ${N.includes(p)?"bg-blue-600 text-white border-blue-600":"bg-gray-100 border-gray-300"}`,children:a},p))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Empleado"}),e.jsxs("select",{value:T,onChange:a=>f(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{children:"Ali"}),e.jsx("option",{children:"Fer"}),e.jsx("option",{children:"Claudia"}),e.jsx("option",{children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Turno"}),e.jsxs("select",{value:n,onChange:a=>d(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{value:"matutino",children:"Matutino"}),e.jsx("option",{value:"pre-apertura",children:"Pre Apertura"}),e.jsx("option",{value:"cierre",children:"Cierre"}),e.jsx("option",{value:"default",children:"Otro"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Hora"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("select",{value:S,onChange:a=>C(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Array.from({length:12},(a,p)=>p+1).map(a=>e.jsx("option",{value:String(a).padStart(2,"0"),children:String(a).padStart(2,"0")},a))}),e.jsx("select",{value:D,onChange:a=>w(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Array.from({length:60},(a,p)=>p).map(a=>e.jsx("option",{value:String(a).padStart(2,"0"),children:String(a).padStart(2,"0")},a))}),e.jsxs("select",{value:s,onChange:a=>i(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{children:"AM"}),e.jsx("option",{children:"PM"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Duración"}),e.jsx("select",{value:l,onChange:a=>u(a.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:ee.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Zona (Opcional)"}),e.jsx("input",{type:"text",value:x,onChange:a=>c(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"form-group mt-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Subtareas"}),e.jsxs("div",{className:"bg-gray-100 p-3 rounded-lg",children:[E.length>0&&e.jsx("ul",{className:"space-y-2 mb-3",children:E.map(a=>e.jsxs("li",{className:"flex items-center justify-between bg-white p-2 rounded",children:[e.jsx("span",{className:"text-sm text-gray-700",children:a.text}),e.jsx("button",{type:"button",onClick:()=>J(a.id),className:"p-1 text-gray-400 hover:text-red-600",children:e.jsx(P,{name:"trash-2",size:16})})]},a.id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:z,onChange:a=>_(a.target.value),onKeyDown:Z,placeholder:"Añadir una subtarea...",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-sm"}),e.jsx("button",{type:"button",onClick:G,className:"py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 text-sm",children:"Añadir"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"task-critical",checked:O,onChange:a=>I(a.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"task-critical",className:"text-sm font-medium text-gray-600",children:"Es una tarea crítica"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t sticky bottom-0 bg-white",children:[e.jsx("div",{children:r&&e.jsx("button",{type:"button",onClick:()=>A(!0),className:"py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700",children:"Eliminar Tarea"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:m,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Guardar Cambios"})]})]})]}),W&&e.jsx("div",{className:"absolute inset-0 bg-white/80 backdrop-blur-sm flex justify-center items-center z-10",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-gray-200 w-full max-w-sm text-center",children:[e.jsx("h4",{className:"font-bold text-lg text-gray-800",children:"Confirmar Eliminación"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2 mb-4",children:"Para confirmar, introduce el PIN de operaciones. Esta acción no se puede deshacer."}),e.jsx("input",{type:"password",value:L,onChange:a=>{R(a.target.value),X("")},placeholder:"PIN de Seguridad",autoFocus:!0,className:"w-full p-2 border border-gray-300 rounded-md text-center"}),H&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:H}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{onClick:()=>A(!1),className:"flex-1 py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{onClick:Q,className:"flex-1 py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700",children:"Confirmar"})]})]})})]})})},oe=({selectedDate:t,setSelectedDate:m})=>{const[h,$]=o.useState(t),[r,k]=o.useState(""),v=o.useRef(0);o.useEffect(()=>{$(t)},[t]),o.useEffect(()=>{if(r.startsWith("slide-out")){const n=r.includes("left")?"next":"prev",d=setTimeout(()=>{const x=new Date(h);x.setDate(x.getDate()+(n==="prev"?-7:7)),$(x);const c=new Date(t);c.setDate(c.getDate()+(n==="prev"?-7:7)),m(c),k(n==="next"?"slide-in-from-right":"slide-in-from-left")},200);return()=>clearTimeout(d)}else if(r.startsWith("slide-in")){const n=setTimeout(()=>{k("")},200);return()=>clearTimeout(n)}},[r,h,t,m]);const g=n=>{r||k(n==="next"?"slide-out-left":"slide-out-right")},T=n=>{const d=n.target.value;if(d){const x=new Date(d);x.setMinutes(x.getMinutes()+x.getTimezoneOffset()),m(x)}},f=n=>{v.current=n.targetTouches[0].clientX},S=n=>{const d=n.changedTouches[0].clientX,x=50,c=v.current-d;c>x?g("next"):c<-x&&g("prev")},C=new Date;C.setHours(0,0,0,0);const D=new Date(h),w=h.getDay(),s=h.getDate()-w+(w===0?-6:1);D.setDate(s),D.setHours(0,0,0,0);const i=[];for(let n=0;n<7;n++){const d=new Date(D);d.setDate(D.getDate()+n),i.push(d)}const l=(n,d)=>n.getFullYear()===d.getFullYear()&&n.getMonth()===d.getMonth()&&n.getDate()===d.getDate(),u=h.toLocaleDateString("es-ES",{month:"long",year:"numeric"});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 px-2",children:[e.jsx("button",{onClick:()=>g("prev"),className:"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(P,{name:"chevron-left",size:20})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold text-gray-700 capitalize text-sm",children:u}),e.jsxs("div",{className:"relative w-9 h-9 flex items-center justify-center text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors cursor-pointer",title:"Seleccionar fecha",children:[e.jsx(P,{name:"calendar",size:18}),e.jsx("input",{type:"date",onChange:T,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer","aria-label":"Seleccionar fecha"})]})]}),e.jsx("button",{onClick:()=>g("next"),className:"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(P,{name:"chevron-right",size:20})})]}),e.jsx("div",{className:"p-1 bg-gray-200 rounded-lg overflow-hidden relative touch-pan-y",children:e.jsx("div",{className:`flex justify-between items-center gap-1 md:gap-2 ${r}`,onTouchStart:f,onTouchEnd:S,children:i.map(n=>{const d=l(n,t),x=l(n,C);return e.jsx("button",{onClick:()=>m(n),className:"px-1 py-1 md:px-2 md:py-2 rounded-md transition-all duration-200 text-center flex-1",children:e.jsxs("div",{className:`${d?"bg-white shadow-sm rounded-md":""} py-1`,children:[e.jsx("span",{className:`text-xs uppercase font-bold ${d?"text-blue-600":"text-gray-500"}`,children:n.toLocaleDateString("es-ES",{weekday:"short"}).replace(".","")}),e.jsx("p",{className:`font-bold text-lg ${x?"text-blue-600":d?"text-gray-800":"text-gray-600"}`,children:n.getDate()})]})},n.toISOString())})})})]})},q={Ali:{bg:"bg-pink-100",border:"border-pink-500",text:"text-pink-800"},Fer:{bg:"bg-purple-100",border:"border-purple-500",text:"text-purple-800"},Claudia:{bg:"bg-teal-100",border:"border-teal-500",text:"text-teal-800"},Admin:{bg:"bg-yellow-100",border:"border-yellow-600",text:"text-yellow-900"}},ie=t=>{switch(t){case"inprogress":return"opacity-100 animate-pulse-yellow";case"done":return"opacity-50";case"todo":default:return"opacity-100"}},de=({task:t,onUpdateStatus:m,onEdit:h,onViewSubtasks:$,style:r})=>{var i,l;const{bg:k,border:v,text:g}=q[t.employee]||q.Admin,T=ie(t.status),f=u=>{u.stopPropagation(),t.status==="todo"?m(t.id,"inprogress"):t.status==="inprogress"?m(t.id,"done"):t.status==="done"&&m(t.id,"todo")},S=new Date(`${t.date}T${t.time}`),D=new Date(S.getTime()+t.duration*6e4).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hourCycle:"h23"}),w=((i=t.subtasks)==null?void 0:i.length)||0,s=((l=t.subtasks)==null?void 0:l.filter(u=>u.isCompleted).length)||0;return e.jsxs("div",{style:r,onClick:$,className:`absolute rounded-lg p-2 flex gap-2 transition-all duration-300 cursor-pointer ${k} border-2 ${T} ${t.status==="inprogress"?v:"border-transparent"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-1 h-full ${v.replace("border-","bg-")} rounded-full`}),e.jsxs("div",{className:"flex-grow flex flex-col min-w-0 min-h-0",children:[e.jsxs("div",{className:"flex-grow overflow-hidden",children:[e.jsx("p",{className:`font-bold text-sm break-words ${g} ${t.status==="done"?"line-through":""}`,children:t.text}),e.jsxs("p",{className:`text-xs ${g} ${t.status==="done"?"line-through":""}`,children:[t.time," - ",D," (",t.duration," min)"]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1 flex-shrink-0",children:[e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded-full bg-white/60 ${g}`,children:t.employee}),e.jsxs("div",{className:"flex items-center gap-2",children:[w>0&&e.jsxs("div",{className:`flex items-center gap-1 text-xs font-semibold ${g}`,children:[e.jsx(P,{name:"list",size:14}),e.jsxs("span",{children:[s,"/",w]})]}),e.jsx("button",{onClick:u=>{u.stopPropagation(),h(t)},className:`p-1 rounded-full hover:bg-black/10 transition-colors ${g}`,title:"Editar Tarea",children:e.jsx(P,{name:"pencil",size:14})})]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:f,className:"w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all",style:{borderColor:t.status==="done"?"#4ade80":"#9ca3af",backgroundColor:t.status==="done"?"#4ade80":"white"},children:[t.status==="inprogress"&&e.jsx("div",{className:"w-2.5 h-2.5 bg-yellow-500 rounded-full"}),t.status==="done"&&e.jsx(P,{name:"check",size:16,className:"text-white"})]})})]})},ce=({task:t,onClose:m,onUpdateTask:h})=>{var D,w;const[$,r]=o.useState(""),k=s=>{const i=(t.subtasks||[]).map(l=>l.id===s?{...l,isCompleted:!l.isCompleted}:l);h({...t,subtasks:i})},v=()=>{if($.trim()==="")return;const s={id:`sub-${Date.now()}`,text:$.trim(),isCompleted:!1},i=[...t.subtasks||[],s];h({...t,subtasks:i}),r("")},g=s=>{const i=(t.subtasks||[]).filter(l=>l.id!==s);h({...t,subtasks:i})},T=s=>{s.key==="Enter"&&(s.preventDefault(),v())},f=((D=t.subtasks)==null?void 0:D.filter(s=>s.isCompleted).length)||0,S=((w=t.subtasks)==null?void 0:w.length)||0,C=S>0?f/S*100:0;return e.jsx("div",{className:"absolute inset-0 bg-gray-900/40 z-50 flex justify-center items-center p-4",onClick:m,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md flex flex-col",onClick:s=>s.stopPropagation(),children:[e.jsxs("header",{className:"p-4 border-b",children:[e.jsx("h3",{className:"font-bold text-lg text-blue-700",children:t.text}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.time," - ",t.employee]})]}),e.jsxs("div",{className:"p-4 flex-grow overflow-y-auto max-h-[50vh]",children:[S>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Progreso"}),e.jsxs("span",{children:[f," / ",S]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${C}%`}})})]}),e.jsx("div",{className:"space-y-2",children:(t.subtasks||[]).map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-md group",children:[e.jsx("input",{type:"checkbox",checked:s.isCompleted,onChange:()=>k(s.id),className:"w-5 h-5 rounded text-blue-600 focus:ring-blue-500 flex-shrink-0"}),e.jsx("span",{className:`flex-grow text-gray-800 ${s.isCompleted?"line-through text-gray-400":""}`,children:s.text}),e.jsx("button",{onClick:()=>g(s.id),className:"p-1 text-gray-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(P,{name:"trash-2",size:16})})]},s.id))}),S===0&&e.jsx("p",{className:"text-center text-gray-500 py-6",children:"No hay subtareas. ¡Añade la primera!"})]}),e.jsx("div",{className:"p-4 border-t bg-gray-50 rounded-b-xl",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:$,onChange:s=>r(s.target.value),onKeyDown:T,placeholder:"Añadir nueva subtarea...",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-sm focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:v,className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 text-sm",children:"Añadir"})]})})]})})},B=120,ue=30,me=({tasks:t,onUpdateStatus:m,onEditTask:h,onUpdateTask:$})=>{const[r,k]=o.useState(new Date),[v,g]=o.useState(null);o.useEffect(()=>{const s=setInterval(()=>k(new Date),6e4);return()=>clearInterval(s)},[]),o.useEffect(()=>{if(v){const s=t.find(i=>i.id===v.id);g(s||null)}},[t]);const T=o.useMemo(()=>{const s={};return t.forEach(i=>{const l=parseInt(i.time.split(":")[0],10);s[l]=!0}),s},[t]),f=o.useMemo(()=>{let s=0;const i=[];for(let l=ae;l<=se;l++){const n=!!T[l]?B:ue;i.push({hour:l,top:s,height:n}),s+=n}return i},[T]),S=f.length>0?f[f.length-1].top+f[f.length-1].height:0,C=s=>{const[i,l]=s.split(":").map(Number),u=f.find(d=>d.hour===i);if(!u)return 0;const n=l/60*u.height;return u.top+n},D=o.useMemo(()=>{const s=[...t].sort((l,u)=>l.time.localeCompare(u.time)||u.duration-l.duration),i=[];for(const l of s){const u=C(l.time),n=new Date(`${l.date}T${l.time}`).getTime(),d=n+l.duration*6e4,x=f.find(b=>b.hour===parseInt(l.time.split(":")[0],10)),c=x?x.height:B,O=l.duration/60*c,I=[];for(const b of i){const N=new Date(`${b.task.date}T${b.task.time}`).getTime(),j=N+b.task.duration*6e4;n<j&&d>N&&I.push(b)}let y=0;for(;I.some(b=>b.left===y);)y++;i.push({task:l,top:u,height:O,left:y,width:1,zIndex:y})}return i.map((l,u,n)=>{const{task:d}=l,x=new Date(`${d.date}T${d.time}`).getTime(),c=x+d.duration*6e4,O=n.filter(j=>{const E=new Date(`${j.task.date}T${j.task.time}`).getTime(),M=E+j.task.duration*6e4;return x<M&&c>E}),I=new Set(O.map(j=>j.left)),y=I.size;let b=0;return b=Array.from(I).sort((j,E)=>j-E).indexOf(l.left),{...l,width:100/y,left:b/y*100}})},[t,f]),w=C(`${r.getHours()}:${r.getMinutes()}`);return e.jsxs("div",{className:"p-4 md:p-6 h-full relative",children:[e.jsxs("div",{className:"relative z-10",style:{height:`${S}px`},children:[f.map(({hour:s,top:i,height:l})=>e.jsxs("div",{className:"absolute w-full",style:{top:`${i}px`,height:`${l}px`},children:[e.jsxs("span",{className:"absolute -top-3 left-0 text-sm font-semibold text-gray-400 w-16 text-right pr-4",children:[s,":00"]}),e.jsx("div",{className:"h-px bg-gray-200 ml-16"})]},s)),w>=0&&w<=S&&e.jsx("div",{className:"absolute left-16 right-0 h-0.5 bg-red-500 z-20",style:{top:`${w}px`},children:e.jsx("div",{className:"absolute -left-1.5 -top-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white"})}),e.jsx("div",{className:"absolute top-0 bottom-0 left-16 right-0",children:D.map(({task:s,top:i,height:l,left:u,width:n,zIndex:d})=>e.jsx(de,{task:s,onUpdateStatus:m,onEdit:h,onViewSubtasks:()=>g(s),style:{top:`${i}px`,height:`${Math.max(l-4,80)}px`,left:`${u}%`,width:`calc(${n}% - 4px)`,zIndex:d}},s.id))})]}),v&&e.jsx(ce,{task:v,onClose:()=>g(null),onUpdateTask:$})]})},xe=t=>t>0?`en ${t} min`:t===0?"¡Ahora!":`hace ${Math.abs(t)} min`,he=({tasksWithDiff:t})=>e.jsxs("div",{className:"bg-yellow-100 border-b-2 border-yellow-300 p-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(P,{name:"alert-triangle",className:"text-yellow-600",size:20}),e.jsx("h3",{className:"font-bold text-yellow-800 text-base",children:"Tareas Críticas Próximas"})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:t.map(({task:m,diff:h})=>e.jsxs("div",{className:"bg-white/70 p-2 rounded-lg border border-yellow-300 flex-shrink-0 w-60",children:[e.jsx("p",{className:"font-bold text-sm text-gray-800 truncate",children:m.text}),e.jsxs("p",{className:`text-xs font-semibold ${h<=0?"text-red-600 animate-pulse":"text-blue-600"}`,children:[m.time," (",xe(h),")"]})]},m.id))})]}),ge=["Ali","Fer","Claudia","Admin"],be=({kanbanHook:t,criticalTasks:m})=>{const{tasks:h,addTask:$,addMultipleTasks:r,updateTask:k,updateTaskStatus:v,deleteTask:g}=t,[T,f]=o.useState(new Date),[S,C]=o.useState(!1),[D,w]=o.useState(null),[s,i]=o.useState("All"),l=c=>{w(c),C(!0)},u=()=>{C(!1),w(null)},n=(c,O)=>{const{recurrence:I,selectedDays:y,...b}=c,N=new Date(b.date);if(N.setMinutes(N.getMinutes()+N.getTimezoneOffset()),O){const j=h.find(M=>M.id===O);if(!j)return;const E={...j,...b,id:O};if(k(E),I==="weekly"&&y&&y.length>0){const M=new Date(N),z=N.getDay(),_=N.getDate()-z+(z===0?-6:1);M.setDate(_);const W=N.getDay(),A=[];y.forEach(L=>{const R=parseInt(L,10);if(R===W)return;const H=new Date(M);R===0?H.setDate(M.getDate()+6):H.setDate(M.getDate()+(R-1)),H.setMinutes(H.getMinutes()-H.getTimezoneOffset()),A.push({...b,date:H.toISOString().split("T")[0]})}),A.length>0&&r(A)}}else if(I==="weekly"&&y&&y.length>0){const j=new Date(N),E=N.getDay(),M=N.getDate()-E+(E===0?-6:1);j.setDate(M);const z=[];y.forEach(_=>{const W=parseInt(_,10),A=new Date(j);W===0?A.setDate(j.getDate()+6):A.setDate(j.getDate()+(W-1)),A.setMinutes(A.getMinutes()-A.getTimezoneOffset()),z.push({...b,date:A.toISOString().split("T")[0]})}),r(z)}else $(b)},d=o.useMemo(()=>{const c=new Date(T);return c.setMinutes(c.getMinutes()-c.getTimezoneOffset()),c.toISOString().split("T")[0]},[T]),x=o.useMemo(()=>h.filter(c=>{const O=c.date===d,I=s==="All"||c.employee===s;return O&&I}),[h,d,s]);return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50",children:[m.length>0&&e.jsx(he,{tasksWithDiff:m}),e.jsxs("div",{className:"operations-header flex flex-col p-4 border-b border-gray-200 gap-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center w-full gap-4",children:[e.jsx(oe,{selectedDate:T,setSelectedDate:f}),e.jsx("div",{className:"flex gap-2 w-full md:w-auto",children:e.jsxs("button",{onClick:()=>C(!0),className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm w-full justify-center",children:[e.jsx(P,{name:"plus-circle",size:16}),"Añadir Tarea"]})})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-200 rounded-lg p-1 w-full overflow-x-auto",children:[e.jsx("button",{onClick:()=>i("All"),className:`px-3 py-1 text-sm font-bold rounded-md transition-colors ${s==="All"?"bg-white shadow-sm":"bg-transparent text-gray-600"}`,children:"Todos"}),ge.map(c=>e.jsx("button",{onClick:()=>i(c),className:`px-3 py-1 text-sm font-bold rounded-md transition-colors ${s===c?"bg-white shadow-sm":"bg-transparent text-gray-600"}`,children:c},c))]})]}),e.jsx("div",{className:"flex-grow overflow-auto relative",children:e.jsx(me,{tasks:x,onEditTask:l,onUpdateStatus:v,onUpdateTask:k})}),e.jsx(ne,{isOpen:S,onClose:u,onSave:n,onDelete:g,task:D,selectedDate:d})]})};export{be as default};
