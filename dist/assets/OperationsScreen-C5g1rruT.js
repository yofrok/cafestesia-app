import{r,j as e,T as le,I as H,O as ne,a as re,b as oe}from"./index-BZJ7RoO2.js";import{M as ie}from"./Modal-DnuRkEv0.js";const ce=[{label:"L",value:"1"},{label:"M",value:"2"},{label:"M",value:"3"},{label:"J",value:"4"},{label:"V",value:"5"},{label:"S",value:"6"},{label:"D",value:"0"}],de=({isOpen:t,onClose:x,onSave:h,onDelete:w,task:l,selectedDate:T,users:v})=>{const[b,C]=r.useState(""),[$,N]=r.useState(""),[g,j]=r.useState("08"),[E,o]=r.useState("00"),[u,n]=r.useState("AM"),[c,a]=r.useState("30"),[i,d]=r.useState("pre-apertura"),[p,m]=r.useState(""),[I,P]=r.useState(!1),[M,k]=r.useState("once"),[y,S]=r.useState([]),[D,A]=r.useState("4"),[O,R]=r.useState([]),[F,W]=r.useState(""),[_,X]=r.useState(!1),[K,z]=r.useState(""),[B,U]=r.useState("");r.useEffect(()=>{if(t){const s=v.length>0?v[0].name:"";C((l==null?void 0:l.text)||""),N((l==null?void 0:l.employee)||s);const f=(l==null?void 0:l.time)||"08:00",[L,G]=f.split(":").map(Number),ae=L>=12?"PM":"AM";let q=L%12;q===0&&(q=12),j(String(q).padStart(2,"0")),o(String(G).padStart(2,"0")),n(ae),a(String((l==null?void 0:l.duration)||"30")),d((l==null?void 0:l.shift)||"pre-apertura"),m((l==null?void 0:l.zone)||""),P((l==null?void 0:l.isCritical)||!1),k("once"),S([]),A("4"),R((l==null?void 0:l.subtasks)||[]),W(""),X(!1),z(""),U("")}},[t,l,v]);const V=s=>{S(f=>f.includes(s)?f.filter(L=>L!==s):[...f,s])},Y=()=>{if(F.trim()==="")return;const s={id:`sub-${Date.now()}`,text:F.trim(),isCompleted:!1};R([...O,s]),W("")},Q=s=>{s.key==="Enter"&&(s.preventDefault(),Y())},ee=s=>{R(O.filter(f=>f.id!==s))},te=s=>{if(s.preventDefault(),!b){alert("Por favor completa el nombre de la tarea.");return}if(M==="weekly"&&y.length===0){alert("Por favor selecciona al menos un día para la tarea recurrente.");return}let f=parseInt(g,10);u==="PM"&&f!==12?f+=12:u==="AM"&&f===12&&(f=0);const L=`${String(f).padStart(2,"0")}:${E}`,G={text:b,employee:$,time:L,duration:parseInt(c,10),shift:i,zone:p,isCritical:I,date:(l==null?void 0:l.date)||T,recurrence:M,selectedDays:y,recurrenceWeeks:D,subtasks:O};h(G,l==null?void 0:l.id),x()},se=()=>{K===ne?(l&&w(l.id),x()):(U("PIN incorrecto. Inténtalo de nuevo."),z(""))},Z=!!l;return e.jsx(ie,{isOpen:t,onClose:x,title:l?"Editar Tarea":"Añadir Nueva Tarea",children:e.jsxs("div",{className:"relative",children:[e.jsxs("form",{onSubmit:te,className:"flex flex-col gap-4 max-h-[80vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Nombre de la Tarea"}),e.jsx("input",{type:"text",value:b,onChange:s=>C(s.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("fieldset",{disabled:Z,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Repetición"}),e.jsxs("div",{className:"flex gap-2 bg-gray-200 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>k("once"),className:`flex-1 p-2 rounded-md text-sm font-bold transition-colors ${M==="once"?"bg-white shadow-sm":""}`,children:"Una vez"}),e.jsx("button",{type:"button",onClick:()=>k("weekly"),className:`flex-1 p-2 rounded-md text-sm font-bold transition-colors ${M==="weekly"?"bg-white shadow-sm":""}`,children:"Semanalmente"})]}),Z&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"La repetición no se puede cambiar en una tarea existente."})]}),M==="weekly"&&e.jsxs("div",{className:"flex flex-col gap-4 mt-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Días de la semana"}),e.jsx("div",{className:"flex justify-between gap-1",children:ce.map(({label:s,value:f})=>e.jsx("button",{type:"button",onClick:()=>V(f),className:`w-9 h-9 flex items-center justify-center font-bold rounded-full border-2 transition-colors ${y.includes(f)?"bg-blue-600 text-white border-blue-600":"bg-gray-100 border-gray-300"}`,children:s},f))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Repetir durante"}),e.jsxs("select",{value:D,onChange:s=>A(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{value:"4",children:"4 semanas"}),e.jsx("option",{value:"8",children:"8 semanas"}),e.jsx("option",{value:"12",children:"12 semanas"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Empleado"}),e.jsx("select",{value:$,onChange:s=>N(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:v.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Turno"}),e.jsxs("select",{value:i,onChange:s=>d(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{value:"matutino",children:"Matutino"}),e.jsx("option",{value:"pre-apertura",children:"Pre Apertura"}),e.jsx("option",{value:"cierre",children:"Cierre"}),e.jsx("option",{value:"default",children:"Otro"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Hora"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("select",{value:g,onChange:s=>j(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Array.from({length:12},(s,f)=>f+1).map(s=>e.jsx("option",{value:String(s).padStart(2,"0"),children:String(s).padStart(2,"0")},s))}),e.jsx("select",{value:E,onChange:s=>o(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:Array.from({length:60},(s,f)=>f).map(s=>e.jsx("option",{value:String(s).padStart(2,"0"),children:String(s).padStart(2,"0")},s))}),e.jsxs("select",{value:u,onChange:s=>n(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("option",{children:"AM"}),e.jsx("option",{children:"PM"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Duración"}),e.jsx("select",{value:c,onChange:s=>a(s.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",children:le.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Zona (Opcional)"}),e.jsx("input",{type:"text",value:p,onChange:s=>m(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"form-group mt-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-2 block",children:"Subtareas"}),e.jsxs("div",{className:"bg-gray-100 p-3 rounded-lg",children:[O.length>0&&e.jsx("ul",{className:"space-y-2 mb-3",children:O.map(s=>e.jsxs("li",{className:"flex items-center justify-between bg-white p-2 rounded",children:[e.jsx("span",{className:"text-sm text-gray-700",children:s.text}),e.jsx("button",{type:"button",onClick:()=>ee(s.id),className:"p-1 text-gray-400 hover:text-red-600",children:e.jsx(H,{name:"trash-2",size:16})})]},s.id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:F,onChange:s=>W(s.target.value),onKeyDown:Q,placeholder:"Añadir una subtarea...",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-sm"}),e.jsx("button",{type:"button",onClick:Y,className:"py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 text-sm",children:"Añadir"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"task-critical",checked:I,onChange:s=>P(s.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"task-critical",className:"text-sm font-medium text-gray-600",children:"Es una tarea crítica"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t sticky bottom-0 bg-white",children:[e.jsx("div",{children:l&&e.jsx("button",{type:"button",onClick:()=>X(!0),className:"py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700",children:"Eliminar Tarea"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:x,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Guardar Cambios"})]})]})]}),_&&e.jsx("div",{className:"absolute inset-0 bg-white/80 backdrop-blur-sm flex justify-center items-center z-10",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-gray-200 w-full max-w-sm text-center",children:[e.jsx("h4",{className:"font-bold text-lg text-gray-800",children:"Confirmar Eliminación"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2 mb-4",children:"Para confirmar, introduce el PIN de operaciones. Esta acción no se puede deshacer."}),e.jsx("input",{type:"password",value:K,onChange:s=>{z(s.target.value),U("")},placeholder:"PIN de Seguridad",autoFocus:!0,className:"w-full p-2 border border-gray-300 rounded-md text-center"}),B&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:B}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{onClick:()=>X(!1),className:"flex-1 py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{onClick:se,className:"flex-1 py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700",children:"Confirmar"})]})]})})]})})},ue=({selectedDate:t,setSelectedDate:x})=>{const[h,w]=r.useState(t),[l,T]=r.useState(""),v=r.useRef(0);r.useEffect(()=>{w(t)},[t]),r.useEffect(()=>{if(l.startsWith("slide-out")){const a=l.includes("left")?"next":"prev",i=setTimeout(()=>{const d=new Date(h);d.setDate(d.getDate()+(a==="prev"?-7:7)),w(d);const p=new Date(t);p.setDate(p.getDate()+(a==="prev"?-7:7)),x(p),T(a==="next"?"slide-in-from-right":"slide-in-from-left")},200);return()=>clearTimeout(i)}else if(l.startsWith("slide-in")){const a=setTimeout(()=>{T("")},200);return()=>clearTimeout(a)}},[l,h,t,x]);const b=a=>{l||T(a==="next"?"slide-out-left":"slide-out-right")},C=a=>{const i=a.target.value;if(i){const d=new Date(i);d.setMinutes(d.getMinutes()+d.getTimezoneOffset()),x(d)}},$=a=>{v.current=a.targetTouches[0].clientX},N=a=>{const i=a.changedTouches[0].clientX,d=50,p=v.current-i;p>d?b("next"):p<-d&&b("prev")},g=new Date;g.setHours(0,0,0,0);const j=new Date(h),E=h.getDay(),o=h.getDate()-E+(E===0?-6:1);j.setDate(o),j.setHours(0,0,0,0);const u=[];for(let a=0;a<7;a++){const i=new Date(j);i.setDate(j.getDate()+a),u.push(i)}const n=(a,i)=>a.getFullYear()===i.getFullYear()&&a.getMonth()===i.getMonth()&&a.getDate()===i.getDate(),c=h.toLocaleDateString("es-ES",{month:"long",year:"numeric"});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 px-2",children:[e.jsx("button",{onClick:()=>b("prev"),className:"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(H,{name:"chevron-left",size:20})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold text-gray-700 capitalize text-sm",children:c}),e.jsxs("div",{className:"relative w-9 h-9 flex items-center justify-center text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors cursor-pointer",title:"Seleccionar fecha",children:[e.jsx(H,{name:"calendar",size:18}),e.jsx("input",{type:"date",onChange:C,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer","aria-label":"Seleccionar fecha"})]})]}),e.jsx("button",{onClick:()=>b("next"),className:"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(H,{name:"chevron-right",size:20})})]}),e.jsx("div",{className:"p-1 bg-gray-200 rounded-lg overflow-hidden relative touch-pan-y",children:e.jsx("div",{className:`flex justify-between items-center gap-1 md:gap-2 ${l}`,onTouchStart:$,onTouchEnd:N,children:u.map(a=>{const i=n(a,t),d=n(a,g);return e.jsx("button",{onClick:()=>x(a),className:"px-1 py-1 md:px-2 md:py-2 rounded-md transition-all duration-200 text-center flex-1",children:e.jsxs("div",{className:`${i?"bg-white shadow-sm rounded-md":""} py-1`,children:[e.jsx("span",{className:`text-xs uppercase font-bold ${i?"text-blue-600":"text-gray-500"}`,children:a.toLocaleDateString("es-ES",{weekday:"short"}).replace(".","")}),e.jsx("p",{className:`font-bold text-lg ${d?"text-blue-600":i?"text-gray-800":"text-gray-600"}`,children:a.getDate()})]})},a.toISOString())})})})]})},me=t=>{switch(t){case"inprogress":return"opacity-100 animate-pulse-yellow";case"done":return"opacity-50";case"todo":default:return"opacity-100"}},xe=({task:t,onUpdateStatus:x,onEdit:h,onViewSubtasks:w,style:l,userColor:T})=>{var u,n;const v=me(t.status),b=c=>{c.stopPropagation(),t.status==="todo"?x(t.id,"inprogress"):t.status==="inprogress"?x(t.id,"done"):t.status==="done"&&x(t.id,"todo")},C=new Date(`${t.date}T${t.time}`),N=new Date(C.getTime()+t.duration*6e4).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hourCycle:"h23"}),g=((u=t.subtasks)==null?void 0:u.length)||0,j=((n=t.subtasks)==null?void 0:n.filter(c=>c.isCompleted).length)||0,E={...l,borderWidth:"2px",borderColor:t.status==="inprogress"?T:"transparent",backgroundColor:"#f9fafb"},o={color:"#374151"};return e.jsxs("div",{style:E,onClick:w,className:`absolute rounded-lg p-2 flex gap-2 transition-all duration-300 cursor-pointer ${v}`,children:[e.jsx("div",{className:"flex-shrink-0 w-1 h-full rounded-full",style:{backgroundColor:T}}),e.jsxs("div",{className:"flex-grow flex flex-col min-w-0 min-h-0",children:[e.jsxs("div",{className:"flex-grow overflow-hidden",children:[e.jsx("p",{className:`font-bold text-sm break-words ${t.status==="done"?"line-through":""}`,style:o,children:t.text}),e.jsxs("p",{className:`text-xs ${t.status==="done"?"line-through":""}`,style:o,children:[t.time," - ",N," (",t.duration," min)"]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1 flex-shrink-0",children:[e.jsx("span",{className:"text-xs font-bold px-2 py-0.5 rounded-full bg-white/60",style:o,children:t.employee}),e.jsxs("div",{className:"flex items-center gap-2",style:o,children:[g>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs font-semibold",children:[e.jsx(H,{name:"list",size:14}),e.jsxs("span",{children:[j,"/",g]})]}),e.jsx("button",{onClick:c=>{c.stopPropagation(),h(t)},className:"p-1 rounded-full hover:bg-black/10 transition-colors",title:"Editar Tarea",children:e.jsx(H,{name:"pencil",size:14})})]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:b,className:"w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all",style:{borderColor:t.status==="done"?"#4ade80":"#9ca3af",backgroundColor:t.status==="done"?"#4ade80":"white"},children:[t.status==="inprogress"&&e.jsx("div",{className:"w-2.5 h-2.5 bg-yellow-500 rounded-full"}),t.status==="done"&&e.jsx(H,{name:"check",size:16,className:"text-white"})]})})]})},he=({task:t,onClose:x,onUpdateTask:h})=>{var j,E;const[w,l]=r.useState(""),T=o=>{const u=(t.subtasks||[]).map(n=>n.id===o?{...n,isCompleted:!n.isCompleted}:n);h({...t,subtasks:u})},v=()=>{if(w.trim()==="")return;const o={id:`sub-${Date.now()}`,text:w.trim(),isCompleted:!1},u=[...t.subtasks||[],o];h({...t,subtasks:u}),l("")},b=o=>{const u=(t.subtasks||[]).filter(n=>n.id!==o);h({...t,subtasks:u})},C=o=>{o.key==="Enter"&&(o.preventDefault(),v())},$=((j=t.subtasks)==null?void 0:j.filter(o=>o.isCompleted).length)||0,N=((E=t.subtasks)==null?void 0:E.length)||0,g=N>0?$/N*100:0;return e.jsx("div",{className:"absolute inset-0 bg-gray-900/40 z-50 flex justify-center items-center p-4",onClick:x,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md flex flex-col",onClick:o=>o.stopPropagation(),children:[e.jsxs("header",{className:"p-4 border-b",children:[e.jsx("h3",{className:"font-bold text-lg text-blue-700",children:t.text}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.time," - ",t.employee]})]}),e.jsxs("div",{className:"p-4 flex-grow overflow-y-auto max-h-[50vh]",children:[N>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Progreso"}),e.jsxs("span",{children:[$," / ",N]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${g}%`}})})]}),e.jsx("div",{className:"space-y-2",children:(t.subtasks||[]).map(o=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-md group",children:[e.jsx("input",{type:"checkbox",checked:o.isCompleted,onChange:()=>T(o.id),className:"w-5 h-5 rounded text-blue-600 focus:ring-blue-500 flex-shrink-0"}),e.jsx("span",{className:`flex-grow text-gray-800 ${o.isCompleted?"line-through text-gray-400":""}`,children:o.text}),e.jsx("button",{onClick:()=>b(o.id),className:"p-1 text-gray-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(H,{name:"trash-2",size:16})})]},o.id))}),N===0&&e.jsx("p",{className:"text-center text-gray-500 py-6",children:"No hay subtareas. ¡Añade la primera!"})]}),e.jsx("div",{className:"p-4 border-t bg-gray-50 rounded-b-xl",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:w,onChange:o=>l(o.target.value),onKeyDown:C,placeholder:"Añadir nueva subtarea...",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-sm focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:v,className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 text-sm",children:"Añadir"})]})})]})})},J=120,ge=30,pe=({tasks:t,onUpdateStatus:x,onEditTask:h,onUpdateTask:w,users:l})=>{const[T,v]=r.useState(new Date),[b,C]=r.useState(null),$=r.useMemo(()=>l.reduce((n,c)=>(n[c.name]=c.color,n),{}),[l]);r.useEffect(()=>{const n=setInterval(()=>v(new Date),6e4);return()=>clearInterval(n)},[]),r.useEffect(()=>{if(b){const n=t.find(c=>c.id===b.id);C(n||null)}},[t,b]);const N=r.useMemo(()=>{const n={};return t.forEach(c=>{const a=parseInt(c.time.split(":")[0],10);n[a]=!0}),n},[t]),g=r.useMemo(()=>{let n=0;const c=[];for(let a=oe;a<=re;a++){const d=!!N[a]?J:ge;c.push({hour:a,top:n,height:d}),n+=d}return c},[N]),j=g.length>0?g[g.length-1].top+g[g.length-1].height:0,E=n=>{const[c,a]=n.split(":").map(Number),i=g.find(p=>p.hour===c);if(!i)return 0;const d=a/60*i.height;return i.top+d},o=r.useMemo(()=>{const n=[...t].sort((a,i)=>a.time.localeCompare(i.time)||i.duration-a.duration),c=[];for(const a of n){const i=E(a.time),d=new Date(`${a.date}T${a.time}`).getTime(),p=d+a.duration*6e4,m=g.find(y=>y.hour===parseInt(a.time.split(":")[0],10)),I=m?m.height:J,P=a.duration/60*I,M=[];for(const y of c){const S=new Date(`${y.task.date}T${y.task.time}`).getTime(),D=S+y.task.duration*6e4;d<D&&p>S&&M.push(y)}let k=0;for(;M.some(y=>y.left===k);)k++;c.push({task:a,top:i,height:P,left:k,width:1,zIndex:k})}return c.map((a,i,d)=>{const{task:p}=a,m=new Date(`${p.date}T${p.time}`).getTime(),I=m+p.duration*6e4,P=d.filter(D=>{const A=new Date(`${D.task.date}T${D.task.time}`).getTime(),O=A+D.task.duration*6e4;return m<O&&I>A}),M=new Set(P.map(D=>D.left)),k=M.size;let y=0;return y=Array.from(M).sort((D,A)=>D-A).indexOf(a.left),{...a,width:100/k,left:y/k*100}})},[t,g]),u=E(`${T.getHours()}:${T.getMinutes()}`);return e.jsxs("div",{className:"p-4 md:p-6 h-full relative",children:[e.jsxs("div",{className:"relative z-10",style:{height:`${j}px`},children:[g.map(({hour:n,top:c,height:a})=>e.jsxs("div",{className:"absolute w-full",style:{top:`${c}px`,height:`${a}px`},children:[e.jsxs("span",{className:"absolute -top-3 left-0 text-sm font-semibold text-gray-400 w-16 text-right pr-4",children:[n,":00"]}),e.jsx("div",{className:"h-px bg-gray-200 ml-16"})]},n)),u>=0&&u<=j&&e.jsx("div",{className:"absolute left-16 right-0 h-0.5 bg-red-500 z-20",style:{top:`${u}px`},children:e.jsx("div",{className:"absolute -left-1.5 -top-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white"})}),e.jsx("div",{className:"absolute top-0 bottom-0 left-16 right-0",children:o.map(({task:n,top:c,height:a,left:i,width:d,zIndex:p})=>e.jsx(xe,{task:n,onUpdateStatus:x,onEdit:h,onViewSubtasks:()=>C(n),userColor:$[n.employee]||"#9ca3af",style:{top:`${c}px`,height:`${Math.max(a-4,80)}px`,left:`${i}%`,width:`calc(${d}% - 4px)`,zIndex:p}},n.id))})]}),b&&e.jsx(he,{task:b,onClose:()=>C(null),onUpdateTask:w})]})},fe=t=>t>0?`en ${t} min`:t===0?"¡Ahora!":`hace ${Math.abs(t)} min`,be=({tasksWithDiff:t})=>e.jsxs("div",{className:"bg-yellow-100 border-b-2 border-yellow-300 p-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(H,{name:"alert-triangle",className:"text-yellow-600",size:20}),e.jsx("h3",{className:"font-bold text-yellow-800 text-base",children:"Tareas Críticas Próximas"})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:t.map(({task:x,diff:h})=>e.jsxs("div",{className:"bg-white/70 p-2 rounded-lg border border-yellow-300 flex-shrink-0 w-60",children:[e.jsx("p",{className:"font-bold text-sm text-gray-800 truncate",children:x.text}),e.jsxs("p",{className:`text-xs font-semibold ${h<=0?"text-red-600 animate-pulse":"text-blue-600"}`,children:[x.time," (",fe(h),")"]})]},x.id))})]}),ve=({kanbanHook:t,criticalTasks:x,users:h})=>{const{tasks:w,addTask:l,addMultipleTasks:T,updateTask:v,updateTaskStatus:b,deleteTask:C}=t,[$,N]=r.useState(new Date),[g,j]=r.useState(!1),[E,o]=r.useState(null),[u,n]=r.useState("All"),c=m=>{o(m),j(!0)},a=()=>{j(!1),o(null)},i=(m,I)=>{const{recurrence:P,selectedDays:M,recurrenceWeeks:k,...y}=m;if(I){const S=w.find(A=>A.id===I);if(!S)return;const D={...S,...y,id:I};v(D)}else{const S=new Date(y.date);if(S.setMinutes(S.getMinutes()+S.getTimezoneOffset()),P==="weekly"&&M&&M.length>0){const D=parseInt(k||"4",10),A=[],O=new Date(S),R=S.getDay(),F=S.getDate()-R+(R===0?-6:1);O.setDate(F);for(let W=0;W<D;W++){const _=new Date(O);_.setDate(O.getDate()+W*7),M.forEach(X=>{const K=parseInt(X,10),z=new Date(_);K===0?z.setDate(_.getDate()+6):z.setDate(_.getDate()+(K-1)),z.setMinutes(z.getMinutes()-z.getTimezoneOffset()),A.push({...y,date:z.toISOString().split("T")[0]})})}T(A)}else l(y)}},d=r.useMemo(()=>{const m=new Date($);return m.setMinutes(m.getMinutes()-m.getTimezoneOffset()),m.toISOString().split("T")[0]},[$]),p=r.useMemo(()=>w.filter(m=>{const I=m.date===d,P=u==="All"||m.employee===u;return I&&P}),[w,d,u]);return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50",children:[x.length>0&&e.jsx(be,{tasksWithDiff:x}),e.jsxs("div",{className:"operations-header flex flex-col p-4 border-b border-gray-200 gap-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center w-full gap-4",children:[e.jsx(ue,{selectedDate:$,setSelectedDate:N}),e.jsx("div",{className:"flex gap-2 w-full md:w-auto",children:e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm w-full justify-center",children:[e.jsx(H,{name:"plus-circle",size:16}),"Añadir Tarea"]})})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-200 rounded-lg p-1 w-full overflow-x-auto",children:[e.jsx("button",{onClick:()=>n("All"),className:`px-3 py-1 text-sm font-bold rounded-md transition-colors ${u==="All"?"bg-white shadow-sm":"bg-transparent text-gray-600"}`,children:"Todos"}),h.map(m=>e.jsx("button",{onClick:()=>n(m.name),className:`px-3 py-1 text-sm font-bold rounded-md transition-colors ${u===m.name?"bg-white shadow-sm":"bg-transparent text-gray-600"}`,children:m.name},m.id))]})]}),e.jsx("div",{className:"flex-grow overflow-auto relative",children:e.jsx(pe,{tasks:p,onEditTask:c,onUpdateStatus:b,onUpdateTask:v,users:h})}),e.jsx(de,{isOpen:g,onClose:a,onSave:i,onDelete:C,task:E,selectedDate:d,users:h})]})};export{ve as default};
