import{j as e,I as f,r as l,e as q,R as O}from"./index-7f0Z6dSx.js";import{S as B}from"./StockUpdateModal-DbMlrjzm.js";import{M as T}from"./Modal-C5sr91eM.js";import{S as U}from"./StockHistoryLog-BefsOZ-R.js";const E=({icon:t,onClick:d,colorClass:h,title:c})=>e.jsx("button",{title:c,onClick:d,className:`w-10 h-10 flex items-center justify-center bg-gray-100 border border-gray-200 rounded-full transition-colors ${h}`,children:e.jsx(f,{name:t,size:20})}),D=({item:t,onEdit:d,onAddStock:h,onUseStock:c,onViewHistory:s})=>{const r=t.currentStock<=t.minStock,a=t.purchaseHistory&&t.purchaseHistory.length>0?t.purchaseHistory[t.purchaseHistory.length-1]:null,x=a?(a.totalPrice/a.quantity).toFixed(2):null;return e.jsxs("div",{className:`p-4 bg-white rounded-lg border flex flex-col md:flex-row md:items-center justify-between gap-4 ${r?"border-red-300 bg-red-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-bold text-lg",children:t.name}),e.jsxs("div",{className:"flex flex-wrap items-baseline gap-x-4 gap-y-1 text-sm",children:[e.jsxs("p",{children:["Stock: ",e.jsx("span",{className:"font-semibold",children:t.currentStock.toFixed(2)})," ",t.unit]}),e.jsxs("p",{className:"text-gray-500",children:["(Mín: ",t.minStock," ",t.unit,")"]}),x&&e.jsxs("p",{className:"text-gray-500 font-semibold",children:["Último Precio: $",x," / ",t.unit]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 justify-end",children:[e.jsx(E,{icon:"plus",onClick:h,colorClass:"hover:bg-green-100 hover:text-green-600",title:"Añadir Stock"}),e.jsx(E,{icon:"minus",onClick:c,colorClass:"hover:bg-red-100 hover:text-red-600",title:"Usar Stock"}),e.jsx(E,{icon:"bar-chart-2",onClick:s,colorClass:"hover:bg-yellow-100 hover:text-yellow-600",title:"Historial de Precios"}),e.jsx(E,{icon:"pencil",onClick:()=>d(t),colorClass:"hover:bg-blue-100 hover:text-blue-600",title:"Editar Producto"})]})]})},R=({isOpen:t,onClose:d,item:h})=>{const c=l.useMemo(()=>h.purchaseHistory?[...h.purchaseHistory].sort((r,a)=>new Date(a.date).getTime()-new Date(r.date).getTime()):[],[h.purchaseHistory]),s=l.useMemo(()=>!c||c.length===0?null:c.reduce((r,a)=>{const x=a.totalPrice/a.quantity;return x<r?x:r},1/0),[c]);return e.jsxs(T,{isOpen:t,onClose:d,title:`Historial de Precios: ${h.name}`,children:[e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[s&&s!==1/0&&e.jsx("div",{className:"p-3 mb-4 bg-green-100 border border-green-300 rounded-lg text-center",children:e.jsxs("p",{className:"font-bold text-green-800",children:["Mejor Precio Histórico: $",s.toFixed(2)," / ",h.unit]})}),c.length>0?e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"Fecha"}),e.jsx("th",{className:"p-2",children:"Proveedor"}),e.jsx("th",{className:"p-2",children:"Cant."}),e.jsx("th",{className:"p-2",children:"Total"}),e.jsx("th",{className:"p-2",children:"Unitario"})]})}),e.jsx("tbody",{children:c.map(r=>{const a=r.totalPrice/r.quantity,x=a.toFixed(2)===(s==null?void 0:s.toFixed(2));return e.jsxs("tr",{className:`border-b ${x?"bg-green-50":""}`,children:[e.jsx("td",{className:"p-2",children:new Date(r.date).toLocaleDateString()}),e.jsx("td",{className:"p-2",children:r.providerName}),e.jsxs("td",{className:"p-2",children:[r.quantity," ",h.unit]}),e.jsxs("td",{className:"p-2",children:["$",r.totalPrice.toFixed(2)]}),e.jsxs("td",{className:`p-2 font-bold ${x?"text-green-700":""}`,children:["$",a.toFixed(2)]})]},r.id)})})]}):e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No hay historial de compras para este producto."})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:d,className:"py-2 px-6 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cerrar"})})]})},L=({title:t,count:d,children:h,defaultOpen:c=!0,icon:s,colorClass:r="text-gray-800",bgClass:a="bg-gray-100"})=>{const[x,i]=l.useState(c);return e.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("button",{onClick:()=>i(!x),className:`w-full flex items-center justify-between p-4 transition-colors ${a} hover:brightness-95`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s&&e.jsx(f,{name:s,size:20,className:r}),e.jsx("h3",{className:`text-lg font-bold ${r}`,children:t}),d!==void 0&&e.jsx("span",{className:"bg-white px-2 py-0.5 rounded-full text-xs font-bold text-gray-500 shadow-sm",children:d})]}),e.jsx("div",{className:`text-gray-400 transition-transform duration-300 ${x?"rotate-90":""}`,children:e.jsx(f,{name:"chevron-right",size:20})})]}),e.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${x?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"}`,children:e.jsx("div",{className:"p-4 bg-white border-t border-gray-100",children:h})})]})},V=({items:t,onEdit:d,onRecordStockChange:h,providers:c})=>{const[s,r]=l.useState(null),[a,x]=l.useState(null),[i,u]=l.useState("name"),[p,v]=l.useState("all"),k=l.useMemo(()=>t.filter(o=>p==="all"?!0:(o.providerPreferido||"Sin Proveedor")===p),[t,p]),S=l.useMemo(()=>{const o=[...k];switch(i){case"name":o.sort((m,b)=>m.name.localeCompare(b.name));break;case"stockAsc":o.sort((m,b)=>m.currentStock/(m.minStock||1)-b.currentStock/(b.minStock||1));break;case"stockDesc":o.sort((m,b)=>b.currentStock-m.currentStock);break}return o},[k,i]),j=l.useMemo(()=>S.reduce((o,m)=>{const b=m.category||"Sin Categoría";return o[b]||(o[b]=[]),o[b].push(m),o},{}),[S]),N=Object.keys(j).sort();return t.length===0?e.jsx("p",{className:"text-center text-gray-500 mt-8",children:"No se encontraron productos."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 p-3 bg-white rounded-xl border border-gray-200 shadow-sm sticky top-0 z-20",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Ordenar por"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u("name"),className:`flex-1 py-1.5 px-3 rounded-lg text-sm font-medium border transition-colors ${i==="name"?"bg-blue-50 border-blue-300 text-blue-700":"bg-white border-gray-200 text-gray-600"}`,children:"A-Z"}),e.jsx("button",{onClick:()=>u("stockAsc"),className:`flex-1 py-1.5 px-3 rounded-lg text-sm font-medium border transition-colors ${i==="stockAsc"?"bg-blue-50 border-blue-300 text-blue-700":"bg-white border-gray-200 text-gray-600"}`,children:"Stock Bajo"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Filtrar Proveedor"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:p,onChange:o=>v(o.target.value),className:"w-full py-1.5 pl-2 pr-8 rounded-lg text-sm border border-gray-200 bg-white text-gray-700 focus:ring-2 focus:ring-blue-500 appearance-none",children:[e.jsx("option",{value:"all",children:"Todos los Proveedores"}),c.map(o=>e.jsx("option",{value:o.name,children:o.name},o.id)),e.jsx("option",{value:"Sin Proveedor",children:"Sin Proveedor"})]}),e.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none",children:e.jsx(f,{name:"chevron-right",size:14,className:"rotate-90"})})]})]})]}),e.jsxs("div",{className:"space-y-4 pb-20",children:[N.map(o=>e.jsx(L,{title:o,count:j[o].length,colorClass:"text-blue-800",bgClass:"bg-blue-50/50",children:e.jsx("div",{className:"space-y-3",children:j[o].map(m=>e.jsx(D,{item:m,onEdit:d,onAddStock:()=>r({item:m,isAdding:!0}),onUseStock:()=>r({item:m,isAdding:!1}),onViewHistory:()=>x(m)},m.id))})},o)),N.length===0&&e.jsx("div",{className:"text-center py-10 bg-gray-50 rounded-lg border border-dashed",children:e.jsx("p",{className:"text-gray-500",children:"No hay productos que coincidan con los filtros."})})]}),s&&e.jsx(B,{isOpen:!!s,onClose:()=>r(null),item:s.item,isAdding:s.isAdding,onUpdate:h,providers:c}),a&&e.jsx(R,{isOpen:!!a,onClose:()=>x(null),item:a})]})},G=({items:t,onRecordStockChange:d,providers:h})=>{const[c,s]=l.useState(null),r=t.filter(i=>i.currentStock<=i.minStock),a=r.reduce((i,u)=>{const p=u.providerPreferido||"Sin Proveedor";return i[p]||(i[p]=[]),i[p].push(u),i},{}),x=Object.keys(a).sort((i,u)=>i==="Sin Proveedor"?1:u==="Sin Proveedor"?-1:i.localeCompare(u));return r.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"bg-green-100 p-4 rounded-full mb-4",children:e.jsx(f,{name:"check-circle",size:48,className:"text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"¡Todo en orden!"}),e.jsx("p",{className:"text-gray-500",children:"No hay productos por debajo del stock mínimo."})]}):e.jsxs("div",{className:"space-y-4 pb-20",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 p-4 rounded-xl flex items-center gap-4",children:[e.jsx("div",{className:"bg-white p-2 rounded-full shadow-sm",children:e.jsx(f,{name:"shopping-cart",className:"text-red-500",size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-red-800 text-lg",children:"Lista de Compras Activa"}),e.jsxs("p",{className:"text-red-600 text-sm",children:[r.length," productos requieren reabastecimiento."]})]})]}),x.map(i=>e.jsx(L,{title:i,count:a[i].length,icon:"store",colorClass:"text-gray-800",bgClass:"bg-white",children:e.jsx("div",{className:"space-y-3",children:a[i].map(u=>e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg flex flex-col sm:flex-row justify-between sm:items-center gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-800",children:u.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm mt-1",children:[e.jsxs("span",{className:"text-red-600 font-bold bg-red-100 px-2 py-0.5 rounded",children:["Quedan: ",u.currentStock," ",u.unit]}),e.jsxs("span",{className:"text-gray-500",children:["(Mín: ",u.minStock," ",u.unit,")"]})]})]}),e.jsxs("button",{onClick:()=>s(u),className:"flex-shrink-0 flex items-center justify-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm shadow-sm active:scale-95",children:[e.jsx(f,{name:"plus-circle",size:16}),"Comprar"]})]},u.id))})},i)),c&&e.jsx(B,{isOpen:!!c,onClose:()=>s(null),item:c,isAdding:!0,onUpdate:d,providers:h})]})},K=({isOpen:t,onClose:d,onSave:h,onDelete:c,item:s,providers:r,categories:a})=>{const[x,i]=l.useState(""),[u,p]=l.useState(""),[v,k]=l.useState(""),[S,j]=l.useState("0"),[N,o]=l.useState(q[0]),[m,b]=l.useState("0"),[A,F]=l.useState(!1),[w,C]=l.useState(void 0),[M,y]=l.useState("");l.useEffect(()=>{t&&(i((s==null?void 0:s.name)||""),p((s==null?void 0:s.category)||(a.length>0?a[0].name:"")),k((s==null?void 0:s.providerPreferido)||""),j(String((s==null?void 0:s.currentStock)||0)),o((s==null?void 0:s.unit)||q[0]),b(String((s==null?void 0:s.minStock)||0)),F((s==null?void 0:s.isBakeryCritical)||!1),C(s==null?void 0:s.kitchenStation),y(""))},[t,s,a]);const H=n=>{n.preventDefault(),y("");const $=parseFloat(S),P=parseFloat(m);if(!x.trim()){y("El nombre es obligatorio.");return}if(!N.trim()){y("La unidad es obligatoria.");return}if(isNaN($)||$<0){y("Stock debe ser un número positivo.");return}if(isNaN(P)||P<0){y("Nivel mínimo debe ser un número positivo.");return}const z={name:x.trim(),category:u.trim()||"Sin Categoría",providerPreferido:v.trim(),currentStock:$,unit:N.trim(),minStock:P,isBakeryCritical:A,kitchenStation:w};h(s?{...s,...z}:z),d()},g=()=>{s&&window.confirm(`¿Estás seguro de que quieres eliminar "${s.name}"?`)&&(c(s.id),d())};return e.jsx(T,{isOpen:t,onClose:d,title:s?"Editar Producto":"Añadir Producto",children:e.jsxs("form",{onSubmit:H,className:"flex flex-col gap-4 max-h-[80vh] overflow-y-auto pr-2",children:[e.jsx(I,{label:"Nombre del Producto",children:e.jsx("input",{type:"text",value:x,onChange:n=>i(n.target.value),required:!0})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(I,{label:"Categoría",children:e.jsxs("select",{value:u,onChange:n=>p(n.target.value),children:[e.jsx("option",{value:"",children:"Sin Categoría"}),a.map(n=>e.jsx("option",{value:n.name,children:n.name},n.id))]})}),e.jsx(I,{label:"Proveedor Preferido",children:e.jsxs("select",{value:v,onChange:n=>k(n.target.value),children:[e.jsx("option",{value:"",children:"Sin Proveedor"}),r.map(n=>e.jsx("option",{value:n.name,children:n.name},n.id))]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(I,{label:"Stock Actual",children:e.jsx("input",{type:"number",value:S,onChange:n=>j(n.target.value),step:"any",min:"0",required:!0})}),e.jsx(I,{label:"Unidad",children:e.jsx("select",{value:N,onChange:n=>o(n.target.value),required:!0,children:q.map(n=>e.jsx("option",{value:n,children:n},n))})})]}),e.jsx(I,{label:"Nivel Mínimo (para Alertas)",children:e.jsx("input",{type:"number",value:m,onChange:n=>b(n.target.value),step:"any",min:"0",required:!0})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-bold text-gray-700 text-sm border-b pb-1",children:"Configuración de Tableros"}),e.jsxs("div",{className:"bg-emerald-50 p-3 rounded-lg border border-emerald-200 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-bold text-emerald-800",children:"Insumo Crítico de Panadería"}),e.jsx("span",{className:"text-xs text-emerald-600",children:"Visible en Tablero Panadería"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:A,onChange:n=>F(n.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-600"})]})]}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg border border-orange-200",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"block text-sm font-bold text-orange-800",children:"Estación de Cocina"}),e.jsx("span",{className:"text-xs text-orange-600",children:"Define dónde aparecerá en el Tablero de Cocina"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>C(void 0),className:`flex-1 py-1.5 text-xs font-bold rounded border transition-colors ${w?"border-transparent text-gray-400 hover:bg-orange-100":"bg-white border-gray-400 text-gray-700 shadow-sm"}`,children:"Ninguna"}),e.jsx("button",{type:"button",onClick:()=>C("market"),className:`flex-1 py-1.5 text-xs font-bold rounded border transition-colors ${w==="market"?"bg-white border-green-500 text-green-700 shadow-sm":"border-transparent text-gray-400 hover:bg-green-100 hover:text-green-600"}`,children:"Mercado"}),e.jsx("button",{type:"button",onClick:()=>C("prep"),className:`flex-1 py-1.5 text-xs font-bold rounded border transition-colors ${w==="prep"?"bg-white border-red-500 text-red-700 shadow-sm":"border-transparent text-gray-400 hover:bg-red-100 hover:text-red-600"}`,children:"Prep"}),e.jsx("button",{type:"button",onClick:()=>C("pantry"),className:`flex-1 py-1.5 text-xs font-bold rounded border transition-colors ${w==="pantry"?"bg-white border-blue-500 text-blue-700 shadow-sm":"border-transparent text-gray-400 hover:bg-blue-100 hover:text-blue-600"}`,children:"Almacén"})]})]})]}),M&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:M}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("div",{children:s&&e.jsx("button",{type:"button",onClick:g,className:"py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700",children:"Eliminar"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:d,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Guardar"})]})]})]})})},I=({label:t,children:d})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:t}),O.cloneElement(d,{className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),J=({inventoryHook:t,providers:d,categories:h})=>{const{items:c,addItem:s,updateItem:r,deleteItem:a,recordStockChange:x,stockLogs:i}=t,[u,p]=l.useState("general"),[v,k]=l.useState(""),[S,j]=l.useState(!1),[N,o]=l.useState(null),[m,b]=l.useState(!1),A=g=>{o(g),j(!0)},F=()=>{o(null),j(!0)},w=()=>{j(!1),o(null)},C=g=>{"id"in g?r(g):s(g)},M=l.useMemo(()=>c.filter(g=>g.name.toLowerCase().includes(v.toLowerCase())),[c,v]),y=l.useMemo(()=>c.filter(g=>g.currentStock<=g.minStock).length,[c]),H=({view:g,label:n,icon:$,badge:P})=>e.jsxs("button",{onClick:()=>p(g),className:`relative flex items-center gap-2 py-3 px-4 text-sm md:text-base font-bold border-b-4 transition-colors ${u===g?"border-blue-600 text-blue-600 bg-blue-50/50":"border-transparent text-gray-500 hover:text-gray-800 hover:bg-gray-50"}`,children:[e.jsx(f,{name:$,size:18}),n,P!==void 0&&P>0&&e.jsx("span",{className:"ml-1 bg-red-500 text-white text-[10px] px-1.5 py-0.5 rounded-full",children:P})]});return m?e.jsx(U,{logs:i,onClose:()=>b(!1)}):e.jsxs("div",{className:"flex flex-col h-full bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Inventario"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:[c.length," productos totales • ",y," alertas"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(!0),className:"p-2 text-gray-500 hover:bg-gray-100 rounded-full transition-colors",title:"Ver Historial",children:e.jsx(f,{name:"list",size:20})}),e.jsxs("button",{onClick:F,className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm shadow-sm",children:[e.jsx(f,{name:"plus-circle",size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Producto"})]})]})]}),e.jsxs("div",{className:"flex px-4 gap-1 overflow-x-auto",children:[e.jsx(H,{view:"general",label:"General",icon:"boxes"}),e.jsx(H,{view:"shopping-list",label:"Lista de Compras",icon:"shopping-cart",badge:y})]})]}),e.jsx("div",{className:"p-4 bg-gray-50 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400",children:e.jsx(f,{name:"list",size:20})}),e.jsx("input",{type:"search",value:v,onChange:g=>k(g.target.value),placeholder:"Buscar por nombre...",className:"w-full p-3 pl-4 border border-gray-300 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm transition-shadow"})]})}),e.jsx("div",{className:"flex-grow overflow-y-auto px-4 pb-4",children:u==="general"?e.jsx(V,{items:M,onEdit:A,onRecordStockChange:x,providers:d}):e.jsx(G,{items:M,onRecordStockChange:x,providers:d})}),e.jsx(K,{isOpen:S,onClose:w,onSave:C,onDelete:a,item:N,providers:d,categories:h})]})};export{J as default};
