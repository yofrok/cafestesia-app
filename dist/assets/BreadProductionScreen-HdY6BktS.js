import{r as u,j as e,I as c,o as Y,d as Z,s as ee,a as te,u as se}from"./index-CE1MFFCv.js";import{M as H}from"./Modal-dsQ9zPJa.js";import{S as q}from"./SwipeButton-CJC_Jtfy.js";import{S as re}from"./StockHistoryLog-DEV4cyK8.js";const ae=({isOpen:r,onClose:i,onSelectRecipe:o,onSelectHeating:m,recipes:b})=>{var s;const[l,g]=u.useState(null),a=t=>{!t.variants||t.variants.length===0?(o(t),i()):g(t)},f=t=>{l&&o(l,t),d(),i()},d=()=>{g(null)},n=(t,j)=>{d(),m(t,j),i()},h=b.filter(t=>t.name.toLowerCase().includes("(horneado)")),N=b.filter(t=>!t.name.toLowerCase().includes("(horneado)")),v=l?`Variantes de: ${l.name}`:"Iniciar un Nuevo Proceso";return e.jsx(H,{isOpen:r,onClose:i,title:v,children:l?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>f("base"),className:"w-full p-4 bg-blue-100 text-blue-800 rounded-lg border border-blue-200 hover:bg-blue-200 hover:border-blue-300 transition-colors text-left",children:[e.jsx("p",{className:"font-bold",children:l.baseVariantName||"Receta EstÃ¡ndar"}),l.baseVariantDescription&&e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:l.baseVariantDescription})]}),(s=l.variants)==null?void 0:s.map(t=>e.jsxs("button",{onClick:()=>f(t.id),className:"w-full p-4 bg-gray-100 text-gray-800 rounded-lg border border-gray-200 hover:bg-gray-200 hover:border-gray-300 transition-colors text-left",children:[e.jsx("p",{className:"font-bold",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.description})]},t.id)),e.jsx("button",{onClick:d,className:"mt-4 text-sm text-gray-600 hover:underline font-semibold",children:"â† Volver a recetas"})]}):e.jsxs("div",{className:"flex flex-col gap-6 max-h-[70vh] overflow-y-auto pr-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-blue-700 mb-2 flex items-center gap-2 pb-1 border-b border-blue-100",children:[e.jsx("span",{children:"ðŸ¥£"})," ElaboraciÃ³n de Masas"]}),e.jsx("div",{className:"flex flex-col gap-3",children:N.length>0?N.map(t=>e.jsx("button",{onClick:()=>a(t),className:"w-full p-3 bg-white text-gray-800 font-bold rounded-lg border border-gray-200 hover:bg-blue-50 hover:border-blue-300 transition-colors text-left shadow-sm",children:t.name},t.id)):e.jsx("p",{className:"text-sm text-gray-400 italic px-2",children:"No hay recetas de masas configuradas."})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-orange-700 mb-2 flex items-center gap-2 pb-1 border-b border-orange-100",children:[e.jsx("span",{children:"ðŸ”¥"})," Horneado Final"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:h.length>0?h.map(t=>e.jsx("button",{onClick:()=>a(t),className:"w-full p-3 bg-orange-50 text-gray-800 font-bold rounded-lg border border-orange-200 hover:bg-orange-100 hover:border-orange-300 transition-colors text-left shadow-sm",children:t.name.replace(/\(Horneado\)/i,"").trim()},t.id)):e.jsx("p",{className:"text-sm text-gray-400 italic px-2",children:"No hay recetas de horneado configuradas."})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-600 mb-2 flex items-center gap-2 pb-1 border-b border-gray-200",children:[e.jsx("span",{children:"â±ï¸"})," Herramientas"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>n(15*60,"Precalentar (15 min)"),className:"w-full p-3 flex flex-col items-center justify-center gap-1 bg-gray-50 text-gray-700 font-bold rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors text-sm",children:[e.jsx(c,{name:"thermometer-snowflake",size:20}),e.jsx("span",{children:"Precalentar"})]}),e.jsxs("button",{onClick:()=>n(7*60,"Recalentar (7 min)"),className:"w-full p-3 flex flex-col items-center justify-center gap-1 bg-gray-50 text-gray-700 font-bold rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors text-sm",children:[e.jsx(c,{name:"thermometer-sun",size:20}),e.jsx("span",{children:"Recalentar"})]})]})]})]})})},B=r=>{(isNaN(r)||r<0)&&(r=0);const i=Math.floor(r/60),o=r%60;return`${String(i).padStart(2,"0")}:${String(o).padStart(2,"0")}`},le=({step:r,isCompleted:i,isCurrent:o})=>{let m="text-gray-500",b="border-gray-300 text-gray-300",l="";return o?(m="font-bold text-gray-900",r.type==="passive"?(b="border-teal-500 bg-teal-500 text-white animate-pulse",l="bg-teal-50/80 shadow-md -mx-2 px-3 py-3 rounded-lg border-l-4 border-teal-500 transition-all duration-300 my-1"):(b="border-blue-600 bg-blue-600 text-white animate-pulse",l="bg-blue-50/80 shadow-md -mx-2 px-3 py-3 rounded-lg border-l-4 border-blue-600 transition-all duration-300 my-1")):i?(m="text-gray-400 line-through decoration-gray-400",b="border-green-500 text-green-500 bg-green-50",l="py-1 opacity-75"):l="py-1",e.jsxs("div",{className:`flex items-center gap-3 transition-all duration-300 ${l}`,children:[e.jsx("div",{className:`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${b}`,children:i?e.jsx(c,{name:"check",size:12}):o?e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"}):null}),e.jsx("div",{className:"flex-grow",children:e.jsx("p",{className:`text-sm leading-tight ${m}`,children:r.instruction})}),o&&e.jsx("span",{className:`text-[10px] font-bold uppercase px-2 py-1 rounded-full flex-shrink-0 shadow-sm ${r.type==="passive"?"bg-white text-teal-700 border border-teal-200":"bg-white text-blue-700 border border-blue-200"}`,children:r.type==="passive"?"Espera":"Manual"})]})},Q=({process:r,onAdvance:i,onPrevious:o,onTogglePause:m,onCancel:b,onAcknowledgeFinish:l,onRecordProduction:g})=>{var R;const{state:a,name:f,steps:d,currentStepIndex:n,totalTimeLeft:h,stepTimeLeft:N}=r,[v,s]=u.useState(!1),[t,j]=u.useState(!1),w=d[n],p=(w==null?void 0:w.type)==="passive",P=a==="paused"||a==="intermission",I={card:"bg-teal-50 text-teal-900 border-teal-300",header:"bg-teal-100/60 border-b border-teal-200",textMain:"text-teal-800",textSub:"text-teal-600",timer:"text-teal-700",stepList:"bg-white/80 border-teal-200",controls:"border-t border-teal-200 pt-3"},M={card:"bg-white text-gray-800 border-blue-500",header:"bg-blue-50/60 border-b border-blue-100",textSub:"text-gray-500",timer:"text-blue-700",stepList:"bg-gray-50 border-gray-200",controls:"border-t border-gray-100 pt-3"},C={card:"bg-amber-50 text-amber-900 border-amber-400 shadow-md",header:"bg-amber-100 border-b border-amber-200",textMain:"text-amber-800",textSub:"text-amber-700 font-bold",timer:"text-amber-700",stepList:"bg-white/60 border-amber-200",controls:"border-t border-amber-200 pt-3"},z={card:"bg-red-50 text-red-900 border-red-500 animate-pulse-red",header:"bg-red-100 border-b border-red-200",textMain:"text-red-700",textSub:"text-red-600",timer:"text-red-600 animate-pulse",stepList:"bg-white border-red-200",controls:"border-t border-red-200 pt-3"},E={card:"bg-green-50 text-green-900 border-green-600",header:"bg-green-100 border-b border-green-200",textMain:"text-green-700",textSub:"text-green-600",timer:"text-green-700",stepList:"bg-white border-green-200",controls:"border-t border-green-200 pt-3"};let y=M;a==="finished"?y=E:a==="alarm"?y=z:P?y=C:p&&(y=I);const k=()=>{var A;if(a==="finished"){const D=((A=r.recipe)==null?void 0:A.ingredients)&&r.recipe.ingredients.length>0;return e.jsxs("div",{className:"flex flex-col gap-3",children:[g&&D&&e.jsxs("button",{onClick:()=>g(r),className:"w-full bg-emerald-600 text-white font-bold py-3 rounded-lg hover:bg-emerald-700 transition-colors shadow-sm flex items-center justify-center gap-2 text-sm",children:[e.jsx(c,{name:"check-circle",size:18}),"Registrar y Firmar Lote"]}),e.jsx("button",{onClick:()=>l(r),className:"w-full bg-gray-600 text-white font-bold py-3 rounded-lg hover:bg-gray-700 transition-colors shadow-sm uppercase tracking-wider text-sm",children:"Archivar"})]})}if(a==="alarm")return e.jsx(q,{onSwipe:()=>i(r.id),text:"Deslizar para apagar alarma",icon:"check-circle",className:"bg-red-100 border-red-300"});if(t)return e.jsxs("div",{className:"flex flex-col gap-2 bg-orange-50 p-3 rounded-lg border border-orange-200 animate-fadeIn",children:[e.jsx("p",{className:"text-xs font-bold text-orange-800 text-center",children:"Â¿Regresar? Se perderÃ¡ el progreso de este paso."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>j(!1),className:"flex-1 py-2 px-3 bg-white border border-gray-300 text-gray-700 font-bold rounded-lg text-xs hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:()=>{o(r.id),j(!1)},className:"flex-1 py-2 px-3 bg-orange-500 text-white font-bold rounded-lg text-xs hover:bg-orange-600 shadow-sm",children:"SÃ­, Regresar"})]})]});const $=n>0,S=a==="paused"||a==="intermission";return e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>j(!0),disabled:!$,className:`p-3 rounded-lg transition-colors flex-shrink-0 ${$?"bg-white border border-gray-200 hover:bg-gray-50 text-gray-700 shadow-sm":"bg-transparent border border-transparent text-gray-300 cursor-not-allowed"}`,title:"Paso Anterior",children:e.jsx(c,{name:"rotate-ccw",size:20})}),e.jsxs("button",{onClick:()=>m(r.id),className:`flex-grow flex items-center justify-center gap-2 font-bold rounded-lg transition-colors shadow-sm border text-sm md:text-base ${S?"bg-green-500 text-white border-green-600 hover:bg-green-600 animate-pulse":"bg-amber-100 text-amber-900 border-amber-300 hover:bg-amber-200"}`,children:[e.jsx(c,{name:S?"play-circle":"minus",size:20}),S?a==="intermission"?"INICIAR SIGUIENTE":"REANUDAR":"PAUSAR"]})]}),e.jsx("div",{className:"relative z-0",children:e.jsx(q,{onSwipe:()=>i(r.id),text:"Deslizar al completar",disabled:a==="intermission",className:P?"bg-amber-100 border-amber-300":p?"bg-teal-100 border-teal-300":"bg-gray-100 border-gray-300"})})]})};return v?e.jsxs("div",{className:"flex flex-col bg-white rounded-xl border-2 border-red-400 shadow-lg p-6 justify-center items-center text-center min-h-[320px]",children:[e.jsx("div",{className:"bg-red-100 p-4 rounded-full mb-4",children:e.jsx(c,{name:"alert-triangle",size:40,className:"text-red-600"})}),e.jsx("h4",{className:"font-bold text-xl mb-2 text-gray-800",children:"Â¿Cancelar Proceso?"}),e.jsxs("p",{className:"text-gray-600 mb-8",children:["Se perderÃ¡ el progreso actual de ",e.jsx("span",{className:"font-bold",children:f}),"."]}),e.jsxs("div",{className:"flex gap-4 w-full",children:[e.jsx("button",{onClick:()=>s(!1),className:"flex-1 py-3 px-4 bg-gray-100 text-gray-800 font-bold rounded-lg hover:bg-gray-200",children:"Volver"}),e.jsx("button",{onClick:()=>b(r.id),className:"flex-1 py-3 px-4 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 shadow-md",children:"SÃ­, Cancelar"})]})]}):e.jsxs("div",{className:`flex flex-col rounded-xl border-2 shadow-sm hover:shadow-md transition-all duration-300 overflow-hidden ${y.card}`,children:[e.jsxs("header",{className:`p-4 flex justify-between items-start ${y.header}`,children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-xl leading-tight flex items-center gap-2 text-gray-800",children:[p?e.jsx(c,{name:"thermometer",className:a==="running"?"animate-pulse text-teal-600":"text-teal-600"}):e.jsx(c,{name:"cake-slice",className:"text-blue-600"}),f]}),e.jsx("p",{className:`text-xs font-bold uppercase tracking-wider mt-1 ${y.textSub}`,children:a==="running"?p?"â€¢ Proceso AutomÃ¡tico":"â€¢ AcciÃ³n Requerida":a==="paused"?"â€¢ En Pausa - Requiere AtenciÃ³n":a==="intermission"?"â€¢ Listo para iniciar - Dale Play":a==="alarm"?"â€¢ Â¡TIEMPO TERMINADO!":"â€¢ Finalizado"})]}),p&&a==="running"&&e.jsx("div",{className:"flex flex-col items-end",children:e.jsx("span",{className:"bg-white border border-teal-300 text-teal-700 px-3 py-1 rounded-full text-xs font-bold shadow-sm animate-pulse",children:"LIBRE"})})]}),n===0&&((R=r.recipe)==null?void 0:R.setupInstruction)&&e.jsx("div",{className:"bg-yellow-100 border-b-2 border-yellow-300 p-3 mb-0",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(c,{name:"settings",className:"text-yellow-700 mt-1 flex-shrink-0",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-yellow-700 uppercase tracking-wider mb-0.5",children:"ConfiguraciÃ³n Inicial"}),e.jsx("p",{className:"text-sm font-medium text-yellow-900 leading-snug",children:r.recipe.setupInstruction})]})]})}),e.jsxs("div",{className:"p-4 flex-grow flex flex-col justify-between gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center relative",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest mb-1 block opacity-60",children:"Tiempo Restante"}),e.jsx("p",{className:`text-7xl font-bold tabular-nums tracking-tighter leading-none ${y.timer} transition-colors duration-500`,children:B(N)})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs font-semibold opacity-60",children:[e.jsx(c,{name:"rotate-ccw",size:12}),e.jsxs("span",{children:["Total lote: ",B(h)]})]})]}),e.jsx("div",{className:`rounded-lg border overflow-hidden flex flex-col max-h-48 ${y.stepList}`,children:e.jsx("div",{className:"overflow-y-auto p-2 space-y-1 custom-scrollbar",children:d.map(($,S)=>e.jsx(le,{step:$,isCompleted:S<n,isCurrent:S===n&&a!=="finished"},S))})}),e.jsxs("div",{className:`${y.controls}`,children:[k(),a!=="finished"&&a!=="alarm"&&e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{onClick:()=>s(!0),className:"text-xs text-gray-400 hover:text-red-500 font-semibold px-2 py-1 transition-colors",children:"Cancelar Todo"})})]})]})]})},ne=({rating:r,setRating:i})=>e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3,4,5].map(o=>e.jsx("button",{type:"button",onClick:()=>i(o),onMouseEnter:()=>{},onMouseLeave:()=>{},className:"transition-transform transform hover:scale-125",children:e.jsx(c,{name:"star",size:40,className:`cursor-pointer ${o<=r?"text-yellow-400 fill-current":"text-gray-300"}`})},o))}),oe=({isOpen:r,processName:i,onSave:o,onSkip:m})=>{const[b,l]=u.useState(3),[g,a]=u.useState(""),f=()=>{o(b,g)};return e.jsx(H,{isOpen:r,onClose:m,title:`Feedback para: ${i}`,children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"Â¿QuÃ© tal saliÃ³ el resultado?"}),e.jsx(ne,{rating:b,setRating:l})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedback-notes",className:"block text-sm font-medium text-gray-600 mb-1",children:"Notas (Opcional)"}),e.jsx("textarea",{id:"feedback-notes",value:g,onChange:d=>a(d.target.value),rows:4,placeholder:"Ej: El color fue perfecto, pero la prÃ³xima vez intentarÃ© con 1 minuto menos...",className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("button",{type:"button",onClick:m,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Omitir"}),e.jsx("button",{type:"button",onClick:f,className:"py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Guardar"})]})]})})},G=Z(te,"settings","bakery_dashboard"),ie=({inventoryHook:r,categoriesHook:i})=>{const{items:o}=r,{categories:m}=i,[b,l]=u.useState({categoryMapping:{}}),[g,a]=u.useState(!1);u.useEffect(()=>{const s=Y(G,t=>{t.exists()&&l(t.data())},t=>{console.error("Error fetching dashboard settings:",t)});return()=>s()},[]);const f=async s=>{const t={categoryMapping:s};l(t),a(!1);try{await ee(G,t)}catch(j){console.error("Error saving dashboard settings:",j)}},{rawItems:d,wipItems:n,finishedItems:h,totalValue:N}=u.useMemo(()=>{const s=[],t=[],j=[];let w=0;return o.forEach(p=>{var E,y,k,R;const P=p.category||"Sin CategorÃ­a",I=b.categoryMapping[P]||"none",M=(y=(E=p.purchaseHistory)==null?void 0:E[p.purchaseHistory.length-1])==null?void 0:y.totalPrice,C=(R=(k=p.purchaseHistory)==null?void 0:k[p.purchaseHistory.length-1])==null?void 0:R.quantity,z=M&&C?M/C:0;w+=z*p.currentStock,p.isBakeryCritical&&s.push(p),I==="wip"?t.push(p):I==="finished"&&j.push(p)}),{rawItems:s,wipItems:t,finishedItems:j,totalValue:w}},[o,b]),v=({item:s,theme:t})=>{const j=s.currentStock<=s.minStock,w={green:{bg:"bg-white",border:"border-emerald-100",text:"text-emerald-800",badge:"bg-emerald-100 text-emerald-800"},blue:{bg:"bg-white",border:"border-cyan-100",text:"text-cyan-800",badge:"bg-cyan-100 text-cyan-800"},orange:{bg:"bg-white",border:"border-orange-100",text:"text-orange-800",badge:"bg-orange-100 text-orange-800"}}[t];return e.jsxs("div",{className:`p-3 rounded-lg border shadow-sm flex justify-between items-center ${w.bg} ${w.border} ${j?"border-red-300 ring-1 ring-red-200":""}`,children:[e.jsxs("div",{className:"min-w-0 flex-1 pr-2",children:[e.jsx("p",{className:`font-bold text-sm truncate ${w.text}`,children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.category})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`font-bold text-lg ${j?"text-red-600":"text-gray-800"}`,children:parseFloat(s.currentStock.toFixed(2))}),e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:s.unit})]})]})};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"bg-white p-4 border-b border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-500 text-xs font-bold uppercase tracking-wider",children:"Valor Estimado Stock PanaderÃ­a"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["$",N.toFixed(2)]})]}),e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 text-sm text-blue-600 hover:bg-blue-50 px-3 py-2 rounded-lg transition-colors",children:[e.jsx(c,{name:"settings",size:16}),"Configurar Tablero"]})]}),e.jsx("div",{className:"flex-grow overflow-x-auto",children:e.jsxs("div",{className:"flex h-full min-w-[800px] p-4 gap-4",children:[e.jsxs("div",{className:"flex-1 flex flex-col bg-emerald-50/50 rounded-xl border border-emerald-100 overflow-hidden",children:[e.jsxs("div",{className:"p-3 bg-emerald-100/50 border-b border-emerald-200 flex items-center gap-2",children:[e.jsx(c,{name:"archive",className:"text-emerald-600",size:20}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"font-bold text-emerald-900",children:"1. Insumos CrÃ­ticos"}),e.jsx("p",{className:"text-[10px] text-emerald-700 leading-none",children:"Marcados manualmente en inventario"})]}),e.jsx("span",{className:"ml-auto bg-white text-emerald-700 text-xs font-bold px-2 py-0.5 rounded-full",children:d.length})]}),e.jsxs("div",{className:"p-3 overflow-y-auto flex-grow space-y-2",children:[d.map(s=>e.jsx(v,{item:s,theme:"green"},s.id)),d.length===0&&e.jsxs("div",{className:"text-center p-4",children:[e.jsx("p",{className:"text-sm text-emerald-500 italic",children:"Sin insumos marcados."}),e.jsx("p",{className:"text-xs text-emerald-400 mt-1",children:'Edita un producto en inventario y activa "CrÃ­tico de PanaderÃ­a" para verlo aquÃ­.'})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col bg-cyan-50/50 rounded-xl border border-cyan-100 overflow-hidden",children:[e.jsxs("div",{className:"p-3 bg-cyan-100/50 border-b border-cyan-200 flex items-center gap-2",children:[e.jsx(c,{name:"thermometer-snowflake",className:"text-cyan-600",size:20}),e.jsx("h3",{className:"font-bold text-cyan-900",children:"2. En Reserva (Congelados)"}),e.jsx("span",{className:"ml-auto bg-white text-cyan-700 text-xs font-bold px-2 py-0.5 rounded-full",children:n.length})]}),e.jsxs("div",{className:"p-3 overflow-y-auto flex-grow space-y-2",children:[n.map(s=>e.jsx(v,{item:s,theme:"blue"},s.id)),n.length===0&&e.jsx("p",{className:"text-center text-sm text-cyan-400 italic mt-4",children:"Sin categorÃ­as asignadas"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col bg-orange-50/50 rounded-xl border border-orange-100 overflow-hidden",children:[e.jsxs("div",{className:"p-3 bg-orange-100/50 border-b border-orange-200 flex items-center gap-2",children:[e.jsx(c,{name:"cake-slice",className:"text-orange-600",size:20}),e.jsx("h3",{className:"font-bold text-orange-900",children:"3. Vitrina (Horneados)"}),e.jsx("span",{className:"ml-auto bg-white text-orange-700 text-xs font-bold px-2 py-0.5 rounded-full",children:h.length})]}),e.jsxs("div",{className:"p-3 overflow-y-auto flex-grow space-y-2",children:[h.map(s=>e.jsx(v,{item:s,theme:"orange"},s.id)),h.length===0&&e.jsx("p",{className:"text-center text-sm text-orange-400 italic mt-4",children:"Sin categorÃ­as asignadas"})]})]})]})}),g&&e.jsx(de,{isOpen:g,onClose:()=>a(!1),categories:m,currentMapping:b.categoryMapping,onSave:f})]})},de=({isOpen:r,onClose:i,categories:o,currentMapping:m,onSave:b})=>{const[l,g]=u.useState(m),a=(d,n)=>{g(h=>({...h,[d]:n}))},f=()=>{b(l)};return e.jsxs(H,{isOpen:r,onClose:i,title:"Configurar Tablero de PanaderÃ­a",children:[e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded border border-blue-200 mb-4 text-sm text-blue-800",children:[e.jsx("p",{className:"font-bold",children:"â„¹ï¸ Nota sobre la Columna 1 (Insumos):"}),e.jsx("p",{children:'Esta columna ahora es automÃ¡tica. Muestra los productos que has marcado como "CrÃ­tico de PanaderÃ­a" en el Inventario, sin importar su categorÃ­a.'})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Asigna categorÃ­as de inventario a las columnas de proceso:"}),e.jsx("div",{className:"space-y-3",children:o.map(d=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded border border-gray-200",children:[e.jsx("span",{className:"font-bold text-gray-700 text-sm",children:d.name}),e.jsxs("select",{value:l[d.name]||"none",onChange:n=>a(d.name,n.target.value),className:"p-1.5 text-sm border border-gray-300 rounded bg-white",children:[e.jsx("option",{value:"none",children:"Ocultar / General"}),e.jsx("option",{value:"wip",children:"Col 2: Congelados/Masa"}),e.jsx("option",{value:"finished",children:"Col 3: Horneados"})]})]},d.id))})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg",children:"Cancelar"}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-blue-600 text-white font-bold rounded-lg",children:"Guardar ConfiguraciÃ³n"})]})]})},ce=({isOpen:r,onClose:i,process:o,users:m,onConfirm:b})=>{var v;const l=((v=o.recipe)==null?void 0:v.outputQuantity)||1,[g,a]=u.useState(String(l)),[f,d]=u.useState(""),[n,h]=u.useState("");u.useEffect(()=>{r&&(a(String(l)),d(m.length>0?m[0].name:""),h(""))},[r,l,m]);const N=s=>{s.preventDefault();const t=parseFloat(g);if(isNaN(t)||t<0){h("Por favor ingresa una cantidad vÃ¡lida.");return}if(!f){h("Debes seleccionar quiÃ©n realizÃ³ la producciÃ³n.");return}b(o,t,f)};return e.jsx(H,{isOpen:r,onClose:i,title:"Finalizar y Firmar ProducciÃ³n",children:e.jsxs("form",{onSubmit:N,className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-bold text-blue-900 text-lg",children:o.name}),e.jsx("p",{className:"text-blue-700 text-sm mt-1",children:"Registra el resultado final para el historial y el inventario."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Cantidad Producida Real"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:g,onChange:s=>a(s.target.value),className:"flex-1 p-3 border border-gray-300 rounded-lg text-lg font-bold text-center focus:ring-2 focus:ring-blue-500 focus:outline-none",step:"any"}),e.jsx("span",{className:"font-bold text-gray-500 bg-gray-100 px-3 py-3 rounded-lg border border-gray-200",children:"Unidades"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Si hubo merma durante el horneado, ingresa solo lo que saliÃ³ bien."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Responsable (Firma Digital)"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{name:"check-circle",className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),e.jsx("select",{value:f,onChange:s=>d(s.target.value),className:"w-full p-3 pl-10 border border-gray-300 rounded-lg bg-white font-medium focus:ring-2 focus:ring-blue-500 focus:outline-none appearance-none",children:m.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))})]})]}),n&&e.jsxs("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg text-sm font-medium flex items-center gap-2",children:[e.jsx(c,{name:"alert-triangle",size:16}),n]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:i,className:"flex-1 py-3 bg-gray-100 text-gray-700 font-bold rounded-lg hover:bg-gray-200 transition-colors",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"flex-1 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-colors shadow-md flex justify-center items-center gap-2",children:[e.jsx(c,{name:"archive",size:20}),"Registrar"]})]})]})})},ue=({productionHook:r,recipeLogHook:i,recipesHook:o,inventoryHook:m,categoriesHook:b})=>{const{users:l}=se(),[g,a]=u.useState("processes"),[f,d]=u.useState(!1),[n,h]=u.useState(null),[N,v]=u.useState(null),[s,t]=u.useState(!1),{processes:j,startBakingProcess:w,startHeatingProcess:p,advanceProcess:P,goToPreviousStep:I,togglePauseProcess:M,cancelProcess:C,isSoundMuted:z,toggleSoundMute:E,isAudioReady:y,isSuspended:k,unlockAudio:R}=r,{addFeedback:$}=i,{recipes:S}=o,{produceBatch:A,stockLogs:D}=m,U=x=>{x.type==="baking"&&x.recipeId?h(x):C(x.id)},_=x=>{v(x)},J=(x,L,X)=>{const F=S.find(T=>T.id===x.recipeId)||x.recipe;if(F){let T=1;F.outputQuantity&&F.outputQuantity>0&&(T=L/F.outputQuantity),A(F,T,L,X),v(null)}else alert("Error: No se encontrÃ³ la receta vinculada.")},K=(x,L)=>{n&&n.recipeId&&($({recipeId:n.recipeId,rating:x,notes:L}),C(n.id)),h(null)},W=()=>{n&&C(n.id),h(null)},V=j.filter(x=>x.state!=="finished"),O=j.filter(x=>x.state==="finished");return s?e.jsx(re,{logs:D,onClose:()=>t(!1)}):e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 flex justify-between items-center px-4 py-2 flex-shrink-0",children:[e.jsxs("div",{className:"flex gap-4 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>a("processes"),className:`flex items-center gap-2 py-2 px-3 text-sm font-bold border-b-2 transition-colors whitespace-nowrap ${g==="processes"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-800"}`,children:[e.jsx(c,{name:"play-circle",size:18}),"ProducciÃ³n"]}),e.jsxs("button",{onClick:()=>a("dashboard"),className:`flex items-center gap-2 py-2 px-3 text-sm font-bold border-b-2 transition-colors whitespace-nowrap ${g==="dashboard"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-800"}`,children:[e.jsx(c,{name:"bar-chart-2",size:18}),"Stock y Resumen"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>t(!0),className:"p-2 text-gray-500 hover:bg-gray-100 rounded-full transition-colors",title:"Ver Historial",children:e.jsx(c,{name:"list",size:20})}),g==="processes"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:k?R:E,title:k?"Sonidos bloqueados. Clic para activar.":z?"Activar Sonidos":"Silenciar Sonidos",className:`p-2 rounded-full transition-colors ${k?"text-yellow-600 animate-pulse":"text-gray-500 hover:text-blue-600 hover:bg-gray-100"}`,children:e.jsx(c,{name:z||k?"volume-x":"volume-2",size:20})}),e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-1.5 px-3 rounded-lg hover:bg-blue-700 transition-colors text-sm whitespace-nowrap",children:[e.jsx(c,{name:"plus-circle",size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Iniciar"})]})]})]})]}),e.jsx("div",{className:"flex-grow overflow-hidden",children:g==="dashboard"?e.jsx(ie,{inventoryHook:m,categoriesHook:b}):e.jsxs("div",{className:"h-full overflow-y-auto p-4 md:p-6",children:[V.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:V.map(x=>e.jsx(Q,{process:x,onAdvance:P,onPrevious:I,onTogglePause:M,onCancel:C,onAcknowledgeFinish:()=>{},isAudioReady:y},x.id))}):e.jsxs("div",{className:"text-center py-16 text-gray-500",children:[e.jsx("p",{children:"No hay procesos activos."}),e.jsx("p",{className:"text-sm mt-2",children:'Ve a la pestaÃ±a "Stock y Resumen" para ver quÃ© hace falta.'})]}),O.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-600 mb-3",children:"Finalizados Recientemente"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:O.map(x=>e.jsx(Q,{process:x,onAdvance:P,onPrevious:I,onTogglePause:()=>{},onCancel:C,onAcknowledgeFinish:()=>U(x),isAudioReady:y,onRecordProduction:()=>_(x)},x.id))})]})]})}),e.jsx(ae,{isOpen:f,onClose:()=>d(!1),onSelectRecipe:w,onSelectHeating:p,recipes:S}),n&&e.jsx(oe,{isOpen:!!n,processName:n.name,onSave:K,onSkip:W}),N&&e.jsx(ce,{isOpen:!!N,onClose:()=>v(null),process:N,users:l,onConfirm:J})]})};export{ue as default};
