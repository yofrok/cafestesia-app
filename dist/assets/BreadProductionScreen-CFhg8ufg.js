import{r as N,j as e,I as x}from"./index-C_lUkxof.js";import{M as E}from"./Modal-D8cQ-NDr.js";import{S as M}from"./SwipeButton-CFJfpimN.js";const T=({isOpen:a,onClose:n,onSelectRecipe:o,onSelectHeating:b,recipes:i})=>{var y;const[r,s]=N.useState(null),m=t=>{!t.variants||t.variants.length===0?(o(t),n()):s(t)},u=t=>{r&&o(r,t),d(),n()},d=()=>{s(null)},f=(t,p)=>{d(),b(t,p),n()},j=i.filter(t=>t.name.toLowerCase().includes("(horneado)")),w=i.filter(t=>!t.name.toLowerCase().includes("(horneado)")),g=r?`Variantes de: ${r.name}`:"Iniciar un Nuevo Proceso";return e.jsx(E,{isOpen:a,onClose:n,title:g,children:r?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>u("base"),className:"w-full p-4 bg-blue-100 text-blue-800 rounded-lg border border-blue-200 hover:bg-blue-200 hover:border-blue-300 transition-colors text-left",children:[e.jsx("p",{className:"font-bold",children:r.baseVariantName||"Receta EstÃ¡ndar"}),r.baseVariantDescription&&e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:r.baseVariantDescription})]}),(y=r.variants)==null?void 0:y.map(t=>e.jsxs("button",{onClick:()=>u(t.id),className:"w-full p-4 bg-gray-100 text-gray-800 rounded-lg border border-gray-200 hover:bg-gray-200 hover:border-gray-300 transition-colors text-left",children:[e.jsx("p",{className:"font-bold",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.description})]},t.id)),e.jsx("button",{onClick:d,className:"mt-4 text-sm text-gray-600 hover:underline font-semibold",children:"â† Volver a recetas"})]}):e.jsxs("div",{className:"flex flex-col gap-6 max-h-[70vh] overflow-y-auto pr-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-blue-700 mb-2 flex items-center gap-2 pb-1 border-b border-blue-100",children:[e.jsx("span",{children:"ðŸ¥£"})," ElaboraciÃ³n de Masas"]}),e.jsx("div",{className:"flex flex-col gap-3",children:w.length>0?w.map(t=>e.jsx("button",{onClick:()=>m(t),className:"w-full p-3 bg-white text-gray-800 font-bold rounded-lg border border-gray-200 hover:bg-blue-50 hover:border-blue-300 transition-colors text-left shadow-sm",children:t.name},t.id)):e.jsx("p",{className:"text-sm text-gray-400 italic px-2",children:"No hay recetas de masas configuradas."})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-orange-700 mb-2 flex items-center gap-2 pb-1 border-b border-orange-100",children:[e.jsx("span",{children:"ðŸ”¥"})," Horneado Final"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:j.length>0?j.map(t=>e.jsx("button",{onClick:()=>m(t),className:"w-full p-3 bg-orange-50 text-gray-800 font-bold rounded-lg border border-orange-200 hover:bg-orange-100 hover:border-orange-300 transition-colors text-left shadow-sm",children:t.name.replace(/\(Horneado\)/i,"").trim()},t.id)):e.jsx("p",{className:"text-sm text-gray-400 italic px-2",children:"No hay recetas de horneado configuradas."})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-600 mb-2 flex items-center gap-2 pb-1 border-b border-gray-200",children:[e.jsx("span",{children:"â±ï¸"})," Herramientas"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>f(15*60,"Precalentar (15 min)"),className:"w-full p-3 flex flex-col items-center justify-center gap-1 bg-gray-50 text-gray-700 font-bold rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors text-sm",children:[e.jsx(x,{name:"thermometer-snowflake",size:20}),e.jsx("span",{children:"Precalentar"})]}),e.jsxs("button",{onClick:()=>f(7*60,"Recalentar (7 min)"),className:"w-full p-3 flex flex-col items-center justify-center gap-1 bg-gray-50 text-gray-700 font-bold rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors text-sm",children:[e.jsx(x,{name:"thermometer-sun",size:20}),e.jsx("span",{children:"Recalentar"})]})]})]})]})})},$=a=>{(isNaN(a)||a<0)&&(a=0);const n=Math.floor(a/60),o=a%60;return`${String(n).padStart(2,"0")}:${String(o).padStart(2,"0")}`},L=({step:a,isCompleted:n,isCurrent:o})=>{let b="text-gray-500",i="border-gray-300 text-gray-300",r="";return o?(b="font-bold text-gray-900",a.type==="passive"?(i="border-teal-500 bg-teal-500 text-white animate-pulse",r="bg-teal-50/80 shadow-md -mx-2 px-3 py-3 rounded-lg border-l-4 border-teal-500 transition-all duration-300 my-1"):(i="border-blue-600 bg-blue-600 text-white animate-pulse",r="bg-blue-50/80 shadow-md -mx-2 px-3 py-3 rounded-lg border-l-4 border-blue-600 transition-all duration-300 my-1")):n?(b="text-gray-400 line-through decoration-gray-400",i="border-green-500 text-green-500 bg-green-50",r="py-1 opacity-75"):r="py-1",e.jsxs("div",{className:`flex items-center gap-3 transition-all duration-300 ${r}`,children:[e.jsx("div",{className:`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${i}`,children:n?e.jsx(x,{name:"check",size:12}):o?e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"}):null}),e.jsx("div",{className:"flex-grow",children:e.jsx("p",{className:`text-sm leading-tight ${b}`,children:a.instruction})}),o&&e.jsx("span",{className:`text-[10px] font-bold uppercase px-2 py-1 rounded-full flex-shrink-0 shadow-sm ${a.type==="passive"?"bg-white text-teal-700 border border-teal-200":"bg-white text-blue-700 border border-blue-200"}`,children:a.type==="passive"?"Espera":"Manual"})]})},F=({process:a,onAdvance:n,onPrevious:o,onTogglePause:b,onCancel:i,onAcknowledgeFinish:r})=>{var l;const{state:s,name:m,steps:u,currentStepIndex:d,totalTimeLeft:f,stepTimeLeft:j}=a,[w,g]=N.useState(!1),[y,t]=N.useState(!1),p=u[d],h=(p==null?void 0:p.type)==="passive",S=s==="paused"||s==="intermission",P={card:"bg-teal-50 text-teal-900 border-teal-300",header:"bg-teal-100/60 border-b border-teal-200",textMain:"text-teal-800",textSub:"text-teal-600",timer:"text-teal-700",stepList:"bg-white/80 border-teal-200",controls:"border-t border-teal-200 pt-3"},I={card:"bg-white text-gray-800 border-blue-500",header:"bg-blue-50/60 border-b border-blue-100",textSub:"text-gray-500",timer:"text-blue-700",stepList:"bg-gray-50 border-gray-200",controls:"border-t border-gray-100 pt-3"},R={card:"bg-amber-50 text-amber-900 border-amber-400 shadow-md",header:"bg-amber-100 border-b border-amber-200",textMain:"text-amber-800",textSub:"text-amber-700 font-bold",timer:"text-amber-700",stepList:"bg-white/60 border-amber-200",controls:"border-t border-amber-200 pt-3"},z={card:"bg-red-50 text-red-900 border-red-500 animate-pulse-red",header:"bg-red-100 border-b border-red-200",textMain:"text-red-700",textSub:"text-red-600",timer:"text-red-600 animate-pulse",stepList:"bg-white border-red-200",controls:"border-t border-red-200 pt-3"},A={card:"bg-green-50 text-green-900 border-green-600",header:"bg-green-100 border-b border-green-200",textMain:"text-green-700",textSub:"text-green-600",timer:"text-green-700",stepList:"bg-white border-green-200",controls:"border-t border-green-200 pt-3"};let c=I;s==="finished"?c=A:s==="alarm"?c=z:S?c=R:h&&(c=P);const C=()=>{if(s==="finished")return e.jsx("button",{onClick:()=>r(a),className:"w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition-colors shadow-sm uppercase tracking-wider",children:"Terminar y Archivar"});if(s==="alarm")return e.jsx(M,{onSwipe:()=>n(a.id),text:"Deslizar para apagar alarma",icon:"check-circle",className:"bg-red-100 border-red-300"});if(y)return e.jsxs("div",{className:"flex flex-col gap-2 bg-orange-50 p-3 rounded-lg border border-orange-200 animate-fadeIn",children:[e.jsx("p",{className:"text-xs font-bold text-orange-800 text-center",children:"Â¿Regresar? Se perderÃ¡ el progreso de este paso."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>t(!1),className:"flex-1 py-2 px-3 bg-white border border-gray-300 text-gray-700 font-bold rounded-lg text-xs hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:()=>{o(a.id),t(!1)},className:"flex-1 py-2 px-3 bg-orange-500 text-white font-bold rounded-lg text-xs hover:bg-orange-600 shadow-sm",children:"SÃ­, Regresar"})]})]});const k=d>0,v=s==="paused"||s==="intermission";return e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>t(!0),disabled:!k,className:`p-3 rounded-lg transition-colors flex-shrink-0 ${k?"bg-white border border-gray-200 hover:bg-gray-50 text-gray-700 shadow-sm":"bg-transparent border border-transparent text-gray-300 cursor-not-allowed"}`,title:"Paso Anterior",children:e.jsx(x,{name:"rotate-ccw",size:20})}),e.jsxs("button",{onClick:()=>b(a.id),className:`flex-grow flex items-center justify-center gap-2 font-bold rounded-lg transition-colors shadow-sm border text-sm md:text-base ${v?"bg-green-500 text-white border-green-600 hover:bg-green-600 animate-pulse":"bg-amber-100 text-amber-900 border-amber-300 hover:bg-amber-200"}`,children:[e.jsx(x,{name:v?"play-circle":"minus",size:20}),v?s==="intermission"?"INICIAR SIGUIENTE":"REANUDAR":"PAUSAR"]})]}),e.jsx("div",{className:"relative z-0",children:e.jsx(M,{onSwipe:()=>n(a.id),text:"Deslizar al completar",disabled:s==="intermission",className:S?"bg-amber-100 border-amber-300":h?"bg-teal-100 border-teal-300":"bg-gray-100 border-gray-300"})})]})};return w?e.jsxs("div",{className:"flex flex-col bg-white rounded-xl border-2 border-red-400 shadow-lg p-6 justify-center items-center text-center min-h-[320px]",children:[e.jsx("div",{className:"bg-red-100 p-4 rounded-full mb-4",children:e.jsx(x,{name:"alert-triangle",size:40,className:"text-red-600"})}),e.jsx("h4",{className:"font-bold text-xl mb-2 text-gray-800",children:"Â¿Cancelar Proceso?"}),e.jsxs("p",{className:"text-gray-600 mb-8",children:["Se perderÃ¡ el progreso actual de ",e.jsx("span",{className:"font-bold",children:m}),"."]}),e.jsxs("div",{className:"flex gap-4 w-full",children:[e.jsx("button",{onClick:()=>g(!1),className:"flex-1 py-3 px-4 bg-gray-100 text-gray-800 font-bold rounded-lg hover:bg-gray-200",children:"Volver"}),e.jsx("button",{onClick:()=>i(a.id),className:"flex-1 py-3 px-4 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 shadow-md",children:"SÃ­, Cancelar"})]})]}):e.jsxs("div",{className:`flex flex-col rounded-xl border-2 shadow-sm hover:shadow-md transition-all duration-300 overflow-hidden ${c.card}`,children:[e.jsxs("header",{className:`p-4 flex justify-between items-start ${c.header}`,children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-xl leading-tight flex items-center gap-2 text-gray-800",children:[h?e.jsx(x,{name:"thermometer",className:s==="running"?"animate-pulse text-teal-600":"text-teal-600"}):e.jsx(x,{name:"cake-slice",className:"text-blue-600"}),m]}),e.jsx("p",{className:`text-xs font-bold uppercase tracking-wider mt-1 ${c.textSub}`,children:s==="running"?h?"â€¢ Proceso AutomÃ¡tico":"â€¢ AcciÃ³n Requerida":s==="paused"?"â€¢ En Pausa - Requiere AtenciÃ³n":s==="intermission"?"â€¢ Listo para iniciar - Dale Play":s==="alarm"?"â€¢ Â¡TIEMPO TERMINADO!":"â€¢ Finalizado"})]}),h&&s==="running"&&e.jsx("div",{className:"flex flex-col items-end",children:e.jsx("span",{className:"bg-white border border-teal-300 text-teal-700 px-3 py-1 rounded-full text-xs font-bold shadow-sm animate-pulse",children:"LIBRE"})})]}),d===0&&((l=a.recipe)==null?void 0:l.setupInstruction)&&e.jsx("div",{className:"bg-yellow-100 border-b-2 border-yellow-300 p-3 mb-0",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(x,{name:"settings",className:"text-yellow-700 mt-1 flex-shrink-0",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-yellow-700 uppercase tracking-wider mb-0.5",children:"ConfiguraciÃ³n Inicial"}),e.jsx("p",{className:"text-sm font-medium text-yellow-900 leading-snug",children:a.recipe.setupInstruction})]})]})}),e.jsxs("div",{className:"p-4 flex-grow flex flex-col justify-between gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center relative",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest mb-1 block opacity-60",children:"Tiempo Restante"}),e.jsx("p",{className:`text-7xl font-bold tabular-nums tracking-tighter leading-none ${c.timer} transition-colors duration-500`,children:$(j)})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs font-semibold opacity-60",children:[e.jsx(x,{name:"rotate-ccw",size:12}),e.jsxs("span",{children:["Total lote: ",$(f)]})]})]}),e.jsx("div",{className:`rounded-lg border overflow-hidden flex flex-col max-h-48 ${c.stepList}`,children:e.jsx("div",{className:"overflow-y-auto p-2 space-y-1 custom-scrollbar",children:u.map((k,v)=>e.jsx(L,{step:k,isCompleted:v<d,isCurrent:v===d&&s!=="finished"},v))})}),e.jsxs("div",{className:`${c.controls}`,children:[C(),s!=="finished"&&s!=="alarm"&&e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{onClick:()=>g(!0),className:"text-xs text-gray-400 hover:text-red-500 font-semibold px-2 py-1 transition-colors",children:"Cancelar Todo"})})]})]})]})},H=({rating:a,setRating:n})=>e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3,4,5].map(o=>e.jsx("button",{type:"button",onClick:()=>n(o),onMouseEnter:()=>{},onMouseLeave:()=>{},className:"transition-transform transform hover:scale-125",children:e.jsx(x,{name:"star",size:40,className:`cursor-pointer ${o<=a?"text-yellow-400 fill-current":"text-gray-300"}`})},o))}),O=({isOpen:a,processName:n,onSave:o,onSkip:b})=>{const[i,r]=N.useState(3),[s,m]=N.useState(""),u=()=>{o(i,s)};return e.jsx(E,{isOpen:a,onClose:b,title:`Feedback para: ${n}`,children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"Â¿QuÃ© tal saliÃ³ el resultado?"}),e.jsx(H,{rating:i,setRating:r})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedback-notes",className:"block text-sm font-medium text-gray-600 mb-1",children:"Notas (Opcional)"}),e.jsx("textarea",{id:"feedback-notes",value:s,onChange:d=>m(d.target.value),rows:4,placeholder:"Ej: El color fue perfecto, pero la prÃ³xima vez intentarÃ© con 1 minuto menos...",className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Omitir"}),e.jsx("button",{type:"button",onClick:u,className:"py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Guardar"})]})]})})},q=({productionHook:a,recipeLogHook:n,recipesHook:o})=>{const[b,i]=N.useState(!1),[r,s]=N.useState(null),{processes:m,startBakingProcess:u,startHeatingProcess:d,advanceProcess:f,goToPreviousStep:j,togglePauseProcess:w,cancelProcess:g,isSoundMuted:y,toggleSoundMute:t,isAudioReady:p,isSuspended:h,unlockAudio:S}=a,{addFeedback:P}=n,{recipes:I}=o,R=l=>{l.type==="baking"&&l.recipeId?s(l):g(l.id)},z=(l,k)=>{r&&r.recipeId&&(P({recipeId:r.recipeId,rating:l,notes:k}),g(r.id)),s(null)},A=()=>{r&&g(r.id),s(null)},c=m.filter(l=>l.state!=="finished"),C=m.filter(l=>l.state==="finished");return e.jsxs("div",{className:"p-4 md:p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-xl font-bold text-blue-700",children:"Procesos Activos"}),e.jsx("button",{onClick:h?S:t,title:h?"Sonidos bloqueados por el navegador. Haz clic para activar.":y?"Activar Sonidos":"Silenciar Sonidos",className:`p-2 rounded-full transition-colors ${h?"text-yellow-600 animate-pulse":"text-gray-500 hover:text-blue-600 hover:bg-gray-100"}`,children:e.jsx(x,{name:y||h?"volume-x":"volume-2",size:20})})]}),e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(x,{name:"plus-circle",size:16}),"Iniciar Proceso"]})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto",children:[c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(l=>e.jsx(F,{process:l,onAdvance:f,onPrevious:j,onTogglePause:w,onCancel:g,onAcknowledgeFinish:()=>{},isAudioReady:p},l.id))}):e.jsxs("div",{className:"text-center py-16 text-gray-500",children:[e.jsx("p",{children:"No hay procesos activos en este momento."}),e.jsx("p",{children:'Haz clic en "Iniciar Proceso" para comenzar.'})]}),C.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-600",children:"Finalizados Recientemente"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:C.map(l=>e.jsx(F,{process:l,onAdvance:f,onPrevious:j,onTogglePause:()=>{},onCancel:g,onAcknowledgeFinish:()=>R(l),isAudioReady:p},l.id))})]})]}),e.jsx(T,{isOpen:b,onClose:()=>i(!1),onSelectRecipe:u,onSelectHeating:d,recipes:I}),r&&e.jsx(O,{isOpen:!!r,processName:r.name,onSave:z,onSkip:A})]})};export{q as default};
