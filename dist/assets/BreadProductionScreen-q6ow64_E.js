import{r as f,j as e,I as x,o as Y,d as Z,s as ee,a as te,u as se}from"./index-Ba-L6XfD.js";import{M as V}from"./Modal-CT2Q9ouJ.js";import{S as q,P as re}from"./ProductionCompletionModal-DXRlwsbk.js";import{S as ae}from"./StockHistoryLog-C3jeP-Lp.js";const le=({isOpen:s,onClose:o,onSelectRecipe:i,onSelectHeating:b,recipes:m})=>{var a;const[l,g]=f.useState(null),r=t=>{!t.variants||t.variants.length===0?(i(t),o()):g(t)},y=t=>{l&&i(l,t),c(),o()},c=()=>{g(null)},n=(t,u)=>{c(),b(t,u),o()},j=m.filter(t=>t.name.toLowerCase().includes("(horneado)")),N=m.filter(t=>!t.name.toLowerCase().includes("(horneado)")),w=l?`Variantes de: ${l.name}`:"Iniciar un Nuevo Proceso";return e.jsx(V,{isOpen:s,onClose:o,title:w,children:l?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>y("base"),className:"w-full p-4 bg-blue-100 text-blue-800 rounded-lg border border-blue-200 hover:bg-blue-200 hover:border-blue-300 transition-colors text-left",children:[e.jsx("p",{className:"font-bold",children:l.baseVariantName||"Receta EstÃ¡ndar"}),l.baseVariantDescription&&e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:l.baseVariantDescription})]}),(a=l.variants)==null?void 0:a.map(t=>e.jsxs("button",{onClick:()=>y(t.id),className:"w-full p-4 bg-gray-100 text-gray-800 rounded-lg border border-gray-200 hover:bg-gray-200 hover:border-gray-300 transition-colors text-left",children:[e.jsx("p",{className:"font-bold",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.description})]},t.id)),e.jsx("button",{onClick:c,className:"mt-4 text-sm text-gray-600 hover:underline font-semibold",children:"â† Volver a recetas"})]}):e.jsxs("div",{className:"flex flex-col gap-6 max-h-[70vh] overflow-y-auto pr-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-blue-700 mb-2 flex items-center gap-2 pb-1 border-b border-blue-100",children:[e.jsx("span",{children:"ðŸ¥£"})," ElaboraciÃ³n de Masas"]}),e.jsx("div",{className:"flex flex-col gap-3",children:N.length>0?N.map(t=>e.jsx("button",{onClick:()=>r(t),className:"w-full p-3 bg-white text-gray-800 font-bold rounded-lg border border-gray-200 hover:bg-blue-50 hover:border-blue-300 transition-colors text-left shadow-sm",children:t.name},t.id)):e.jsx("p",{className:"text-sm text-gray-400 italic px-2",children:"No hay recetas de masas configuradas."})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-orange-700 mb-2 flex items-center gap-2 pb-1 border-b border-orange-100",children:[e.jsx("span",{children:"ðŸ”¥"})," Horneado Final"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:j.length>0?j.map(t=>e.jsx("button",{onClick:()=>r(t),className:"w-full p-3 bg-orange-50 text-gray-800 font-bold rounded-lg border border-orange-200 hover:bg-orange-100 hover:border-orange-300 transition-colors text-left shadow-sm",children:t.name.replace(/\(Horneado\)/i,"").trim()},t.id)):e.jsx("p",{className:"text-sm text-gray-400 italic px-2",children:"No hay recetas de horneado configuradas."})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-600 mb-2 flex items-center gap-2 pb-1 border-b border-gray-200",children:[e.jsx("span",{children:"â±ï¸"})," Herramientas"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>n(15*60,"Precalentar (15 min)"),className:"w-full p-3 flex flex-col items-center justify-center gap-1 bg-gray-50 text-gray-700 font-bold rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors text-sm",children:[e.jsx(x,{name:"thermometer-snowflake",size:20}),e.jsx("span",{children:"Precalentar"})]}),e.jsxs("button",{onClick:()=>n(7*60,"Recalentar (7 min)"),className:"w-full p-3 flex flex-col items-center justify-center gap-1 bg-gray-50 text-gray-700 font-bold rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors text-sm",children:[e.jsx(x,{name:"thermometer-sun",size:20}),e.jsx("span",{children:"Recalentar"})]})]})]})]})})},G=s=>{(isNaN(s)||s<0)&&(s=0);const o=Math.floor(s/3600),i=Math.floor(s%3600/60),b=Math.floor(s%60);return o>0?`${o}h ${String(i).padStart(2,"0")}m`:`${String(i).padStart(2,"0")}:${String(b).padStart(2,"0")}`},ne=({step:s,isCompleted:o,isCurrent:i})=>{let b="text-gray-500",m="border-gray-300 text-gray-300",l="";return i?(b="font-bold text-gray-900",s.type==="passive"?(m="border-teal-500 bg-teal-500 text-white animate-pulse",l="bg-teal-50/80 shadow-md -mx-2 px-3 py-3 rounded-lg border-l-4 border-teal-500 transition-all duration-300 my-1"):(m="border-blue-600 bg-blue-600 text-white animate-pulse",l="bg-blue-50/80 shadow-md -mx-2 px-3 py-3 rounded-lg border-l-4 border-blue-600 transition-all duration-300 my-1")):o?(b="text-gray-400 line-through decoration-gray-400",m="border-green-500 text-green-500 bg-green-50",l="py-1 opacity-75"):l="py-1",e.jsxs("div",{className:`flex items-center gap-3 transition-all duration-300 ${l}`,children:[e.jsx("div",{className:`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${m}`,children:o?e.jsx(x,{name:"check",size:12}):i?e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"}):null}),e.jsx("div",{className:"flex-grow",children:e.jsx("p",{className:`text-sm leading-tight ${b}`,children:s.instruction})}),i&&e.jsx("span",{className:`text-[10px] font-bold uppercase px-2 py-1 rounded-full flex-shrink-0 shadow-sm ${s.type==="passive"?"bg-white text-teal-700 border border-teal-200":"bg-white text-blue-700 border border-blue-200"}`,children:s.type==="passive"?"Espera":"Manual"})]})},Q=({process:s,onAdvance:o,onPrevious:i,onTogglePause:b,onCancel:m,onAcknowledgeFinish:l,onRecordProduction:g})=>{var M;const{state:r,name:y,steps:c,currentStepIndex:n,totalTimeLeft:j,stepTimeLeft:N}=s,[w,a]=f.useState(!1),[t,u]=f.useState(!1),v=c[n],h=(v==null?void 0:v.type)==="passive",P=r==="paused"||r==="intermission",I={card:"bg-teal-50 text-teal-900 border-teal-300",header:"bg-teal-100/60 border-b border-teal-200",textMain:"text-teal-800",textSub:"text-teal-600",timer:"text-teal-700",stepList:"bg-white/80 border-teal-200",controls:"border-t border-teal-200 pt-3"},R={card:"bg-white text-gray-800 border-blue-500",header:"bg-blue-50/60 border-b border-blue-100",textSub:"text-gray-500",timer:"text-blue-700",stepList:"bg-gray-50 border-gray-200",controls:"border-t border-gray-100 pt-3"},C={card:"bg-amber-50 text-amber-900 border-amber-400 shadow-md",header:"bg-amber-100 border-b border-amber-200",textMain:"text-amber-800",textSub:"text-amber-700 font-bold",timer:"text-amber-700",stepList:"bg-white/60 border-amber-200",controls:"border-t border-amber-200 pt-3"},$={card:"bg-red-50 text-red-900 border-red-500 animate-pulse-red",header:"bg-red-100 border-b border-red-200",textMain:"text-red-700",textSub:"text-red-600",timer:"text-red-600 animate-pulse",stepList:"bg-white border-red-200",controls:"border-t border-red-200 pt-3"},z={card:"bg-green-50 text-green-900 border-green-600",header:"bg-green-100 border-b border-green-200",textMain:"text-green-700",textSub:"text-green-600",timer:"text-green-700",stepList:"bg-white border-green-200",controls:"border-t border-green-200 pt-3"};let p=R;r==="finished"?p=z:r==="alarm"?p=$:P?p=C:h&&(p=I);const S=()=>{var L;if(r==="finished"){const H=((L=s.recipe)==null?void 0:L.ingredients)&&s.recipe.ingredients.length>0;return e.jsxs("div",{className:"flex flex-col gap-3",children:[g&&H&&e.jsxs("button",{onClick:()=>g(s),className:"w-full bg-emerald-600 text-white font-bold py-3 rounded-lg hover:bg-emerald-700 transition-colors shadow-sm flex items-center justify-center gap-2 text-sm",children:[e.jsx(x,{name:"check-circle",size:18}),"Registrar y Firmar Lote"]}),e.jsx("button",{onClick:()=>l(s),className:"w-full bg-gray-600 text-white font-bold py-3 rounded-lg hover:bg-gray-700 transition-colors shadow-sm uppercase tracking-wider text-sm",children:"Archivar"})]})}if(r==="alarm")return e.jsx(q,{onSwipe:()=>o(s.id),text:"Deslizar para apagar alarma",icon:"check-circle",className:"bg-red-100 border-red-300"});if(t)return e.jsxs("div",{className:"flex flex-col gap-2 bg-orange-50 p-3 rounded-lg border border-orange-200 animate-fadeIn",children:[e.jsx("p",{className:"text-xs font-bold text-orange-800 text-center",children:"Â¿Regresar? Se perderÃ¡ el progreso de este paso."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u(!1),className:"flex-1 py-2 px-3 bg-white border border-gray-300 text-gray-700 font-bold rounded-lg text-xs hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:()=>{i(s.id),u(!1)},className:"flex-1 py-2 px-3 bg-orange-500 text-white font-bold rounded-lg text-xs hover:bg-orange-600 shadow-sm",children:"SÃ­, Regresar"})]})]});const E=n>0,k=r==="paused"||r==="intermission";let A="PAUSAR";return k&&(r==="intermission"?A="INICIAR SIGUIENTE":n===0&&N===v.duration?A="INICIAR PROCESO":A="REANUDAR"),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>u(!0),disabled:!E,className:`p-3 rounded-lg transition-colors flex-shrink-0 ${E?"bg-white border border-gray-200 hover:bg-gray-50 text-gray-700 shadow-sm":"bg-transparent border border-transparent text-gray-300 cursor-not-allowed"}`,title:"Paso Anterior",children:e.jsx(x,{name:"rotate-ccw",size:20})}),e.jsxs("button",{onClick:()=>b(s.id),className:`flex-grow flex items-center justify-center gap-2 font-bold rounded-lg transition-colors shadow-sm border text-sm md:text-base ${k?"bg-green-500 text-white border-green-600 hover:bg-green-600 animate-pulse":"bg-amber-100 text-amber-900 border-amber-300 hover:bg-amber-200"}`,children:[e.jsx(x,{name:k?"play-circle":"minus",size:20}),A]})]}),e.jsx("div",{className:"relative z-0",children:e.jsx(q,{onSwipe:()=>o(s.id),text:"Deslizar al completar",disabled:r==="intermission",className:P?"bg-amber-100 border-amber-300":h?"bg-teal-100 border-teal-300":"bg-gray-100 border-gray-300"})})]})};return w?e.jsxs("div",{className:"flex flex-col bg-white rounded-xl border-2 border-red-400 shadow-lg p-6 justify-center items-center text-center min-h-[320px]",children:[e.jsx("div",{className:"bg-red-100 p-4 rounded-full mb-4",children:e.jsx(x,{name:"alert-triangle",size:40,className:"text-red-600"})}),e.jsx("h4",{className:"font-bold text-xl mb-2 text-gray-800",children:"Â¿Cancelar Proceso?"}),e.jsxs("p",{className:"text-gray-600 mb-8",children:["Se perderÃ¡ el progreso actual de ",e.jsx("span",{className:"font-bold",children:y}),"."]}),e.jsxs("div",{className:"flex gap-4 w-full",children:[e.jsx("button",{onClick:()=>a(!1),className:"flex-1 py-3 px-4 bg-gray-100 text-gray-800 font-bold rounded-lg hover:bg-gray-200",children:"Volver"}),e.jsx("button",{onClick:()=>m(s.id),className:"flex-1 py-3 px-4 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 shadow-md",children:"SÃ­, Cancelar"})]})]}):e.jsxs("div",{className:`flex flex-col rounded-xl border-2 shadow-sm hover:shadow-md transition-all duration-300 overflow-hidden ${p.card}`,children:[e.jsxs("header",{className:`p-4 flex justify-between items-start ${p.header}`,children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-xl leading-tight flex items-center gap-2 text-gray-800",children:[h?e.jsx(x,{name:"thermometer",className:r==="running"?"animate-pulse text-teal-600":"text-teal-600"}):e.jsx(x,{name:"cake-slice",className:"text-blue-600"}),y]}),e.jsx("p",{className:`text-xs font-bold uppercase tracking-wider mt-1 ${p.textSub}`,children:r==="running"?h?"â€¢ Proceso AutomÃ¡tico":"â€¢ AcciÃ³n Requerida":r==="paused"?"â€¢ En Pausa - Requiere AtenciÃ³n":r==="intermission"?"â€¢ Listo para iniciar - Dale Play":r==="alarm"?"â€¢ Â¡TIEMPO TERMINADO!":"â€¢ Finalizado"})]}),h&&r==="running"&&e.jsx("div",{className:"flex flex-col items-end",children:e.jsx("span",{className:"bg-white border border-teal-300 text-teal-700 px-3 py-1 rounded-full text-xs font-bold shadow-sm animate-pulse",children:"LIBRE"})})]}),n===0&&((M=s.recipe)==null?void 0:M.setupInstruction)&&e.jsx("div",{className:"bg-yellow-100 border-b-2 border-yellow-300 p-3 mb-0",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(x,{name:"settings",className:"text-yellow-700 mt-1 flex-shrink-0",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-yellow-700 uppercase tracking-wider mb-0.5",children:"ConfiguraciÃ³n Inicial"}),e.jsx("p",{className:"text-sm font-medium text-yellow-900 leading-snug",children:s.recipe.setupInstruction})]})]})}),e.jsxs("div",{className:"p-4 flex-grow flex flex-col justify-between gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center relative",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest mb-1 block opacity-60",children:"Tiempo Restante"}),e.jsx("p",{className:`text-7xl font-bold tabular-nums tracking-tighter leading-none ${p.timer} transition-colors duration-500`,children:G(N)})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs font-semibold opacity-60",children:[e.jsx(x,{name:"rotate-ccw",size:12}),e.jsxs("span",{children:["Total lote: ",G(j)]})]})]}),e.jsx("div",{className:`rounded-lg border overflow-hidden flex flex-col max-h-48 ${p.stepList}`,children:e.jsx("div",{className:"overflow-y-auto p-2 space-y-1 custom-scrollbar",children:c.map((E,k)=>e.jsx(ne,{step:E,isCompleted:k<n,isCurrent:k===n&&r!=="finished"},k))})}),e.jsxs("div",{className:`${p.controls}`,children:[S(),r!=="finished"&&r!=="alarm"&&e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{onClick:()=>a(!0),className:"text-xs text-gray-400 hover:text-red-500 font-semibold px-2 py-1 transition-colors",children:"Cancelar Todo"})})]})]})]})},oe=({rating:s,setRating:o})=>e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3,4,5].map(i=>e.jsx("button",{type:"button",onClick:()=>o(i),onMouseEnter:()=>{},onMouseLeave:()=>{},className:"transition-transform transform hover:scale-125",children:e.jsx(x,{name:"star",size:40,className:`cursor-pointer ${i<=s?"text-yellow-400 fill-current":"text-gray-300"}`})},i))}),ie=({isOpen:s,processName:o,onSave:i,onSkip:b})=>{const[m,l]=f.useState(3),[g,r]=f.useState(""),y=()=>{i(m,g)};return e.jsx(V,{isOpen:s,onClose:b,title:`Feedback para: ${o}`,children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"Â¿QuÃ© tal saliÃ³ el resultado?"}),e.jsx(oe,{rating:m,setRating:l})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedback-notes",className:"block text-sm font-medium text-gray-600 mb-1",children:"Notas (Opcional)"}),e.jsx("textarea",{id:"feedback-notes",value:g,onChange:c=>r(c.target.value),rows:4,placeholder:"Ej: El color fue perfecto, pero la prÃ³xima vez intentarÃ© con 1 minuto menos...",className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Omitir"}),e.jsx("button",{type:"button",onClick:y,className:"py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Guardar"})]})]})})},U=Z(te,"settings","bakery_dashboard"),de=({inventoryHook:s,categoriesHook:o})=>{const{items:i}=s,{categories:b}=o,[m,l]=f.useState({categoryMapping:{}}),[g,r]=f.useState(!1);f.useEffect(()=>{const a=Y(U,t=>{t.exists()&&l(t.data())},t=>{console.error("Error fetching dashboard settings:",t)});return()=>a()},[]);const y=async a=>{const t={categoryMapping:a};l(t),r(!1);try{await ee(U,t)}catch(u){console.error("Error saving dashboard settings:",u)}},{rawItems:c,wipItems:n,finishedItems:j,totalValue:N}=f.useMemo(()=>{const a=[],t=[],u=[];let v=0;return i.forEach(h=>{var z,p,S,M;const P=h.category||"Sin CategorÃ­a",I=m.categoryMapping[P]||"none",R=(p=(z=h.purchaseHistory)==null?void 0:z[h.purchaseHistory.length-1])==null?void 0:p.totalPrice,C=(M=(S=h.purchaseHistory)==null?void 0:S[h.purchaseHistory.length-1])==null?void 0:M.quantity,$=R&&C?R/C:0;v+=$*h.currentStock,h.isBakeryCritical&&a.push(h),I==="wip"?t.push(h):I==="finished"&&u.push(h)}),{rawItems:a,wipItems:t,finishedItems:u,totalValue:v}},[i,m]),w=({item:a,theme:t})=>{const u=a.currentStock<=a.minStock,v={green:{bg:"bg-white",border:"border-emerald-100",text:"text-emerald-800",badge:"bg-emerald-100 text-emerald-800"},blue:{bg:"bg-white",border:"border-cyan-100",text:"text-cyan-800",badge:"bg-cyan-100 text-cyan-800"},orange:{bg:"bg-white",border:"border-orange-100",text:"text-orange-800",badge:"bg-orange-100 text-orange-800"}}[t];return e.jsxs("div",{className:`p-3 rounded-lg border shadow-sm flex justify-between items-center ${v.bg} ${v.border} ${u?"border-red-300 ring-1 ring-red-200":""}`,children:[e.jsxs("div",{className:"min-w-0 flex-1 pr-2",children:[e.jsx("p",{className:`font-bold text-sm truncate ${v.text}`,children:a.name}),e.jsx("p",{className:"text-xs text-gray-500",children:a.category})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`font-bold text-lg ${u?"text-red-600":"text-gray-800"}`,children:parseFloat(a.currentStock.toFixed(2))}),e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:a.unit})]})]})};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"bg-white p-4 border-b border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-500 text-xs font-bold uppercase tracking-wider",children:"Valor Estimado Stock PanaderÃ­a"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["$",N.toFixed(2)]})]}),e.jsxs("button",{onClick:()=>r(!0),className:"flex items-center gap-2 text-sm text-blue-600 hover:bg-blue-50 px-3 py-2 rounded-lg transition-colors",children:[e.jsx(x,{name:"settings",size:16}),"Configurar Tablero"]})]}),e.jsx("div",{className:"flex-grow overflow-x-auto",children:e.jsxs("div",{className:"flex h-full min-w-[800px] p-4 gap-4",children:[e.jsxs("div",{className:"flex-1 flex flex-col bg-emerald-50/50 rounded-xl border border-emerald-100 overflow-hidden",children:[e.jsxs("div",{className:"p-3 bg-emerald-100/50 border-b border-emerald-200 flex items-center gap-2",children:[e.jsx(x,{name:"archive",className:"text-emerald-600",size:20}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"font-bold text-emerald-900",children:"1. Insumos CrÃ­ticos"}),e.jsx("p",{className:"text-[10px] text-emerald-700 leading-none",children:"Marcados manualmente en inventario"})]}),e.jsx("span",{className:"ml-auto bg-white text-emerald-700 text-xs font-bold px-2 py-0.5 rounded-full",children:c.length})]}),e.jsxs("div",{className:"p-3 overflow-y-auto flex-grow space-y-2",children:[c.map(a=>e.jsx(w,{item:a,theme:"green"},a.id)),c.length===0&&e.jsxs("div",{className:"text-center p-4",children:[e.jsx("p",{className:"text-sm text-emerald-500 italic",children:"Sin insumos marcados."}),e.jsx("p",{className:"text-xs text-emerald-400 mt-1",children:'Edita un producto en inventario y activa "CrÃ­tico de PanaderÃ­a" para verlo aquÃ­.'})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col bg-cyan-50/50 rounded-xl border border-cyan-100 overflow-hidden",children:[e.jsxs("div",{className:"p-3 bg-cyan-100/50 border-b border-cyan-200 flex items-center gap-2",children:[e.jsx(x,{name:"thermometer-snowflake",className:"text-cyan-600",size:20}),e.jsx("h3",{className:"font-bold text-cyan-900",children:"2. En Reserva (Congelados)"}),e.jsx("span",{className:"ml-auto bg-white text-cyan-700 text-xs font-bold px-2 py-0.5 rounded-full",children:n.length})]}),e.jsxs("div",{className:"p-3 overflow-y-auto flex-grow space-y-2",children:[n.map(a=>e.jsx(w,{item:a,theme:"blue"},a.id)),n.length===0&&e.jsx("p",{className:"text-center text-sm text-cyan-400 italic mt-4",children:"Sin categorÃ­as asignadas"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col bg-orange-50/50 rounded-xl border border-orange-100 overflow-hidden",children:[e.jsxs("div",{className:"p-3 bg-orange-100/50 border-b border-orange-200 flex items-center gap-2",children:[e.jsx(x,{name:"cake-slice",className:"text-orange-600",size:20}),e.jsx("h3",{className:"font-bold text-orange-900",children:"3. Vitrina (Horneados)"}),e.jsx("span",{className:"ml-auto bg-white text-orange-700 text-xs font-bold px-2 py-0.5 rounded-full",children:j.length})]}),e.jsxs("div",{className:"p-3 overflow-y-auto flex-grow space-y-2",children:[j.map(a=>e.jsx(w,{item:a,theme:"orange"},a.id)),j.length===0&&e.jsx("p",{className:"text-center text-sm text-orange-400 italic mt-4",children:"Sin categorÃ­as asignadas"})]})]})]})}),g&&e.jsx(ce,{isOpen:g,onClose:()=>r(!1),categories:b,currentMapping:m.categoryMapping,onSave:y})]})},ce=({isOpen:s,onClose:o,categories:i,currentMapping:b,onSave:m})=>{const[l,g]=f.useState(b),r=(c,n)=>{g(j=>({...j,[c]:n}))},y=()=>{m(l)};return e.jsxs(V,{isOpen:s,onClose:o,title:"Configurar Tablero de PanaderÃ­a",children:[e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded border border-blue-200 mb-4 text-sm text-blue-800",children:[e.jsx("p",{className:"font-bold",children:"â„¹ï¸ Nota sobre la Columna 1 (Insumos):"}),e.jsx("p",{children:'Esta columna ahora es automÃ¡tica. Muestra los productos que has marcado como "CrÃ­tico de PanaderÃ­a" en el Inventario, sin importar su categorÃ­a.'})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Asigna categorÃ­as de inventario a las columnas de proceso:"}),e.jsx("div",{className:"space-y-3",children:i.map(c=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded border border-gray-200",children:[e.jsx("span",{className:"font-bold text-gray-700 text-sm",children:c.name}),e.jsxs("select",{value:l[c.name]||"none",onChange:n=>r(c.name,n.target.value),className:"p-1.5 text-sm border border-gray-300 rounded bg-white",children:[e.jsx("option",{value:"none",children:"Ocultar / General"}),e.jsx("option",{value:"wip",children:"Col 2: Congelados/Masa"}),e.jsx("option",{value:"finished",children:"Col 3: Horneados"})]})]},c.id))})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg",children:"Cancelar"}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-blue-600 text-white font-bold rounded-lg",children:"Guardar ConfiguraciÃ³n"})]})]})},he=({productionHook:s,recipeLogHook:o,recipesHook:i,inventoryHook:b,categoriesHook:m})=>{const{users:l}=se(),[g,r]=f.useState("processes"),[y,c]=f.useState(!1),[n,j]=f.useState(null),[N,w]=f.useState(null),[a,t]=f.useState(!1),{processes:u,startBakingProcess:v,startHeatingProcess:h,advanceProcess:P,goToPreviousStep:I,togglePauseProcess:R,cancelProcess:C,isSoundMuted:$,toggleSoundMute:z,isAudioReady:p,isSuspended:S,unlockAudio:M}=s,{addFeedback:E}=o,{recipes:k}=i,{produceBatch:A,stockLogs:L}=b,H=d=>{d.type==="baking"&&d.recipeId?j(d):C(d.id)},_=d=>{w(d)},J=(d,T,X)=>{const F=k.find(O=>O.id===d.recipeId)||d.recipe;if(F){let O=1;F.outputQuantity&&F.outputQuantity>0&&(O=T/F.outputQuantity),A(F,O,T,X),w(null)}else alert("Error: No se encontrÃ³ la receta vinculada.")},K=(d,T)=>{n&&n.recipeId&&(E({recipeId:n.recipeId,rating:d,notes:T}),C(n.id)),j(null)},W=()=>{n&&C(n.id),j(null)},D=u.filter(d=>d.state!=="finished"),B=u.filter(d=>d.state==="finished");return a?e.jsx(ae,{logs:L,onClose:()=>t(!1)}):e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 flex justify-between items-center px-4 py-2 flex-shrink-0",children:[e.jsxs("div",{className:"flex gap-4 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>r("processes"),className:`flex items-center gap-2 py-2 px-3 text-sm font-bold border-b-2 transition-colors whitespace-nowrap ${g==="processes"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-800"}`,children:[e.jsx(x,{name:"play-circle",size:18}),"ProducciÃ³n"]}),e.jsxs("button",{onClick:()=>r("dashboard"),className:`flex items-center gap-2 py-2 px-3 text-sm font-bold border-b-2 transition-colors whitespace-nowrap ${g==="dashboard"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-800"}`,children:[e.jsx(x,{name:"bar-chart-2",size:18}),"Stock y Resumen"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>t(!0),className:"p-2 text-gray-500 hover:bg-gray-100 rounded-full transition-colors",title:"Ver Historial",children:e.jsx(x,{name:"list",size:20})}),g==="processes"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:S?M:z,title:S?"Sonidos bloqueados. Clic para activar.":$?"Activar Sonidos":"Silenciar Sonidos",className:`p-2 rounded-full transition-colors ${S?"text-yellow-600 animate-pulse":"text-gray-500 hover:text-blue-600 hover:bg-gray-100"}`,children:e.jsx(x,{name:$||S?"volume-x":"volume-2",size:20})}),e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-1.5 px-3 rounded-lg hover:bg-blue-700 transition-colors text-sm whitespace-nowrap",children:[e.jsx(x,{name:"plus-circle",size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Iniciar"})]})]})]})]}),e.jsx("div",{className:"flex-grow overflow-hidden",children:g==="dashboard"?e.jsx(de,{inventoryHook:b,categoriesHook:m}):e.jsxs("div",{className:"h-full overflow-y-auto p-4 md:p-6",children:[D.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:D.map(d=>e.jsx(Q,{process:d,onAdvance:P,onPrevious:I,onTogglePause:R,onCancel:C,onAcknowledgeFinish:()=>{},isAudioReady:p},d.id))}):e.jsxs("div",{className:"text-center py-16 text-gray-500",children:[e.jsx("p",{children:"No hay procesos activos."}),e.jsx("p",{className:"text-sm mt-2",children:'Ve a la pestaÃ±a "Stock y Resumen" para ver quÃ© hace falta.'})]}),B.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-600 mb-3",children:"Finalizados Recientemente"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:B.map(d=>e.jsx(Q,{process:d,onAdvance:P,onPrevious:I,onTogglePause:()=>{},onCancel:C,onAcknowledgeFinish:()=>H(d),isAudioReady:p,onRecordProduction:()=>_(d)},d.id))})]})]})}),e.jsx(le,{isOpen:y,onClose:()=>c(!1),onSelectRecipe:v,onSelectHeating:h,recipes:k}),n&&e.jsx(ie,{isOpen:!!n,processName:n.name,onSave:K,onSkip:W}),N&&e.jsx(re,{isOpen:!!N,onClose:()=>w(null),process:N,users:l,onConfirm:J})]})};export{he as default};
