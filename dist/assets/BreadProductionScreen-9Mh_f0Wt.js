import{r as f,j as e,I as c}from"./index-BhvwMvOn.js";import{M as G}from"./Modal-DiwVflEb.js";import{S as D}from"./SwipeButton-CmIDz5XE.js";const K=({isOpen:t,onClose:o,onSelectRecipe:i,onSelectHeating:b,recipes:x})=>{var g;const[a,n]=f.useState(null),s=r=>{!r.variants||r.variants.length===0?(i(r),o()):n(r)},u=r=>{a&&i(a,r),h(),o()},h=()=>{n(null)},p=(r,v)=>{h(),b(r,v),o()},j=x.filter(r=>r.name.toLowerCase().includes("(horneado)")),y=x.filter(r=>!r.name.toLowerCase().includes("(horneado)")),P=a?`Variantes de: ${a.name}`:"Iniciar un Nuevo Proceso";return e.jsx(G,{isOpen:t,onClose:o,title:P,children:a?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>u("base"),className:"w-full p-4 bg-blue-100 text-blue-800 rounded-lg border border-blue-200 hover:bg-blue-200 hover:border-blue-300 transition-colors text-left",children:[e.jsx("p",{className:"font-bold",children:a.baseVariantName||"Receta EstÃ¡ndar"}),a.baseVariantDescription&&e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:a.baseVariantDescription})]}),(g=a.variants)==null?void 0:g.map(r=>e.jsxs("button",{onClick:()=>u(r.id),className:"w-full p-4 bg-gray-100 text-gray-800 rounded-lg border border-gray-200 hover:bg-gray-200 hover:border-gray-300 transition-colors text-left",children:[e.jsx("p",{className:"font-bold",children:r.name}),r.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r.description})]},r.id)),e.jsx("button",{onClick:h,className:"mt-4 text-sm text-gray-600 hover:underline font-semibold",children:"â† Volver a recetas"})]}):e.jsxs("div",{className:"flex flex-col gap-6 max-h-[70vh] overflow-y-auto pr-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-blue-700 mb-2 flex items-center gap-2 pb-1 border-b border-blue-100",children:[e.jsx("span",{children:"ðŸ¥£"})," ElaboraciÃ³n de Masas"]}),e.jsx("div",{className:"flex flex-col gap-3",children:y.length>0?y.map(r=>e.jsx("button",{onClick:()=>s(r),className:"w-full p-3 bg-white text-gray-800 font-bold rounded-lg border border-gray-200 hover:bg-blue-50 hover:border-blue-300 transition-colors text-left shadow-sm",children:r.name},r.id)):e.jsx("p",{className:"text-sm text-gray-400 italic px-2",children:"No hay recetas de masas configuradas."})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-orange-700 mb-2 flex items-center gap-2 pb-1 border-b border-orange-100",children:[e.jsx("span",{children:"ðŸ”¥"})," Horneado Final"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:j.length>0?j.map(r=>e.jsx("button",{onClick:()=>s(r),className:"w-full p-3 bg-orange-50 text-gray-800 font-bold rounded-lg border border-orange-200 hover:bg-orange-100 hover:border-orange-300 transition-colors text-left shadow-sm",children:r.name.replace(/\(Horneado\)/i,"").trim()},r.id)):e.jsx("p",{className:"text-sm text-gray-400 italic px-2",children:"No hay recetas de horneado configuradas."})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-600 mb-2 flex items-center gap-2 pb-1 border-b border-gray-200",children:[e.jsx("span",{children:"â±ï¸"})," Herramientas"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>p(15*60,"Precalentar (15 min)"),className:"w-full p-3 flex flex-col items-center justify-center gap-1 bg-gray-50 text-gray-700 font-bold rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors text-sm",children:[e.jsx(c,{name:"thermometer-snowflake",size:20}),e.jsx("span",{children:"Precalentar"})]}),e.jsxs("button",{onClick:()=>p(7*60,"Recalentar (7 min)"),className:"w-full p-3 flex flex-col items-center justify-center gap-1 bg-gray-50 text-gray-700 font-bold rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors text-sm",children:[e.jsx(c,{name:"thermometer-sun",size:20}),e.jsx("span",{children:"Recalentar"})]})]})]})]})})},V=t=>{(isNaN(t)||t<0)&&(t=0);const o=Math.floor(t/60),i=t%60;return`${String(o).padStart(2,"0")}:${String(i).padStart(2,"0")}`},W=({step:t,isCompleted:o,isCurrent:i})=>{let b="text-gray-500",x="border-gray-300 text-gray-300",a="";return i?(b="font-bold text-gray-900",t.type==="passive"?(x="border-teal-500 bg-teal-500 text-white animate-pulse",a="bg-teal-50/80 shadow-md -mx-2 px-3 py-3 rounded-lg border-l-4 border-teal-500 transition-all duration-300 my-1"):(x="border-blue-600 bg-blue-600 text-white animate-pulse",a="bg-blue-50/80 shadow-md -mx-2 px-3 py-3 rounded-lg border-l-4 border-blue-600 transition-all duration-300 my-1")):o?(b="text-gray-400 line-through decoration-gray-400",x="border-green-500 text-green-500 bg-green-50",a="py-1 opacity-75"):a="py-1",e.jsxs("div",{className:`flex items-center gap-3 transition-all duration-300 ${a}`,children:[e.jsx("div",{className:`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center ${x}`,children:o?e.jsx(c,{name:"check",size:12}):i?e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"}):null}),e.jsx("div",{className:"flex-grow",children:e.jsx("p",{className:`text-sm leading-tight ${b}`,children:t.instruction})}),i&&e.jsx("span",{className:`text-[10px] font-bold uppercase px-2 py-1 rounded-full flex-shrink-0 shadow-sm ${t.type==="passive"?"bg-white text-teal-700 border border-teal-200":"bg-white text-blue-700 border border-blue-200"}`,children:t.type==="passive"?"Espera":"Manual"})]})},q=({process:t,onAdvance:o,onPrevious:i,onTogglePause:b,onCancel:x,onAcknowledgeFinish:a,onRecordProduction:n})=>{var H,O,Q;const{state:s,name:u,steps:h,currentStepIndex:p,totalTimeLeft:j,stepTimeLeft:y}=t,[P,g]=f.useState(!1),[r,v]=f.useState(!1),[R,S]=f.useState(!1),F=((H=t.recipe)==null?void 0:H.outputQuantity)||1,[I,z]=f.useState(String(F));f.useEffect(()=>{var m;z(String(((m=t.recipe)==null?void 0:m.outputQuantity)||1))},[t.id,(O=t.recipe)==null?void 0:O.outputQuantity]);const A=h[p],N=(A==null?void 0:A.type)==="passive",M=s==="paused"||s==="intermission",T={card:"bg-teal-50 text-teal-900 border-teal-300",header:"bg-teal-100/60 border-b border-teal-200",textMain:"text-teal-800",textSub:"text-teal-600",timer:"text-teal-700",stepList:"bg-white/80 border-teal-200",controls:"border-t border-teal-200 pt-3"},L={card:"bg-white text-gray-800 border-blue-500",header:"bg-blue-50/60 border-b border-blue-100",textSub:"text-gray-500",timer:"text-blue-700",stepList:"bg-gray-50 border-gray-200",controls:"border-t border-gray-100 pt-3"},$={card:"bg-amber-50 text-amber-900 border-amber-400 shadow-md",header:"bg-amber-100 border-b border-amber-200",textMain:"text-amber-800",textSub:"text-amber-700 font-bold",timer:"text-amber-700",stepList:"bg-white/60 border-amber-200",controls:"border-t border-amber-200 pt-3"},E={card:"bg-red-50 text-red-900 border-red-500 animate-pulse-red",header:"bg-red-100 border-b border-red-200",textMain:"text-red-700",textSub:"text-red-600",timer:"text-red-600 animate-pulse",stepList:"bg-white border-red-200",controls:"border-t border-red-200 pt-3"},l={card:"bg-green-50 text-green-900 border-green-600",header:"bg-green-100 border-b border-green-200",textMain:"text-green-700",textSub:"text-green-600",timer:"text-green-700",stepList:"bg-white border-green-200",controls:"border-t border-green-200 pt-3"};let d=L;s==="finished"?d=l:s==="alarm"?d=E:M?d=$:N&&(d=T);const w=()=>{const m=parseFloat(I);if(isNaN(m)||m<0){alert("Por favor ingresa una cantidad vÃ¡lida.");return}n&&confirm(`Â¿Confirmar producciÃ³n de ${m} unidades?`)&&(n(t,m),S(!0))},C=()=>{var B;if(s==="finished"){const U=((B=t.recipe)==null?void 0:B.ingredients)&&t.recipe.ingredients.length>0;return e.jsxs("div",{className:"flex flex-col gap-3",children:[n&&U&&!R&&e.jsxs("div",{className:"bg-white/60 p-3 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-bold text-green-800",children:"Cantidad Real:"}),e.jsx("input",{type:"number",value:I,onChange:J=>z(J.target.value),className:"w-20 p-1 text-center border border-green-300 rounded font-bold text-green-900 focus:outline-none focus:ring-2 focus:ring-green-500",min:"0",step:"any"})]}),e.jsxs("button",{onClick:w,className:"w-full bg-emerald-600 text-white font-bold py-2 rounded-lg hover:bg-emerald-700 transition-colors shadow-sm flex items-center justify-center gap-2 text-sm",children:[e.jsx(c,{name:"boxes",size:16}),"Registrar Inventario"]})]}),R&&e.jsxs("div",{className:"w-full py-2 bg-green-100 text-green-800 text-center rounded-lg font-bold text-sm border border-green-200",children:[e.jsx(c,{name:"check",size:14,className:"inline mr-1"})," Inventario Actualizado (",I,")"]}),e.jsx("button",{onClick:()=>a(t),className:"w-full bg-gray-600 text-white font-bold py-3 rounded-lg hover:bg-gray-700 transition-colors shadow-sm uppercase tracking-wider text-sm",children:"Terminar y Archivar"})]})}if(s==="alarm")return e.jsx(D,{onSwipe:()=>o(t.id),text:"Deslizar para apagar alarma",icon:"check-circle",className:"bg-red-100 border-red-300"});if(r)return e.jsxs("div",{className:"flex flex-col gap-2 bg-orange-50 p-3 rounded-lg border border-orange-200 animate-fadeIn",children:[e.jsx("p",{className:"text-xs font-bold text-orange-800 text-center",children:"Â¿Regresar? Se perderÃ¡ el progreso de este paso."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>v(!1),className:"flex-1 py-2 px-3 bg-white border border-gray-300 text-gray-700 font-bold rounded-lg text-xs hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:()=>{i(t.id),v(!1)},className:"flex-1 py-2 px-3 bg-orange-500 text-white font-bold rounded-lg text-xs hover:bg-orange-600 shadow-sm",children:"SÃ­, Regresar"})]})]});const m=p>0,k=s==="paused"||s==="intermission";return e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>v(!0),disabled:!m,className:`p-3 rounded-lg transition-colors flex-shrink-0 ${m?"bg-white border border-gray-200 hover:bg-gray-50 text-gray-700 shadow-sm":"bg-transparent border border-transparent text-gray-300 cursor-not-allowed"}`,title:"Paso Anterior",children:e.jsx(c,{name:"rotate-ccw",size:20})}),e.jsxs("button",{onClick:()=>b(t.id),className:`flex-grow flex items-center justify-center gap-2 font-bold rounded-lg transition-colors shadow-sm border text-sm md:text-base ${k?"bg-green-500 text-white border-green-600 hover:bg-green-600 animate-pulse":"bg-amber-100 text-amber-900 border-amber-300 hover:bg-amber-200"}`,children:[e.jsx(c,{name:k?"play-circle":"minus",size:20}),k?s==="intermission"?"INICIAR SIGUIENTE":"REANUDAR":"PAUSAR"]})]}),e.jsx("div",{className:"relative z-0",children:e.jsx(D,{onSwipe:()=>o(t.id),text:"Deslizar al completar",disabled:s==="intermission",className:M?"bg-amber-100 border-amber-300":N?"bg-teal-100 border-teal-300":"bg-gray-100 border-gray-300"})})]})};return P?e.jsxs("div",{className:"flex flex-col bg-white rounded-xl border-2 border-red-400 shadow-lg p-6 justify-center items-center text-center min-h-[320px]",children:[e.jsx("div",{className:"bg-red-100 p-4 rounded-full mb-4",children:e.jsx(c,{name:"alert-triangle",size:40,className:"text-red-600"})}),e.jsx("h4",{className:"font-bold text-xl mb-2 text-gray-800",children:"Â¿Cancelar Proceso?"}),e.jsxs("p",{className:"text-gray-600 mb-8",children:["Se perderÃ¡ el progreso actual de ",e.jsx("span",{className:"font-bold",children:u}),"."]}),e.jsxs("div",{className:"flex gap-4 w-full",children:[e.jsx("button",{onClick:()=>g(!1),className:"flex-1 py-3 px-4 bg-gray-100 text-gray-800 font-bold rounded-lg hover:bg-gray-200",children:"Volver"}),e.jsx("button",{onClick:()=>x(t.id),className:"flex-1 py-3 px-4 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 shadow-md",children:"SÃ­, Cancelar"})]})]}):e.jsxs("div",{className:`flex flex-col rounded-xl border-2 shadow-sm hover:shadow-md transition-all duration-300 overflow-hidden ${d.card}`,children:[e.jsxs("header",{className:`p-4 flex justify-between items-start ${d.header}`,children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-xl leading-tight flex items-center gap-2 text-gray-800",children:[N?e.jsx(c,{name:"thermometer",className:s==="running"?"animate-pulse text-teal-600":"text-teal-600"}):e.jsx(c,{name:"cake-slice",className:"text-blue-600"}),u]}),e.jsx("p",{className:`text-xs font-bold uppercase tracking-wider mt-1 ${d.textSub}`,children:s==="running"?N?"â€¢ Proceso AutomÃ¡tico":"â€¢ AcciÃ³n Requerida":s==="paused"?"â€¢ En Pausa - Requiere AtenciÃ³n":s==="intermission"?"â€¢ Listo para iniciar - Dale Play":s==="alarm"?"â€¢ Â¡TIEMPO TERMINADO!":"â€¢ Finalizado"})]}),N&&s==="running"&&e.jsx("div",{className:"flex flex-col items-end",children:e.jsx("span",{className:"bg-white border border-teal-300 text-teal-700 px-3 py-1 rounded-full text-xs font-bold shadow-sm animate-pulse",children:"LIBRE"})})]}),p===0&&((Q=t.recipe)==null?void 0:Q.setupInstruction)&&e.jsx("div",{className:"bg-yellow-100 border-b-2 border-yellow-300 p-3 mb-0",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(c,{name:"settings",className:"text-yellow-700 mt-1 flex-shrink-0",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-yellow-700 uppercase tracking-wider mb-0.5",children:"ConfiguraciÃ³n Inicial"}),e.jsx("p",{className:"text-sm font-medium text-yellow-900 leading-snug",children:t.recipe.setupInstruction})]})]})}),e.jsxs("div",{className:"p-4 flex-grow flex flex-col justify-between gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center relative",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest mb-1 block opacity-60",children:"Tiempo Restante"}),e.jsx("p",{className:`text-7xl font-bold tabular-nums tracking-tighter leading-none ${d.timer} transition-colors duration-500`,children:V(y)})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs font-semibold opacity-60",children:[e.jsx(c,{name:"rotate-ccw",size:12}),e.jsxs("span",{children:["Total lote: ",V(j)]})]})]}),e.jsx("div",{className:`rounded-lg border overflow-hidden flex flex-col max-h-48 ${d.stepList}`,children:e.jsx("div",{className:"overflow-y-auto p-2 space-y-1 custom-scrollbar",children:h.map((m,k)=>e.jsx(W,{step:m,isCompleted:k<p,isCurrent:k===p&&s!=="finished"},k))})}),e.jsxs("div",{className:`${d.controls}`,children:[C(),s!=="finished"&&s!=="alarm"&&e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{onClick:()=>g(!0),className:"text-xs text-gray-400 hover:text-red-500 font-semibold px-2 py-1 transition-colors",children:"Cancelar Todo"})})]})]})]})},X=({rating:t,setRating:o})=>e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3,4,5].map(i=>e.jsx("button",{type:"button",onClick:()=>o(i),onMouseEnter:()=>{},onMouseLeave:()=>{},className:"transition-transform transform hover:scale-125",children:e.jsx(c,{name:"star",size:40,className:`cursor-pointer ${i<=t?"text-yellow-400 fill-current":"text-gray-300"}`})},i))}),Y=({isOpen:t,processName:o,onSave:i,onSkip:b})=>{const[x,a]=f.useState(3),[n,s]=f.useState(""),u=()=>{i(x,n)};return e.jsx(G,{isOpen:t,onClose:b,title:`Feedback para: ${o}`,children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"Â¿QuÃ© tal saliÃ³ el resultado?"}),e.jsx(X,{rating:x,setRating:a})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedback-notes",className:"block text-sm font-medium text-gray-600 mb-1",children:"Notas (Opcional)"}),e.jsx("textarea",{id:"feedback-notes",value:n,onChange:h=>s(h.target.value),rows:4,placeholder:"Ej: El color fue perfecto, pero la prÃ³xima vez intentarÃ© con 1 minuto menos...",className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300",children:"Omitir"}),e.jsx("button",{type:"button",onClick:u,className:"py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Guardar"})]})]})})},te=({productionHook:t,recipeLogHook:o,recipesHook:i,inventoryHook:b})=>{const[x,a]=f.useState(!1),[n,s]=f.useState(null),{processes:u,startBakingProcess:h,startHeatingProcess:p,advanceProcess:j,goToPreviousStep:y,togglePauseProcess:P,cancelProcess:g,isSoundMuted:r,toggleSoundMute:v,isAudioReady:R,isSuspended:S,unlockAudio:F}=t,{addFeedback:I}=o,{recipes:z}=i,{produceBatch:A}=b,N=l=>{l.type==="baking"&&l.recipeId?s(l):g(l.id)},M=(l,d)=>{const w=z.find(C=>C.id===l.recipeId)||l.recipe;if(w){let C=1;w.outputQuantity&&d!==void 0&&w.outputQuantity>0&&(C=d/w.outputQuantity),A(w,C,d)}else alert("Error: No se encontrÃ³ la receta vinculada para registrar el inventario.")},T=(l,d)=>{n&&n.recipeId&&(I({recipeId:n.recipeId,rating:l,notes:d}),g(n.id)),s(null)},L=()=>{n&&g(n.id),s(null)},$=u.filter(l=>l.state!=="finished"),E=u.filter(l=>l.state==="finished");return e.jsxs("div",{className:"p-4 md:p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-xl font-bold text-blue-700",children:"Procesos Activos"}),e.jsx("button",{onClick:S?F:v,title:S?"Sonidos bloqueados por el navegador. Haz clic para activar.":r?"Activar Sonidos":"Silenciar Sonidos",className:`p-2 rounded-full transition-colors ${S?"text-yellow-600 animate-pulse":"text-gray-500 hover:text-blue-600 hover:bg-gray-100"}`,children:e.jsx(c,{name:r||S?"volume-x":"volume-2",size:20})})]}),e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(c,{name:"plus-circle",size:16}),"Iniciar Proceso"]})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto",children:[$.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:$.map(l=>e.jsx(q,{process:l,onAdvance:j,onPrevious:y,onTogglePause:P,onCancel:g,onAcknowledgeFinish:()=>{},isAudioReady:R},l.id))}):e.jsxs("div",{className:"text-center py-16 text-gray-500",children:[e.jsx("p",{children:"No hay procesos activos en este momento."}),e.jsx("p",{children:'Haz clic en "Iniciar Proceso" para comenzar.'})]}),E.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-600",children:"Finalizados Recientemente"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:E.map(l=>e.jsx(q,{process:l,onAdvance:j,onPrevious:y,onTogglePause:()=>{},onCancel:g,onAcknowledgeFinish:()=>N(l),isAudioReady:R,onRecordProduction:M},l.id))})]})]}),e.jsx(K,{isOpen:x,onClose:()=>a(!1),onSelectRecipe:h,onSelectHeating:p,recipes:z}),n&&e.jsx(Y,{isOpen:!!n,processName:n.name,onSave:T,onSkip:L})]})};export{te as default};
